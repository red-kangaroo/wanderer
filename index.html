<!DOCTYPE html>
<html class="v2" dir="ltr" lang="en">
<head>
  <title>Wanderer</title>
</head>

<body>
  <style>
  body p,
  input {
  	font-family:courier, monospace;
    /* font-size:15px; */
    line-height: 85%;
  }
  code {
    color: crimson;
    font-weight: bold;
    background-color: #f1f1f1;
    padding: 2px;
    font-size: 105%;
  }
  </style>

<div id="game-window" style="position:relative; max-width: 60%;">
  <p id="mapText"></p>
  <p id="statusLine"></p>
</div>

<div id="additional-info" style="position:absolute; top: 0px; right: 5px; max-width: 40%;">
  <h3>Wanderer v2.1</h3>
	<p>
    There are so many worlds to explore, but only so much of you left...
  </br></br>
    Welcome, Wanderer. You can check out the source code and report issues on
    <a href="https://github.com/red-kangaroo/wanderer">GitHub</a>, or post
    a comment on my <a href="https://attnam.blogspot.com/2020/08/wanderer.html">blog</a>.
    Have fun!
  </br></br>
    Use <code>F11</code> for fullscreen mode (recommended).
  </br></br>
    Use <code>Ctrl +</code> and <code>Ctrl -</code> to adjust the size
    to your liking.
  </br></br>
    Press <code>?</code> for game help.
  </p>

	<!-- <form method="GET">
	<input type="text" name="name" placeholder="Sunny Honey Bunny">
	<input type="submit" value="Send">
	</form> -->

  <h5>Nearby:</h5>
  <p id="nearbyList"></p>
  <p id="msgWindow"></p>
</div>

<script>
var VERSION = "v2.1";

// Map gen:
var mapWidth = 50;
var wallBreaks = 4; //higher reduces chance
var worldPos = {x:0,y:0};
var worldData = [];
var currentMap = [];

// Messages:
var msg = "";
var msgLog = [];
var msgNbrToShow = 5; // Number of messages to display.
var msgTurnsToShow = 10; // How many turns back should the messages be displayed.

// Player:
var userPos = {x:1,y:1};
var userName = "Nobody";
var haveWon = false;

var score = 100; // AKA energy, life, self
var turn = 0;
var visited = 0;
var keys = 0;
var kills = 0;

var staff = 0;
var staves = ["",
              " of <t style='color:#00008B'>E</t><t style='color:#1E90FF'>th</t><t style='color:#00FFFF'>er</t><t style='color:#1E90FF'>ea</t><t style='color:#00008B'>l</t> Paths",
              " of <t style='color:#00BFFF'>Frozen T</t><t style='background-color:#000000; color:#FFFFFF;'>i</t><t style='color:#00BFFF'>me</t>",
              " of <t style='color:#85C1E9'>Se</t><t style='background-color:#85C1E9; color:#FFFFFF;'>c</t><t style='color:#85C1E9'>ret</t> Paths",
              " of <t style='color:#32CD32'>L</t><t style='color:#DC143C'>i</t><t style='color:#32CD32'>fe Tr</t><t style='color:#DC143C'>i</t><t style='color:#32CD32'>um</t><t style='color:#1E90FF'>p</t><t style='color:#32CD32'>hant</t>",
              " of <t style='color:#000000; font-style: italic;'>Vor</t><t style='color:#282828; font-style: italic;'>pal </t><t style='color:#484848; font-style: italic;'>Sha</t><t style='color:#686868; font-style: italic;'>rpn</t><t style='color:#808080; font-style: italic;'>ess</t>",
              " of <t style='font-style: italic;'>Soa r i&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;g</t> Leap",
              " of <t style='color:#800080'>C</t><t style='color:#FF1493'>o</t><t style='color:#800080'>njuration</t>",
              " of <t style='color:#006400'>Bur</t><t style='color:#32CD32'>g</t><t style='color:#006400'>eonin</t><t style='color:#32CD32'>g</t>",
              " of <t style='color:#"+Math.random().toString(16).substr(2,6)+"'>P</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'>u</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'>r</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'>e</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'> C</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'>h</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'>a</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'>o</t><t style='color:#"+Math.random().toString(16).substr(2,6)+"'>s</t>",];
var staffDesc = ["with no enchantment can whack your enemies good, but unfortunately lacks magical powers",
                 "may open ephemeral bridges to faraway locations",
                 "can momentarily remove you from the flow of time, rendering all monsters and mechanisms frozen and unable to affect you",
                 "may reveal concealed corridors and crevices in nearby walls",
                 "can cleanse your body of all ills, or even save your life",
                 "will shred your enemies in a single strike",
                 "will propel you through the air, avoiding many obstacles or enemies in the way",
                 "can materialize the volatile energies of raw magic",
                 "may call forth the forces of Nature to pave your path and bewilder your foes",
                 "will alter your surroundings in unpredictable ways",];

var armor = 0;
var armors = ["<t style='color:#228B22'>Green Tunic</t>",
              "<t style='color:#696969; font-weight: 900;'>Fur</t> <t style='color:#8B4513'>Cloak</t>",
              "<t style='color:#D2B48C'>Pa</t><t style='color:#A52A2A'>dd</t><t style='color:#D2B48C'>e</t><t style='color:#A52A2A'>d</t><t style='color:#D2B48C'> Jacket</t>",
              "<t style='color:#8B4513'>Leather J</t><t style='color:#A52A2A'>ac</t><t style='color:#8B4513'>ket</t>",
              "<t style='color:#A52A2A'>Leather Arm</t><t style='color:#8B4513'>ou</t><t style='color:#A52A2A'>r</t>",
              "<t style='color:#A52A2A'>Qu</t><t style='color:#696969'>i</t><t style='color:#A52A2A'>lted Leather Armour</t>",
              "<t style='color:#A52A2A'>Stu</t><t style='color:#282828'>dd</t><t style='color:#A52A2A'>e</t><t style='color:#282828'>d</t><t style='color:#A52A2A'> Leather Armour</t>",
              "<t style='color:#CD5C5C'>Ch</t><t style='color:#F08080'>i</t><t style='color:#CD5C5C'>t</t><t style='color:#F08080'>i</t><t style='color:#CD5C5C'>n Cu</t><t style='color:#F08080'>i</t><t style='color:#CD5C5C'>rass</t>",
              "<t style='color:#8B4513'>Bri</t><t style='color:#282828'>g</t><t style='color:#8B4513'>an</t><t style='color:#282828'>d</t><t style='color:#8B4513'>ine</t>",
              "<t style='color:#C0C0C0'>Cha</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>n Sh</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>rt</t>",
              "<t style='color:#282828'>Bu</t><t style='color:#686868'>ll</t><t style='color:#282828'>etpr</t><t style='color:#686868'>oo</t><t style='color:#282828'>f Vest</t>",
              "<t style='color:#484848'>Sc</t><t style='color:#686868'>a</t><t style='color:#484848'>le Ma</t><t style='color:#282828'>i</t><t style='color:#484848'>l</t>",
              "<t style='color:#A52A2A'>Ironb</t><t style='color:#C0C0C0'>a</t><t style='color:#A52A2A'>rk Bre</t><t style='color:#C0C0C0'>a</t><t style='color:#A52A2A'>stpl</t><t style='color:#C0C0C0'>a</t><t style='color:#A52A2A'>te</t>",
              "<t style='color:#C0C0C0'>Cha</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>n Ma</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>l</t>",
              "<t style='color:#708090'>Haub</t><t style='color:#4682B4'>e</t><t style='color:#708090'>rk</t>",
              "<t style='color:#C0C0C0'>R</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>ng Ma</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>l</t>",
              "<t style='color:#A52A2A'>Ban</t><t style='color:#282828'>d</t><t style='color:#A52A2A'>e</t><t style='color:#282828'>d</t><t style='color:#A52A2A'> Armour</t>",
              "<t style='color:#484848'>Spl</t><t style='color:#282828'>i</t><t style='color:#484848'>nt Ma</t><t style='color:#282828'>i</t><t style='color:#484848'>l</t>",
              "<t style='color:#800080; font-weight: 900;'>Magic</t> <t style='color:#8B4513'>Cloak</t>",
              "<t style='color:#C0C0C0'>Half Pl</t><t style='color:#282828'>a</t><t style='color:#C0C0C0'>te Ma</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>l</t>",
              "<t style='color:#C0C0C0'>M</t><t style='color:#4682B4'>i</t><t style='color:#C0C0C0'>thr</t><t style='color:#4682B4'>i</t><t style='color:#C0C0C0'>l Cha</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>n Ma</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>l</t>",
              "<t style='color:#C0C0C0'>Full Pl</t><t style='color:#282828'>a</t><t style='color:#C0C0C0'>te Ma</t><t style='color:#282828'>i</t><t style='color:#C0C0C0'>l</t>",
              "<t style='color:#FF1493'>Crystal</t> <t style='color:#9932CC'>Shard</t> <t style='color:#8B008B'>Mail</t>",
              "<t style='color:#484848'>Dr</t><t style='color:#FF4500'>a</t><t style='color:#484848'>gon Sc</t><t style='color:#FF4500'>a</t><t style='color:#484848'>le Ma</t><t style='color:#FF4500'>i</t><t style='color:#484848'>l</t>",
              "<t style='color:#C4BE96'>H</t><t style='color:#B8860B'>e</t><t style='color:#C4BE96'>r</t><t style='color:#B8860B'>o</t><t style='color:#C4BE96'>ic Cuir</t><t style='color:#B8860B'>a</t><t style='color:#C4BE96'>ss</t>",
              "<t style='color:#D2B48C'>Stone Pl</t><t style='color:#F4A460'>a</t><t style='color:#D2B48C'>te Ma</t><t style='color:#F4A460'>i</t><t style='color:#D2B48C'>l</t>",
              "<t style='color:#FFD700'>S</t><t style='color:#B8860B'>o</t><t style='color:#FFD700'>lid G</t><t style='color:#B8860B'>o</t><t style='color:#FFD700'>ld Arm</t><t style='color:#B8860B'>o</t><t style='color:#FFD700'>ur</t>",
              "<t style='color:#8B008B'>Crystal</t> <t style='color:#9932CC'>Plate</t> <t style='color:#FF1493'>Mail</t>",
              "<t style='color:#A52A2A'>N</t><t style='color:#FF8C00'>e</t><t style='color:#A52A2A'>m</t><t style='color:#FF8C00'>ea</t><t style='color:#A52A2A'>n L</t><t style='color:#FF8C00'>io</t><t style='color:#A52A2A'>n H</t><t style='color:#FF8C00'>i</t><t style='color:#A52A2A'>d</t><t style='color:#FF8C00'>e</t>",
              "<t style='color:#4682B4'>Adamantine A</t><t style='color:#000000'>r</t><t style='color:#4682B4'>mou</t><t style='color:#000000'>r</t>",
              "<t style='color:#484848'>P</t><t style='color:#00BFFF'>o</t><t style='color:#484848'>w</t><t style='color:#00BFFF'>e</t><t style='color:#484848'>r</t><t style='color:#00BFFF'>e</t><t style='color:#484848'>d Arm</t><t style='color:#FF0000'>o</t><t style='color:#484848'>ur</t>"];
var glyph = 0;
var glyphs = ["",
              " of <t style='color:#FF4500'>Brim</t>s<t style='color:#FF4500'>tone</t>",
              " of <t style='color:#1E90FF'>Cl</t><t style='color:#000080'>ea</t><t style='color:#1E90FF'>nsing </t><t style='color:#000080'>W</t><t style='color:#1E90FF'>a</t><t style='color:#000080'>t</t><t style='color:#1E90FF'>e</t><t style='color:#000080'>rs</t>",
              " of <t style='color:#FF0000; font-weight: bold;'>Mor</t><t style='color:#8B0000; font-weight: bold;'>tal Ter</t><t style='color:#FF0000; font-weight: bold;'>ror</t>",
              " of <t style='color:#00008B'>E</t><t style='color:#1E90FF'>th</t><t style='color:#00FFFF'>er</t><t style='color:#1E90FF'>ea</t><t style='color:#00008B'>l</t> Escape",
              " of R<t style='background-color:#FF0000; color:#FFFFFF; font-weight: bold;'>e</t><t style='color:#FF0000'>tributi</t><t style='background-color:#FF0000; color:#FFFFFF; font-weight: bold;'>o</t>n",
              " of <t style='color:#DAA520'>In&#9930;ulnerability</t>",
              " of <t style='color:#808080'>Sha</t><t style='color:#686868'>do</t><t style='color:#484848'>wy</t> Escape",
              " of the <t style='color:#8A0303; font-family:URW Chancery L, cursive;'>Blood Knight</t>"];
var glyphDesc = ["will dull the blows of your enemies",
                 "shall nourish your Self when fed radiant, everburning fire",
                 "will let you wash away your ailments",
                 "shall strike fear in your foes and keep your own horrors at bay",
                 "may provide an ephemeral bridge away from peril",
                 "will make you answer violence with violence",
                 "can shield you from harm",
                 "may shroud you in intangible shadows",
                 "will let you sustain your Self with the lifeblood of your foes",];

// Status effects:
var aflame = 0;
var blinded = 0;
var bloodied = 0;
var confused = 0;
var hasted = 0;
var phased = 0;
var panicked = 0;
var poisoned = 0;
var stunned = 0;
var timestop = 0;
var ward = 0;

var leap = false;
var orb = false;

// Map tiles:
var emptyBlock = '&nbsp;';
var wallBlock = "<t style='background-color:#000000'>&#9608;</t>";
var tileWater = "<t style='background-color:#1E90FF'>~</t>";
var tileLava = "<t style='background-color:#FF4500'>~</t>";
var tileSludge = "<t style='background-color:#00FF00'>~</t>";
var tileBlood = "<t style='background-color:#8A0303'>~</t>";
var tileQuicksand = "<t style='background-color:#FFFF66; color:#DAA520;'>,</t>";
var tileIce = "<t style='background-color:#00BFFF; color:#FFFFFF;'>.</t>";
var tileBlindGas = "<t style='color:#696969'>#</t>";
var tileConfGas = "<t style='color:#FF1493'>#</t>";
var tileStunGas = "<t style='color:#FFFF00; font-weight: 900;'>#</t>";
var tileKey = "<t style='color:#800080'>9</t>";
var tileArmor = "<t style='color:#800080; font-weight: 900;'>]</t>"; //enchanted armor, normal is just ']'
var tileMobDoor = "<t style='background-color:#8B4513'>+</t>";
var tileGoldDoor = "<t style='background-color:#8B4513; color:#FFD700;'>+</t>";
var tileGoldWall = "<t style='color:#FFD700'>&#9608;</t>";
var tileStaff = "<t style='color:#800080; font-weight: 900;'>}</t>";
var tileTreasure = "<t style='color:#800080'>&#167;</t>";
var tileBramble = "<t style='color:#32CD32'>!</t>";
var tileNettles = "<t style='color:#DC143C'>!</t>";
var tileGrassTall = "<t style='color:#32CD32'>;</t>";
var tileGrassShort = "<t style='color:#32CD32'>.</t>";
var tileBloodDrop = "<t style='color:#8A0303'>.</t>";
var tileTreeStump = "<t style='color:#A52A2A; font-weight: 900;'>.</t>";
var tileTreeConif = "<t style='color:#006400; font-weight: 900;'>4</t>";
var tileTreeLeafy = "<t style='color:#32CD32'>8</t>";
var tileTreeDead = "<t style='color:#A52A2A; font-weight: 900;'>|</t>";
var tileBush = "<t style='color:#32CD32; font-weight: 900;'>%</t>";
//var tileMacGuffin = "<t style='color:#FF00FF'>&#9959;</t>"; maybe use as summoning circle?
var tileMacGuffin = "<t style='color:#8B008B'>&#9765;</t>";
var tileSecretPath = "<t style='color:#85C1E9'>&#9608;</t>";
var tileTeleporter = "<t style='color:#00FFFF'>0</t>";

var impassable = [wallBlock,tileGoldWall,tileGoldDoor,tileMobDoor,tileTreeConif,tileTreeLeafy,tileTreeDead,tileBush];
var liquids = [tileBlood,tileLava,tileQuicksand,tileSludge,tileWater];
var gases = [tileBlindGas,tileConfGas,tileStunGas];
var plants_small = [tileBramble,tileNettles,tileGrassTall,tileGrassShort,tileTreeStump];
var plants_large = [tileTreeConif,tileTreeLeafy,tileTreeDead,tileBush];
var terrain = ['.',',','^','?','$',tileWater,tileGrassTall,[tileBramble,tileNettles,tileQuicksand,plants_large]];
var terrain_rare = ['/','_',']',tileTeleporter,tileKey,[tileSludge,tileBlood,gases]];
var terrain_any = [emptyBlock,wallBlock,'.',',','?','^',tileWater,tileLava,tileSludge,tileBlood,tileQuicksand,tileIce,tileBlindGas,tileConfGas,tileStunGas,tileGoldWall,tileBramble,tileNettles,tileGrassTall,tileGrassShort,tileBloodDrop,tileTreeStump,tileTreeConif,tileTreeLeafy,tileTreeDead,tileBush,tileSecretPath,tileTeleporter,['$','/',[']','_',tileKey,emptyBlock,wallBlock]]];
var treasures = ['$',']','?','_','/',tileKey,tileArmor,tileStaff,tileTreasure,tileMacGuffin];

var creatureChar = "abcdefghijklmnopqrstuvwyzABCDEFGHIJKLMNOPQRSTUVWYZ&&@@".split('');
var creatureList = [{icon:"<t style='color:#FF0000'>&</t>",
                     name:"<t style='color:#FF0000'>Demon of Isolation</t>",
                     attack:"slams",
                     aggro:4,
                     x:0,y:0,
                     flags: [["boonphase"],["boontime"],["boonscore"],["boonhaste"]][r(4)], // Random boon on death.
                     behaviour: function(){ if(!r(6)) currentMap[this.x][this.y]=wallBlock; return false; }
                    }];
var allFlags = ["diagonal","venom","toxic","flame","agony","regen","blind","trapper","teleself","teleother","knockback","flingback","steal","bloodpool","lavapool","toxicpool","waterpool","sandpool","icepool","smoke","chaos","disenchant","convoke","panic","dodge","bloody","dispel","extend","extraattack","pierce","slow","esp","lifesaved","invulnerable","explode","phase","dig","boonphase","boontime","boonscore","boonhaste","dropscore","droppile","droptrap","worthless","confother","confgas","stunother","stungas","swap","jumpover","dumb","immobile","invisible"];
var attackVerbs = ["attacks","bashes","batters","bites","blasts","bleeds","buffets","chokes","claws","clobbers","clubs","crushes","cuts","disrupts","dissolves","freezes","gazes at","gores","headbutts","hits","impales","jabs","jolts","kicks","kisses","nibbles","pelts","pricks","pummels","punches","rends","rips","scratches","sears","shocks","slams","slaps","slashes","smacks","smashes","smites","splatters","squeezes","stabs","stings","stomps at","strangles","strikes","swats","thrashes","touches","tramples","whacks","whips","zaps"];
var currCre = [];
var mobBoss = {icon:"<t style='color:#8B008B'>X</t>",
               name:"<t style='color:#8B008B'>Reflection of True Self</t>",
               attack: attackVerbs[r(attackVerbs.length)],
               aggro:100,
               x:0,y:0,
               flags: ["diagonal","regen","lifesaved","esp","dodge","boss"],
               behaviour: function(){
                var i = currCre.indexOf(this);
                var j;
                var k;
                // Change randomly:
                this.icon = this.icon.replaceAt(17, Math.random().toString(16).substr(2,6));
                this.attack = attackVerbs[r(attackVerbs.length)];

                // Handle panicked boss:
                if(this.flags.includes("flee")){
                 if(distanceBetween(userPos,currCre[i])<2 && !r(4)){
                   teleportMob(i);
                   return true;
                 } else if(distanceBetween(userPos,currCre[i])>=2 && !r(3)){
                   this.flags = this.flags.removeElement("flee");
                   msg += this.name+" calms down. ";
                   return true;
                 }
                }

                // Special attacks:
                if(stepsBetween(userPos,currCre[i])<2){
                 msg += this.name+" "+this.attack+" you. ";
                 playerTakeDamage(r(20+distanceToOrigin())+visited,i);

                 switch(r(15)){
                  case 0:
                   msg += ["Half-forgotten","Repressed","Unwanted"][r(3)]+" memories stir deep in your mind. ";
                   confused += r(10)+5;
                  break;

                  case 1:
                   msg += "You feel unsteady. ";
                   stunned += r(kills)+5;
                  break;

                  case 2: case 3:
                   msg += "You are enveloped in hellfire. ";
                   aflame += r(visited)+r(visited)+r(visited);
                  break;

                  case 4: case 5: case 6:
                   msg += "You feel horribly ill. ";
                   poisoned += r(score/2);
                  break;

                  case 7:
                   msg += "Your eyes! You cannot see! ";
                   blinded += r(6)+2;
                  break;

                  case 8:
                   teleportUser();
                  break;

                  case 9: case 10: case 11:
                   var dx = userPos.x - currCre[i].x;
                   var dy = userPos.y - currCre[i].y;
                   if(inRangeCoords(userPos.x+dx,userPos.y+dy) && checkEmpty(userPos.x+dx,userPos.y+dy)){
                    userPos.x += dx;
                    userPos.y += dy;
                    msg += "You are knocked back. ";
                   }
                   break;

                  case 12:
                   var dx = userPos.x - currCre[i].x;
                   var dy = userPos.y - currCre[i].y;
                   var moved = 0;
                   while(inRangeCoords(userPos.x+dx,userPos.y+dy) && checkEmpty(userPos.x+dx,userPos.y+dy)){
                    userPos.x += dx;
                    userPos.y += dy;
                    moved += 1;
                   }
                   if(moved == 1)
                     msg += "You are knocked back. ";
                   else if(moved>1)
                     msg += "You are flung back. ";
                   break;

                  case 13:
                   msg += "You are showered in blood. ";
                   bloodied += 10+kills;
                   break;

                  case 14:
                   for(k=-1; k < 2; k++){
                    for(var l=-1; l < 2; l++){
                     if(inRangeCoords(this.x+k,this.y+l)){
                       // I will rather make doubly sure we're not checking outside the map's borders.
                       if(currentMap[this.x+k][this.y+l] == emptyBlock)
                         currentMap[this.x+k][this.y+l] = tileNettles;
                     }
                    }
                   }
                   msg += this.name+" sows the earth with blood and horror. ";
                   break;
                 }
                } else if(!r(4) && !this.flags.includes("flee")){
                 // Teleport near the player.
                 j = userPos.x + r(3)-1;
                 k = userPos.y + r(3)-1;
                 if(checkEmpty(j,k) && inRangeCoords(j,k) && (j != 0 || k != 0)){
                  currentMap[this.x][this.y] = '^';
                  this.x = j;
                  this.y = k;
                  msg += this.name+" disappears and suddenly reappears near you. ";
                 }
                } else {
                  if(distanceBetween(userPos,this)<5 && !r(4)){
                    msg += this.name+" smites you. ";
                    playerTakeDamage(r(10)+visited,i);
                    return true;
                  } else if(!r(2)) {
                    var x = r(3)-1;
                    var y = r(3)-1;
                    // We require at least two squares in given direction to be empty:
                    if(inRangeCoords(this.x+x,this.y+y) && checkEmpty(this.x+x,this.y+y) && checkEmpty(this.x+x+x,this.y+y+y) &&
                       !(userPos.x==this.x+x && userPos.y==this.y+y)){
                     msg += this.name+" conjures an orb of prismatic energy. ";
                     // Create an orb creature with behaviour that will move in one direction until blocked, then explode.
                     var mobOrb = {icon:"<t style='color:#800080'>*</t>",
                                   name:"<t style='color:#800080'>Prismatic Orb</t>",
                                   attack:"kamikazes",
                                   aggro:10, // Doesn't really matter.
                                   x:0, y:0,
                                   flags:[{x:x,y:y}, "explode"],
                                   behaviour: function(){
                                    // Change colour randomly:
                                    this.icon = this.icon.replaceAt(17, Math.random().toString(16).substr(2,6));
                                    // Move in one direction, then explode:
                                    var i = currCre.indexOf(this);
                                    if(tryMove(this.x+this.flags[0].x,this.y+this.flags[0].y,i)){
                                     doMove(this.x+this.flags[0].x,this.y+this.flags[0].y,i);
                                    } else {
                                     msg += currCre[i].name+" explodes. ";
                                     onExplosion(i);
                                    }
                                    return true;
                                   }
                                  };
                     currCre.push(mobOrb);
                     currCre[currCre.length-1].x = this.x+x;
                     currCre[currCre.length-1].y = this.y+y;
                    }
                  } else {
                    j = this.x + r(3)-1;
                    k = this.y + r(3)-1;
                    // Check adjacent square where we want to summon:
                    if(inRangeCoords(j,k) && checkEmpty(j,k)){
                      currCre.push(cloneCreature(creatureList[r(creatureList.length/2)]));
                      currCre[currCre.length-1].x = j;
                      currCre[currCre.length-1].y = k;
                      msg += this.name+" speaks a Word of Summoning. "+currCre[currCre.length-1].name+" appears out of thin air. ";
                    }
                  }
                }
                return false;
               }
              };
var mobIceBlock = {icon:"<t style='color:#00FFFF'>X</t>",
                   name:"<t style='color:#00FFFF'>Ice Block</t>",
                   attack:"freezes",
                   aggro:0,
                   x:0,y:0,
                   flags: ["worthless","slow"],
                   behaviour: function(){ return true; } // Ice block sits in place and does nothing.
                  };
var mobNames = {
  'a': ["Abortion","Abuse","Accusation","Addiction","Adversity","Aggression","Agony","Alienation","Anger","Anguish","Animosity","Annoyance","Anxiety","Apathy","Arrogance","Avarice"],
  'b': ["Bedlam","Betrayal","Bias","Bigotry","Bitterness","Blame","Blasphemy","Blemish","Boredom","Bravado","Browbeat"],
  'c': ["Carelessness","Clumsiness","Complacency","Compulsion","Conceit","Condescension","Contempt","Cowardice","Criticism","Cruelty","Cynicism","Chagrin"],
  'd': ["Debasement","Debauchery","Deceit","Deception","Dejection","Delirium","Delusion","Denial","Depression","Derision","Despair","Despise","Detriment","Deviation","Dilemma","Disappointment","Discomfort","Disdain","Disgrace","Disgust","Disillusionment","Dismay","Distraction","Distress","Doubts","Dread"],
  'e': ["Egomania","Egotism","Embarrassment","Emptiness","Enervation","Envy","Evil","Exasperation","Exclusion"],
  'f': ["Failure","Fallacy","Falsehood","Fanaticism","Farce","Fatigue","Fault","Fear","Ferocity","Filth","Flaw","Foul","Fraud","Fright","Frustration","Furor","Fussy","Futility"],
  'g': ["Gall","Garish","Gawk","Glum","Greed","Grief","Gripe","Grotesque","Grouch","Grudge","Guilt"],
  'h': ["Hallucination","Hatred","Havoc","Heartbreak","Hedonism","Helplessness","Hesitation","Hopelessness","Hostility","Hubris","Humiliation","Hypocrisy","Hysteria"],
  'i': ["Idiocy","Ignorance","Illusion","Immorality","Impatience","Impediment","Imperfection","Imprudence","Impudence","Inadequacy","Incest","Incivility","Incomprehension","Indecency","Indecision","Indifference","Indoctrination","Infamy","Inferiority","Infidelity","Infuriation","Injustice","Insanity","Insult","Intoxication","Irrationality","Irresponsibility","Irritation"],
  'j': ["Jealousy","Jeer","Jeopardy","Jerk","Jitter"],
  'k': ["Killjoy","Kleptomania","Kook","Krazyness"],
  'l': ["Lambast","Lament","Languish","Languor","Lapse","Leer","Lechery","Lethargy","Lewdness","Liability","Limitation","Loathing","Loneliness","Loss","Loveless","Lovelorn","Lunacy"],
  'm': ["Madness","Malaise","Malcontent","Malevolence","Malice","Malignant","Mania","Manipulation","Martyrdom","Mediocrity","Melancholy","Menace","Mendacity","Mercilessness","Misconception","Misery","Misfortune","Misgiving","Mishap","Mischief","Mistake","Mistrust","Mockery","Molestation","Morbidity","Mordant","Moribund","Mourning","Mystification"],
  'n': ["Nagging","Naivety","Nasty","Negativity","Negligence","Nepotism","Nervosity","Neurosis","Niggle","Nightmare","Nuisance","Numbness"],
  'o': ["Obesity","Obscenity","Obsession","Obstinacy","Obstruction","Obtrusivity","Oddity","Opposition","Oppression","Ordeal","Ostracism","Outcry","Outlaw","Outrage"],
  'p': ["Pain","Paltry","Pander","Paranoia","Pariahhood","Paucity","Pauper","Peeve","Peril","Perplexion","Persecution","Perversion","Pessimism","Pestilence","Phobia","Pique","Pity","Plight","Ploy","Pointlessness","Pomp","Pout","Poverty","Prattle","Predicament","Prejudice","Presumption","Pretension","Prick","Procrastination","Profanity","Provocation","Pugnacity"],
  'q': ["Quack","Qualm","Quandry","Quarrel","Quibble"],
  'r': ["Racism","Rage","Rancour","Rankle","Ranting","Rape","Rashness","Raving","Rebuff","Recalcitrance","Recklessness","Recourse","Refusal","Regress","Regret","Rejection","Relapse","Reluctance","Remorse","Renunciation","Reprehension","Repression","Reproach","Reproval","Repudiation","Repulsion","Resentment","Resignation","Restlessness","Restriction","Revenge","Revulsion","Ridicule","Rigidity","Rivalry","Rudeness","Ruthlessness"],
  's': ["Sadness","Sarcasm","Sass","Satire","Savagery","Scam","Scandal","Scarcity","Scathing","Scoff","Scold","Scorn","Scourge","Scowl","Scum","Selfishness","Senility","Servitude","Sham","Shame","Shock","Shortage","Shrew","Shunning","Sickness","Sin","Scepticism","Slander","Slaughter","Sleaze","Slog","Sloppiness","Sloth","Slump","Slur","Smugness","Snag","Snark","Sneer","Snobbery","Snub","Sob","Solitude","Sorrow","Spite","Spook","Spurn","Squabble","Squander","Stagnation","Stammer","Stigma","Stooge","Stress","Strife","Struggle","Stupidity","Stupor","Stutter","Subjugation","Submission","Subservience","Subversion","Sucker","Suffering","Sulk","Sully","Superstition","Suspicion","Swagger"],
  't': ["Taboo","Taint","Tantrum","Tarnish","Taunt","Tawdry","Tease","Tedium","Temper","Temptation","Tension","Terror","Tetchy","Timidity","Toil","Torment","Torture","Tout","Toxicity","Tragedy","Tramp","Transgression","Trauma","Travesty","Treachery","Treason","Trickery","Trouble","Truant","Turmoil","Tyranny"],
  'u': ["Ugliness","Uncaring","Uncertainty","Uncleanness","Underestimation","Unease","Unfortune","Unhappiness","Unimportance","Unrest","Upheaval","Uproar","Upset","Usurpation"],
  'v': ["Vagrancy","Vainglory","Vanity","Vehemence","Vengeance","Vexation","Vice","Viciousness","Vile","Villainy","Vindictiveness","Violation","Volatility","Vulgarity","Vulnerability"],
  'w': ["Wail","Wanton","Wariness","Wastefulness","Weakness","Weariness","Whining","Wickedness","Wilt","Wily","Wimp","Woe","Worry","Worst","Wrath","Wreak","Wretch","Wrong"],
  'x': ["Xanthosis","Xenophobia"],
  'y': ["Yearning","Yen","Yoke","Yuck"],
  'z': ["Zealotry","Zilch","Zit"],
};
var mobSelves = ["Self-Abnegation","Self-Absorption","Self-Abuse","Self-Aggrandizement","Self-Censorship","Self-Complacency","Self-Conceit","Self-Congratulation","Self-Contempt","Self-Contradiction","Self-Criticism","Self-Deceit","Self-Defeat","Self-Defilement","Self-Delusion","Self-Denial","Self-Deprecation","Self-Discrimination","Self-Disgust","Self-Doubt","Self-Flattery","Self-Gratification","Self-Guilt","Self-Harm","Self-Hatred","Self-Importance","Self-Incrimination","Self-Indulgence","Self-Justification","Self-Loathing","Self-Love","Self-Obsession","Self-Pity","Self-Praise","Self-Recrimination","Self-Reproach","Self-Sabotage","Self-Sacrifice","Self-Satisfaction"];

function getMobBehaviour(){
 switch(r(300)){
  //TODO: more behaviours
  default:
   return function(){ return false; };

  case 0:
   return function(){
    if(!r(4) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileWater;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" tears up. ";
    }
    return false;
   };

  case 1:
   return function(){
    if(!r(2) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileGrassTall;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" plants a seed. ";
    }
    return false;
   };

  case 2:
   return function(){
    if(!r(6) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileBramble;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" plants a seed. ";
    }
    return false;
   };

  case 3:
   return function(){
    if(!r(6) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileNettles;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" plants a seed. ";
    }
    return false;
   };

  case 4:
   return function(){
    if(!r(6) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileSludge;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" vomits a torrent of sludge. ";
    }
    return false;
   };

  case 5:
   return function(){
    if(!r(6) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileLava;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" vomits a torrent of magma. ";
    }
    return false;
   };

  case 6:
   return function(){
    if(!r(4) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileBlindGas;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" breathes out dark fumes. ";
    }
    return false;
   };

  case 7:
   return function(){
    if(!r(4) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileBlood;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" bleeds profusely. ";
    }
    return false;
   };

  case 8:
   return function(){
    if(!r(6) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = '^';
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" fiddles with something on the ground. ";
    }
    return false;
   };

  case 9:
   return function(){
    if(!r(2) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = ',';
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" leaves something behind. ";
    }
    return false;
   };

  case 10:
   return function(){
    if(!r(6) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = '?';
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" leaves something behind. ";
    }
    return false;
   };

  case 11: // Conjure orbs.
   return function(){
     var x = r(3)-1;
     var y = r(3)-1;
     // We require at least two squares in given direction to be empty:
     if(!r(4) && inRangeCoords(this.x+x,this.y+y) && checkEmpty(this.x+x,this.y+y) && checkEmpty(this.x+x+x,this.y+y+y) &&
        !(userPos.x==this.x+x && userPos.y==this.y+y)){
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" conjures an orb of prismatic energy. ";
      // Create an orb creature with behaviour that will move in one direction until blocked, then explode.
      var mobOrb = {icon:"<t style='color:#800080'>*</t>",
                    name:"<t style='color:#800080'>Prismatic Orb</t>",
                    attack:"kamikazes",
                    aggro:10, // Doesn't really matter.
                    x:0, y:0,
                    flags:[{x:x,y:y}, "explode"],
                    behaviour: function(){
                     // Change colour randomly:
                     this.icon = this.icon.replaceAt(17, Math.random().toString(16).substr(2,6));
                     // Move in one direction, then explode:
                     var i = currCre.indexOf(this);
                     if(tryMove(this.x+this.flags[0].x,this.y+this.flags[0].y,i)){
                      doMove(this.x+this.flags[0].x,this.y+this.flags[0].y,i);
                     } else {
                      msg += currCre[i].name+" explodes. ";
                      onExplosion(i);
                     }
                     return true;
                    }
                   };
      currCre.push(mobOrb);
      currCre[currCre.length-1].x = this.x+x;
      currCre[currCre.length-1].y = this.y+y;
      return true;
     }
     else
       return false;
   };

  case 12: // Summon random monsters.
   return function(){
     if(r(10))
       return false;

     var j = this.x + r(3)-1;
     var k = this.y + r(3)-1;
     if(inRangeCoords(j,k) && checkEmpty(j,k)){
      currCre.push(cloneCreature(creatureList.sampleRec()));
      currCre[currCre.length-1].x = j;
      currCre[currCre.length-1].y = k;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" speaks a Word of Summoning. "+currCre[currCre.length-1].name+" appears out of thin air. ";
      return true;
     }
     return false;
   };

  case 13: // Spawn more of self.
   return function(){
     if(r(20))
       return false;

     var j = this.x + r(3)-1;
     var k = this.y + r(3)-1;
     if(inRangeCoords(j,k) && checkEmpty(j,k)){
      currCre.push(cloneCreature(this));
      currCre[currCre.length-1].x = j;
      currCre[currCre.length-1].y = k;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" procreates. ";
      return true;
     }
     return false;
   };

  case 14: // Teleport randomly.
   return function(){
     if(!r(10) || this.flags.includes("flee")){
       var j;
       var k;
       do {
        j = r(mapWidth);
        k = r(mapWidth);
       } while(!checkEmpty(j,k));
       this.x = j;
       this.y = k;
       if(distanceBetween(userPos,this)<10)
         msg += this.name+" teleports. ";
     }
     return false;
   };

  case 15: // Teleport near the player.
   return function(){
     if(distanceBetween(userPos,this)>2 && !r(10) && !this.flags.includes("flee")){
      var j = userPos.x + r(3)-1;
      var k = userPos.y + r(3)-1;
      if(checkEmpty(j,k) && inRangeCoords(j,k) && (j != 0 || k != 0)){
       this.x = j;
       this.y = k;
       msg += this.name+" disappears and suddenly reappears near you. ";
      }
     }
     return false;
   };

  case 16:
   return function(){
     if(distanceBetween(userPos,this)<7 && !r(5)){
      bloodied += r(10)+10;
      msg += this.name+" curses you! Bleeding wounds open on your body. ";
      return true;
     }
     return false;
   };

  // case 17:
  //  return function(){
  //    var dx = this.x - userPos.x;
  //    var dy = this.y - userPos.y;
  //    if(distanceBetween(userPos,this)<11 && (dx==0 || dy==0) &&
  //       checkFreeLineBetween(userPos,this) && !r(5)){
  //      msg += this.name+" shoots you. ";
  //      playerTakeDamage(r(10+distanceToOrigin())+visited,currCre.indexOf(this));
  //      return true;
  //    }
  //    return false;
  //  };

  case 18:
   return function(){
     if(distanceBetween(userPos,this)<5 && !r(4)){
       msg += this.name+" smites you. ";
       playerTakeDamage(r(10+distanceToOrigin())+visited,currCre.indexOf(this));
       return true;
     }
     return false;
   };

  case 19:
   return function(){
    if(!r(4) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileConfGas;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" breathes out noxious fumes. ";
    }
    return false;
   };

  case 20:
   return function(){
    if(!r(4) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileStunGas;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" breathes out fetid fumes. ";
    }
    return false;
   };

  case 21:
   return function(){
    if(!r(6) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileQuicksand;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" brings about a miniature sandstorm. ";
    }
    return false;
   };

  case 22:
   return function(){
     if(distanceBetween(userPos,this)<7 && !r(5)){
      confused += r(10)+10;
      msg += this.name+" curses you! "+["Half-forgotten","Repressed","Unwanted"][r(3)]+" memories stir deep in your mind. ";
      return true;
     }
     return false;
   };

  case 23:
   return function(){
     if(distanceBetween(userPos,this)<7 && !r(5)){
      stunned += r(10)+10;
      msg += this.name+" curses you! You suddenly feel very unsteady. ";
      return true;
     }
     return false;
   };

  case 24:
   return function(){
    if(distanceBetween(userPos,this)<5 && !r(6)) {
      var sq = [{x:userPos.x-1,y:userPos.y},{x:userPos.x+1,y:userPos.y},{x:userPos.x,y:userPos.y-1},{x:userPos.x,y:userPos.y+1}];
      var blocks = 0;
      for (var i = 0; i < sq.length; i++) {
          if(inRangeCoords(sq[i].x,sq[i].y) && checkEmpty(sq[i].x,sq[i].y)) {
            currCre.push(cloneCreature(mobIceBlock));
            currCre[currCre.length-1].x = sq[i].x;
            currCre[currCre.length-1].y = sq[i].y;
            blocks += 1;
          }
      }
      if(blocks>0)
        msg += this.name+" encases you in an icy prison. ";
    }
    return false;
   };

  case 25:
   return function(){
    if(!r(2) && currentMap[this.x][this.y] == emptyBlock){
      currentMap[this.x][this.y] = tileIce;
      if(distanceBetween(userPos,this)<10)
        msg += this.name+" freezes the ground. ";
    }
    return false;
   };
 }
}

function getMobFlags(){
 var mobFlags = [];

 while(!r(creatureList.length+2) || (r(creatureList.length)>20)){
  var nextFlag = allFlags.sampleRec();
  if(!mobFlags.includes(nextFlag)) mobFlags.push(nextFlag);
  else break;
 }

 return mobFlags;
}

function getMobName(letter){
  letter = letter.toLowerCase();

  if(letter.match(/[a-z]/i))
    return mobNames[letter].pop();
  else
    return mobSelves.pop();
}

function getUserChar(){
 var colour = 'red';
 if(poisoned>0) colour = '#00FF00';
 else if(confused>0) colour = '#FF1493';
 else if(phased>0) colour = '#4B0082';
 else if(timestop>0) colour = '#00BFFF';
 else if(ward>0) colour = '#DAA520';

 var bkg = '';
 if(currentMap[userPos.x][userPos.y] == tileWater) bkg = 'background-color:#1E90FF; ';
 else if(currentMap[userPos.x][userPos.y] == tileLava) bkg = 'background-color:#FF4500; ';
 else if(currentMap[userPos.x][userPos.y] == tileSludge){
   colour = '#000000';
   bkg = 'background-color:#00FF00; ';
 }
 else if(currentMap[userPos.x][userPos.y] == tileBlood){
   colour = '#000000';
   bkg = 'background-color:#8A0303; ';
 }
 else if(currentMap[userPos.x][userPos.y] == tileIce){
   bkg = 'background-color:#00BFFF; ';
   if(colour == '#00BFFF')
     colour = 'red';
 }
 else if(currentMap[userPos.x][userPos.y] == tileQuicksand) bkg = 'background-color:#FFFF66; ';
 else if(currentMap[userPos.x][userPos.y] == wallBlock && phased>0){
   colour = '#FFFFFF';
   bkg = 'background-color:#000000; ';
 }

 return "<t style='"+bkg+"color:"+colour+"; font-weight: 900;'>@</t>";
}

function r(x){return Math.floor(Math.random() * x);}

var fname = ["Wyatt","Girbach","Galven","Jacinto","Scofield","Donovan","Hyden","Carter","Bucanan","Jann","Armand","Frakes","Willian","Leath","Cordell","Weyer","Crystal","Chalet","Genevive","Lavigne","Jeneva","Lavanchy","Naida","Dowe","Cayla","Armiger","Saturnina","Strachan","Rosette","Voight","Arlean","Sharpey","Matha","Hammacher","Jani","Lockley","Genni","Cherniako","Sandri","Bukheva","Fruri","Sautova","Zivast","Grindina","Raldi","Kovskina","Alell","Seva","Atiin","Seiniko","Tini","Echkov","Fani","Dova","Adir","Kourina","Nata","Ronova","Adkarya","Cheva","Zinia","Limova","Saba","Benkovoi","Albina","Penrova","Xena","Ginieksi","Lana","Dinova","Rina","Shukova","Vikta","Gounova","Zina","Wes","McRaven","Darwin","Blackford","Edison","Ghelfi","Arden","Maille","Lucius","Simril","Branden","Wethern","Brendon","Rosek","Nolan","Carthen","Koerner","Merlin","Haught","Lorilee","Reade","Britteny","Moneaux","Camila","Jennell","Woldt","Maris","Yueh","Edra","Calder","Alder","Denyse","McLaren","Maryln","Caldera","Zsand","Gleep","Wurp","Ul","Thok","Meem","Pubb","Skremp","Nex","Drub","Vree","Gooch","Hargag","Doop","Wozz","Furge","Forby","Grog","Dapp","Kor","Blim","Yar","Tzim","Ursk","Pizzle","Pang","Dhun","Rool","Rapp","Lorg","Xim","Hrum","Bogg","Krotch","Stith","Boof","Tankle","Mooth","Hagat","Raco","Thwyp","Bazh","Stroot","Crad","Ramst","Wump","Mugg","Din","Voll","Gant","Ylur","Paag","Hool","Hass","Stroop","Sass","Ambro","Quisp","Burzy","Koz","Mazz","Rump","Krang","Hulm","Gax","Nex","Glum","Zoot","Jank","Oort","Nex","Molp","Ferd","Sundar","Pipt","Mo","Urz","Ygg","Yann","Tunn","Bipp","Vela","Bork","Ryz","Milsh","Chook","Nabb","Val","Ernst","Bock","Hyggs","Chum","Izzy","Zur","Kal","Uk","Ur","Mon","Joff","Pyu","Kramm","James","John","Robert","Michael","William","David","Richard","Joseph","Thomas","Charles","Christopher","Daniel","Matthew","Anthony","Donald","Mark","Paul","Steven","Andrew","Kenneth","George","Joshua","Kevin","Brian","Edward","Ronald","Timothy","Jason","Jeffrey","Ryan","Jacob","Gary","Nicholas","Eric","Stephen","Jonathan","Larry","Justin","Scott","Brandon","Frank","Benjamin","Gregory","Raymond","Samuel","Patrick","Alexander","Jack","Dennis","Jerry","Tyler","Aaron","Henry","Jose","Douglas","Peter","Adam","Nathan","Zachary","Walter","Kyle","Harold","Carl","Jeremy","Gerald","Keith","Roger","Arthur","Terry","Lawrence","Sean","Christian","Ethan","Austin","Joe","Albert","Jesse","Willie","Billy","Bryan","Bruce","Noah","Jordan","Dylan","Ralph","Roy","Alan","Wayne","Eugene","Juan","Gabriel","Louis","Russell","Randy","Vincent","Philip","Logan","Bobby","Harry","Johnny","Mary","Patricia","Jennifer","Linda","Elizabeth","Barbara","Susan","Jessica","Sarah","Margaret","Karen","Nancy","Lisa","Betty","Dorothy","Sandra","Ashley","Kimberly","Donna","Emily","Carol","Michelle","Amanda","Melissa","Deborah","Stephanie","Rebecca","Laura","Helen","Sharon","Cynthia","Kathleen","Amy","Shirley","Angela","Anna","Ruth","Brenda","Pamela","Nicole","Katherine","Samantha","Christine","Catherine","Virginia","Debra","Rachel","Janet","Emma","Carolyn","Maria","Heather","Diane","Julie","Joyce","Evelyn","Joan","Victoria","Kelly","Christina","Lauren","Frances","Martha","Judith","Cheryl","Megan","Andrea","Olivia","Ann","Jean","Alice","Jacqueline","Hannah","Doris","Kathryn","Gloria","Teresa","Sara","Janice","Marie","Julia","Grace","Judy","Theresa","Madison","Beverly","Denise","Marilyn","Amber","Danielle","Rose","Brittany","Diana","Abigail","Natalie","Jane","Lori","Alexis","Tiffany","Kayla","Bo","Dave"];
var nname = ["Ace","Lefty","Shorty","Too-Tall","Fatty","Skinny","Jackass","Deadeye","Hawkful","Toothless","All-In","Double-Down","Stabby","Cutter","Punchy","Drippy","Tubs","Stinky","Baldy","Half-Hand","One-Eye","Rotgut","Doom-breath","Cheesey","Cookie","Spanky","Squirt","Britches","Helmet-Head","Mush-mouth","Marbles","Crazy-Legs","Scooter","Daredevil","Pinky","Prettyboy","Loverboy","Firebug","Cutthroat","Eviscerator","Belly-shot","Rumble-belly","Grumpy","Happy","Lucky","The Bastard","Fingers","Lips","Gold-bug","Fangs","Stumpy","Knuckles","Knuckle-dragger","Eyebrows","Hunchback","Honest","Songbird","Itchy","Scratchy","Booze-hound","Dirty","Dingy","Dingbat","Goofball","Sheep-lover","Bloodshot","Ladies' Man","Dapper","Diamond","The Dandy","Hit-man","Bird-man","Breakout","Wipeout","Dusty","Cottonmouth","Sweet","Rattlesnake","Ox","Ogre","Two-Ton","The Card-Sharp","Chuckles","Funnyman","Undertaker","Gravedigger","Goldie","Poet","Doc","Little","Big","Old","Young","the Kid","Smash-mouth","Whiskey","Ice-man","Reverend","Crusher","Hoss","Snake","Admiral","Bird","Fuzz","Flame","Magician","Barber","Dandy","Twinkle Toes","Blush","Cobra","Yank","Sailor","Cloud","Bobo","Pugs","Bash","Shade","Pipi","Mitzi","Toon","Jewel","Angel","Tiny","Hammer","Blade","Mistletoe","Mugsy","Rouge","Dazzle","Rebel","Merry","Butch","Brick","Grim","Mayor","Arrow","Killer","Prince","Silly","Chipper","Sparrow","Dino","Stretch","Piggy","Butterfly","Bugs","Scruffy","Stout","Ruin","Jumbo","Chief","Sizzle","Freak","Vanilla","Grouch","Brow","Pops","Bad Boy","Fury","Hawk","Buster","Dummy","Berry","Joker","Sassy","Pogo","Pug","Hurricane","Moose","Crow","Robin","Slash","Miracle","Boomer","Jackal","Speed","Bingo","Bitsy","Beard","Honey","Beau","Cuddles","Mutt","Bigby","Queenie","Silence","Spud","Bull","Braveheart","Shadow","Stone","Magica","Mad Dog","Fuzzy","Blue","Bigshot","Spuds","Horse","Skippy","Daring","Marvel","Aggy","Red","Terminator","Bones","Worm","Gentle","Deedee","Major","Thunder","Slim","Nimble","Vulture","Thief","Trey","Pretzel","Stuffy","Gibby","Knight","Ziggy","Viper","Coocoo","Smasher","Glider","Darlin","Buck","Chuck","Lock","Beauty","Landslide","Fish","Dutch","Pig","Bambam","Dream","Black Magic","Dodo","Boogie","Mamba","Trouble","Tigress","Biggie","Creed","Tiger","Feathers","Silver","of the Seven Potencies","Grand Terakion","Devourer of Chaos","the White Crow","Bringer of Prophecy","Benevolent Bringer of Chaos","of the Indivisible Chrome","Master of the Mindless Fist","Weaver of Rainbow's Thread","Sailor of the Twenty-One Trials","Unwritten in the Endless Tome of Time","Prince of the Harlequins","Carver of Dragon Teeth","Herald of the False Prophet","Lion Among Men","the Thrice-Cursed","Merrymaker Extraordinaire","Voice of the Desert","First of the Chosen","Deathslayer","the Damned","of the Forbidden Sea","of the Bells","Adjudicator","Dragonblood","of Many Faces","the Noble Coward","the Hussar","Fellblade","the Fine-Fingered","Feyborne","First Voice of the Crimson Choir","Midnight's Squire","the Frozen Tyrant","the Graven","Mistress of the End","First Gate of the Winding Road","the Hunger Immemorial","Herald of Falling Stars","the Beckoning Quiet","the King of Fools","of the Hallowed Skies","the Last March","the Wild Walker","the Unblemished","the Moon Seer","the Answer","the Night Stalker","the Great Bear","the Unbroken","Honour's Blade","the Boulder","the Scarlet Lion","the Unyielding Anvil","the Iron Commander","Fate Breaker","Kingseeker","the Entitled","Ocean Drinker","Lord of the Dance","of the Great Tower","Earthbinder","of the Poisoned Mind","Terror of the Deeps","Bearer of the Unseeing Eye","the Burdened One","Eternal Servant of the Weave","of the Boundless Possibilites","the Eternal","First to Desire","Valiant Protector","Born of Ash","Suntouched","who Smiles at Death","the Ruin Sage","Embraced by the Moon","the Unyielding","Treachery Incarnate","Protector of Hope","the Fading Light","the Promised End","Reality Sculptor","Keeper of Silence","the Black Rose","Apostle of Dusk","the Bloodied","the Crusher","War Tooth","the Generous","Underfoot","Hart-Footed","Witch-Breaker","Horse Lord","the Wisest","Grim Face","North Bound","Little Bear","the Fair","the Crow","the Amorous","the Frantic","the Old","the Stout","Deep Drinker","the Swarthy","Battle-wise","the Learned","Deep Delver","the Champion","the Giant","Far-traveling","Longshanks","the Small","Silvertongue","Stormcrow","Billygoat","the Leech","Star-eyed","Longbeard","the Wild","Bee Friend","the Burned","the Subtle","the Clever","the Young","Gold-friend","Death's Friend","Half-Troll","the Gray","the Judge","Bee Stung","the Dreamer","Thick-skulled","the Hound","He-Man","Iron-side","Moon Jumper","the Quiet","the Gentle","the Unborn","Fox-bearded","the Red","Bald Pate","the Exile","Sword-splitter","the Bright","Far-seer","the Proud","the Fortunate","the Honest","the Unbowed","the Leaper","the Pious","the Lecherous","the Stingy","the Careless","the Crafty","the Diligent","the Innocent","the Blind Visionary","the Brilliant Mind","the Eternal Hunger","Gentle Heart","Light Lord","Lone Wolf","Love Fool","Loyal Heart","Nimble Mind","the Risen","Secret Master","the Unsung Hero","Grey Knight","Cheap Shot","the Bright One","Dead Mind","the Fake King","Ill Tempered","the Lost Hope","the Last Song","Numb Mind","Tragic Eyes","the Wandering Mind","from Above","from Afar","from Below","the Adept","the Albino","the Antiquarian","the Arcane","the Archaic","the Barbarian","the Batrachian","the Battler","the Bilious","the Bold","the Brave","the Civilized","the Collector","the Cryptic","the Curious","the Dandy","the Daring","the Decadent","the Delver","the Distant","the Eldritch","the Exotic","the Explorer","the Fearless","the Fickle","the Foul","the Furtive","the Gambler","the Ghastly","the Gibbous","the Great","the Grizzled","the Gruff","the Hairy","the Bald","the Haunted","the Heavy","the Hooded","the Hunter","the Imposing","the Irreverent","the Loathsome","the Loud","the Lovely","the Mantled","the Masked","the Merciful","the Mercurial","the Mighty","the Morose","the Mutable","the Mysterious","the Obscure","the Ominous","the Peculiar","the Perceptive","the Quick","the Ragged","the Ready","the Rough","the Rugose","the Scarred","the Searcher","the Shadowy","the Short","the Steady","the Uncanny","the Unexpected","the Unkonwable","the Verbose","the Vigorous","the Wanderer","the Wary","the Weird","of the Arid Wastes","of the Beetling Brow","of the Cyclopean City","of the Dread Wilds","of the Eerie Eyes","of the Foetid Swamp","of the Forgotten City","of the Haunted Heath","of the Hidden Valley","of the Howling Hills","of the Jagged Peaks","of the Menacing Mien","of the Savage Isle","of the Tangled Woods","of the Watchful Eyes","the Lean","the Cowled","the Veiled","the Merciless","the Tall"];
var lname = ["Cagrant","Ustrando","Filius","Scaramanx","Heptimus","Ostrio","Honkus","Agylo","Primbaster","Glindal","Fargle","Grungo","Marworn","Sealor","Boon","Immuth","Yorgach","Klimp","Aster","Gonk","Dundrah","Fantonius","Gaggamore","Vorch","Saunder","Stacha","Addic","Punja","Tatak","Ornul","Khard","Ingrot","Anzel","Nobbilo","Pranxa","Xanadar","Zoopulus","Kromulo","Emzen","Woostifer","Mirthby","Kragamut","Shemiver","Rumtally","Imbrabinus","Ploob","Essem","Kroyden","Gullencast","Flixmander","Bolzagorath","Ummork","Plindle","Durgadang","Manchiver","Oodal","Leegand","Bosko","Haflump","Mordvey","Fernison","Glamgam","Orstrak","Kunstanticus","Ergon","Dassadal","Bleestocles","Wilverham","Zelligant","Irshal","Umber","Happalapa","Zorkon","Thurbert","Maxipoom","Donzany","Klarkash","Merjam","Elziger","Ashteban","Mercoolio","Cazio","Hurlen","Vlamdibulus","Hargus","Bomgoster","Geliphant","Trangol","Moorgang","Gronwhist","Chrontiphar","Lalifax","Raglio","Trulhamar","Linkat","Vergath","Mungo","Rakkatak","Lazorz","Nysbustah","Abeodan","Acwel","Aelle","Agyfen","Aheawan","Alchfrith","Aldhelm","Alfred","Algar","Alger","Almund","Alwin","Andettan","Andsaca","Andswaru","Andwyrdan","Ane","Archerd","Archibald","Arlice","Astyrian","Avery","Baldlice","Bana","Banan","Bar","Bawdewyn","Beadurinc","Benoic","Benwick","Besyrwan","Betlic","Bronson","Caedwalla","Caflice","Camden","Chapman","Cynewulf","Cynn","Dalston","Deogol","Derian","Drefan","Dreogan","Eadig","Eadlyn","Eamon","Ecgfrith","Edmund","Eldrid","Eorl","Farmon","Garrett","Geoff","Gildas","Gimm","Graeme","Grendel","Grimbold","Grimme","Halig","Ham","Landry","Lange","Lar","Leax","Leng","Leof","Lin","List","Lufian","Manton","Norville","Odi","Odin","Oswine","Peada","Perry","Pierce","Prasutagus","Ramm","Rand","Rinc","Ro","Rypan","Scrydan","Seward","Sihtric","Stearc","Stedman","Swift","Tamar","Tolan","Trace","Waelfwulf","Winter","Wissian","Worthington","Acca","Aedre","Aefentid","Aefre","Aethelflaed","Aethelthryth","Alodia","Alodie","Andsware","Anlicnes","Annis","Ar","Ardith","Arianrod","Ashley","Audrey","Bearrocscir","Bernia","Bisgu","Bletsung","Bliss","Blythe","Bodicea","Brigantia","Brimlad","Bysen","Cartimandua","Cearo","Chelsea","Claennis","Clover","Cwen","Cryst","Daedbot","Daisy","Darel","Darelene","Darelle","Darline","Daryl","Dawn","Devona","Dohtor","Don","Eacnung","Eadgyth","Easter","Eda","Edith","Edlyn","Edmunda","Edrys","Eldrida","Elene","Elga","Ellenweorc","Ellette","Elswyth","Elva","Elvina","Engel","Eostre","Erlina","Esma","Estra","Etheswitha","Freya","Garmangabis","Hamia","Harimilla","Hilda","Ifield","Juliana","Kendra","Linette","Lora","Loretta","Lyn","Mae","Maida","Megan","Mercia","Moira","Nelda","Nerthus","Odelia","Ora","Orva","Osberga","Rheda","Rowena","Sibley","Silver","Sulis","Sunniva","Tate","Udele","Viradecthis","Wilda","Willa"];
var words = ["Absolute","Absorb","Abyss","Acid","Addict","Addiction","Aegis","After","Age","Ailment","Air","Albatross","Alcohol","Altar","Alter","Always","Amber","Analyse","Anchor","Angel","Anger","Animal","Animate","Ant","Antelope","Antennae","Anti","Antler","Ape","Apocalypse","Appendage","Appendix","Arc","Arm","Armadillo","Armor","Arrow","Artery","Ash","Ask","Astral","Attack","Attract","Aura","Aurora","Avenge","Awaken","Away","Axe","Baboon","Back","Badger","Bag","Balance","Ball","Bamboo","Bandage","Bane","Banish","Bark","Barren","Barrier","Basalt","Bat","Beacon","Beak","Beam","Bear","Beard","Beast","Beaver","Become","Bee","Beer","Beetle","Belch","Bellow","Belly","Bend","Bestow","Bewilder","Beyond","Bezoar","Bind","Bite","Black","Blade","Blasphemous","Blast","Blight","Blind","Blink","Blob","Block","Blood","Bloodhound","Blossom","Blow","Blue","Boar","Boat","Body","Boil","Bolt","Bone","Bones","Book","Bow","Brain","Breath","Breathe","Breed","Brew","Bridge","Brine","Bronze","Brown","Brush","Bubble","Build","Bull","Burn","Butterfly","Bypass","Cabal","Call","Camel","Cancel","Candle","Carapace","Carbon","Carry","Carving","Cascade","Cat","Cauldron","Centipede","Chain","Chameleon","Change","Changeling","Chaos","Chariot","Charisma","Charm","Cheat","Cheetah","Child","Chill","Choke","Circle","City","Clap","Claw","Clay","Clean","Cleric","Clinging","Cloak","Clockwork","Clone","Close","Cloth","Cloud","Cloying","Cockroach","Code","Coil","Colossus","Colour","Comb","Combine","Come","Command","Communicate","Communion","Compel","Conceal","Conduit","Cone","Confuse","Confusion","Conjure","Constitution","Consume","Contact","Contaminate","Contemplate","Continual","Control","Copper","Copy","Core","Corpse","Corrupt","Coruscatory","Cough","Courage","Cowardice","Coyote","Craft","Cranial","Crawl","Create","Creep","Cricket","Crime","Crocodile","Cross","Crouch","Crow","Crown","Crush","Cry","Crystal","Cube","Cult","Cure","Curse","Dagger","Damn","Dance","Dark","Darkness","Dash","Day","Dead","Deafen","Death","Decay","Deceive","Decimate","Decipher","Deer","Defend","Degenerate","Delay","Demon","Desecrate","Desire","Detect","Detonation","Devil","Devour","Dexterity","Diamond","Dig","Digestion","Dimension","Diminish","Direction","Dirt","Disc","Discord","Disease","Disembowel","Disguise","Disgust","Disk","Dismember","Dispel","Dissolve","Distant","Distortion","Distract","Divide","Doctor","Dog","Donkey","Doom","Door","Dragon","Drain","Draw","Dream","Drink","Drunk","Dubious","Duck","Duplicate","Dust","Dwarf","Eagle","Ear","Earth","Eat","Echo","Ectoplasm","Egg","Ego","Elbow","Eldritch","Electricity","Elemental","Elephant","Elf","Elk","Elm","Ember","Embolden","Embrace","Enchant","Encode","Endure","Energize","Enfeeble","Enhance","Enlighten","Ennui","Enrage","Envelop","Envy","Epiphany","Eternal","Evil","Eviscerate","Excise","Excrete","Excruciate","Execute","Exercise","Exhale","Existential","Exoskeleton","Expand","Expel","Explode","Explosive","External","Extract","Eye","Fake","Falcon","Fall","Falsehood","Fang","Farm","Fart","Fat","Fate","Fatten","Fear","Fearsome","Feast","Feather","Feculent","Fecundity","Feel","Ferret","Fester","Field","Fiend","Fight","Filth","Fin","Find","Finger","Fire","Fish","Fist","Flail","Flame","Flap","Flee","Flesh","Flex","Flick","Flight","Flower","Fly","Foe","Fog","Food","Foot","Forbidden","Force","Foresee","Forest","Forever","Forge","Form","Fountain","Fox","Free","Freeze","Friend","Frog","Frown","Fulgerous","Fulgurite","Fungal","Fungus","Fur","Furniture","Fuse","Gallow","Gas","Gate","Gaze","Geas","Gem","Ghost","Ghoul","Gill","Giraffe","Give","Glamour","Gland","Glare","Glass","Globs","Glow","Glutinous","Glyph","Goat","God","Gold","Golem","Good","Gorilla","Granite","Grasp","Grasshopper","Grave","Gravity","Greed","Green","Grief","Grind","Grip","Grow","Growth","Gruesome","Grunt","Guise","Gut","Hair","Hallucinate","Hallucinatory","Hammer","Hand","Hard","Harm","Harmony","Haruspex","Harvest","Hasten","Hate","Hawk","Heal","Health","Hear","Heart","Heat","Hedgehog","Heel","Heir","Hell","Hermit","Hero","Hex","Hide","Hinder","Hips","Hold","Hole","Hone","Honey","Hoof","Hook","Hope","Horn","Horror","Horse","Hug","Hummingbird","Hyena","Ice","Identify","Ignite","Iguana","Illuminate","Illusion","Imbue","Immoral","Immunity","Implant","Imprison","Indigo","Induce","Infect","Infernal","Infest","Inflict","Insanity","Insect","Instantaneous","Instill","Intelligence","Internal","Intestine","Intoxicate","Invest","Invisible","Iris","Iron","Jackal","Jar","Jaw","Jaws","Jellyfish","Joint","Journal","Joy","Judge","Jump","Justify","Kangaroo","Karma","Key","Kick","Kill","King","Kiss","Knee","Know","Knowledge","Knuckle","Lair","Lake","Lament","Land","Language","Lapse","Lash","Laugh","Laughter","Launch","Lava","Law","Lead","Leaf","Lean","Leap","Learn","Leech","Leg","Lemur","Lens","Leprous","Lessen","Lever","Levitate","Lick","Lie","Life","Lift","Light","Lightning","Limb","Limbo","Link","Lion","Lips","Liquid","Liver","Lizard","Lobster","Locate","Lock","Look","Loop","Lore","Loss","Love","Lucid","Lung","Lurk","Lust","Lynx","Machine","Madden","Magic","Magpie","Mahogany","Maidens","Make","Mane","Mask","Masochism","Meat","Meld","Melt","Memories","Memory","Mend","Mermaid","Mesmerize","Message","Metal","Meteor","Miasma","Mighty","Mind","Mindread","Mineral","Mirror","Missile","Mist","Mistake","Modify","Mole","Molt","Moment","Mongoose","Monkey","Monolith","Monster","Moon","Moose","Morph","Moss","Moth","Mouth","Move","Mucus","Mud","Mule","Murder","Muscle","Mustache","Mutate","Mutation","Mutilate","Nails","Name","Nature","Navel","Neck","Negate","Negation","Nerve","Never","Nexus","Nickel","Night","Nightmare","Noise","Nomad","Nose","Nullify","Oak","Object","Obsequious","Obsidian","Obstruct","Ocean","Octopus","Offend","Offset","Oil","Ooze","Open","Opiate","Opossum","Orange","Orbit","Orc","Order","Organ","Orifice","Orphan","Ostrich","Otter","Outermost","Owl","Ox","Pact","Pain","Palm","Panic","Panther","Paper","Paradigm","Paralyze","Paranoia","Parasite","Parrot","Pass","Pat","Path","Peace","Peacock","Permanent","Person","Petrify","Phantom","Phase","Pheromones","Phlegm","Phoenix","Pierce","Pig","Pinch","Pink","Pique","Piranha","Pit","Plague","Plant","Plasm","Plasma","Platinum","Platypus","Play","Poetry","Point","Poison","Porcupine","Pores","Portal","Possess","Potion","Pound","Power","Pride","Prismatic","Prison","Probability","Proboscis","Prophet","Protect","Pull","Pulse","Punch","Purify","Purple","Pursue","Push","Pyramid","Quake","Queen","Quell","Quiet","Quill","Quintessence","Rabbit","Racoon","Rage","Rain","Raise","Ram","Rashness","Rat","Rattlesnake","Ravage","Raven","Ray","Razor","Reach","Read","Realm","Reap","Recoil","Red","Reflect","Regenerate","Release","Remove","Rend","Repair","Repel","Return","Reveal","Revenge","Reverse","Revolt","Rhinoceros","Rib","Ring","Riot","Rip","Ripen","Ritual","Road","Robe","Robot","Rod","Rope","Rot","Rub","Ruin","Rumors","Run","Rune","Rupture","Rust","Sacrifice","Sadism","Sadness","Salt","Sanctum","Sand","Sap","Sapphire","Savage","Say","Scale","Scorch","Scorpion","Scramble","Scratch","Scream","Screech","Scry","Scythe","Seal","Secret","See","Seethe","Send","Sentinel","Separate","Serpent","Servant","Shadow","Shake","Shape","Shard","Share","Shark","Sharp","Shatter","Sheep","Shell","Shield","Shift","Shine","Ship","Shrewd","Shrink","Shrivel","Sight","Sigil","Signal","Silence","Silver","Sin","Sinister","Sit","Skeleton","Skin","Skull","Skunk","Sky","Slap","Slave","Sleep","Slide","Slime","Slither","Sloth","Slow","Sludge","Smell","Smile","Smite","Smoke","Snail","Snake","Snap","Sneeze","Snow","Sober","Soft","Soil","Song","Soothe","Sorrow","Soul","Sound","Space","Spasm","Spawn","Speak","Spear","Spell","Sphere","Spheres","Spider","Spin","Spine","Spirit","Spit","Spleen","Splice","Splinter","Sponge","Spore","Spray","Squamous","Square","Squeeze","Squid","Squirm","Squirrel","Stack","Staff","Stalker","Stand","Star","Stare","Stasis","Statue","Steal","Steam","Steed","Steel","Step","Sting","Stingray","Stitch","Stomp","Stone","Stork","Storm","Strain","Strength","Stretch","Strike","Stroke","Stun","Success","Sucker","Summon","Surprise","Swallow","Swan","Swarm","Sweat","Swift","Swing","Sword","Symbol","Table","Tail","Take","Talon","Tangible","Tap","Tar","Taste","Teak","Tear","Teeth","Tempo","Tendril","Tenebrous","Tentacle","Terrain","Terrify","Terror","Test","Thief","Think","Thorn","Thought","Threaten","Throat","Throne","Thunder","Tiger","Till","Time","Tin","Tiny","Titanic","Toe","Tomb","Tongue","Tool","Torch","Torment","Torrent","Tortoise","Torture","Touch","Tower","Transfer","Transform","Transmute","Transport","Trap","Travel","Traveling","Tree","Trust","Truth","Tusk","Unclaimed","Undead","Unhinged","Unique","Unlucky","Unseen","Uranium","Use","Useful","Uttermost","Vague","Vampire","Vanity","Vegetable","Vein","Vigour","Vile","Villain","Vine","Violent","Violet","Vision","Vodka","Voice","Void","Vomit","Vortex","Vulgarity","Vulture","Wail","Walk","Wall","War","Ward","Warp","Wasp","Waste","Water","Waterfall","Wave","Wax","Weak","Weapon","Weary","Weather","Web","Weird","Whale","Whisker","Whisper","White","Wiggle","Wight","Wind","Wine","Wing","Wisdom","Wish","Wither","Wizard","Wolf","Wood","Word","Worm","Worship","Wounding","Wrack","Wrath","Wriggle","Wrist","Write","Writhe","Yak","Years","Yellow","Yew","Zeal","Zealot","Zombie"];

function newName(){
  var i;
 switch(r(20)){
  default:
   return fname.sampleRec()+' '+lname.sampleRec();

  case 1: case 2: case 3: case 4: case 5:
   return fname.sampleRec()+' "'+nname.sampleRec()+'" '+lname.sampleRec();

  case 6:
   return lname.sampleRec()+' '+String(111+r(889));

  case 7:
   return fname.sampleRec();

  case 8:
   return ' "'+nname.sampleRec()+'" '+lname.sampleRec();

  case 9:
   return String(50+r(50))+" "+["White","Black","Red","Blue","Green","Aquamarine","Golden","Indigo","Radiant","Dark","Bright","Juggernaut","Liminal","Furious","Vigilant","Wilful","Turbulent","Shining","Sorrowful","Ardent","Adamant","Painful","Docile","Frozen","Burning","Cold","Hot","Verdant","Silent","Hopeful","Endless","Infinite","Gilded","Paper","Bloody","Recursive","Empty","Holy","Final"].sampleRec() + " " + ["Chain","Blossom","Star","Gaze","Blade","Disc","Stream","River","Ocean","Mountain","Tower","Temple","Shield","Spear","Flame","Cloud","Storm","Wave","Tide","Tree","Gale","Dome","Tome","Orb","Scar","Breath","Song","Voice","Word","Thorn","Stone","Concordance","Spirit","Field","Hammer","Chisel","Ingot","Smoke","Crown","Wing","Chariot","Bridge","Flower","Continent","Comet","Moon","Meteor","Anvil","Forge","Mask","Student","Feather","Scale","Hand","Eye","Sigil"].sampleRec() + " " + ["Subdues","Scours","Punctures","Purges","Accuses","Protects","Combats","Apprehends","Breaks","Shatters","Heals","Repairs","Engulfs","Questions","Crushes","Perceives","Analyzes","Enlightens","Seals","Defeats","Vanquishes","Knows","Finds","Obliterates","Preserves"].sampleRec()+" "+["Evil","the Universe","the Unrepentant","the Horizon","the Void","Darkness","the Truthful","the Untruthful","the Fortunate","the Unfortunate","the Sinful","God","the Gods","the Repentant","the Wise","the Unwise","the Holy","the Unholy","the World","Civilization","the Proud","the Greedy","the Lustful","the Wrathful","the Gluttonous","the Envious","the Slothful","the Meek","the Poor","the Hungry","the Dead","the Living","the Sun","Space-Time","the Wicked","Truth","Reality","Lies","the Virtuous","all Heretics and Cowards"].sampleRec();

  case 10:
   return ' "'+nname.sampleRec()+'" ';

  case 11:
   var wNP = ["Alch","Ambro","Aug","Baggy","Bals","Bazh","Beaver","Beggars","Bipp","Blim","Bock","Bogg","Boof","Bork","Bottom","Broad","Buck","Bumb","Burner","Burzy","Bush","Bushy","Castle","Charm","Chook","Chum","Clutter","Cocin","Conju","Cra","Crad","Cumber","Dapp","Dhun","Din","Dinker","Divin","Doodle","Doop","Dread","Drub","Elmsley","Ernst","Eston","Exo","Fany","Fartle","Feffer","Ferd","Figgy","Finch","Fister","Forby","Fordshire","Fudge","Furge","Gae","Gant","Gap","Gax","Giggles","Gleep","Glum","Gooch","Grog","Gross","Hagat","Hal","Hale","Hand","Hard","Hargag","Hass","Hex","Hocus","Hool","Horn","Hossen","Hrum","Hulm","Hyggs","Ington","Jank","Jinx","Joff","Jolly","Kal","Kill","Knacker","Knicker","Kor","Koz","Kramm","Krang","Krotch","Lack","Lapper","Lick","Lord","Lorg","Magus","Maxi","Mus","Pow","Er","Man","Mazz","Meat","Meem","Milsh","Minge","Mo","Moisten","Molp","Mon","Moon","Mooth","Mugg","Nabb","Napper","Nasty","Nether","Nex","Oort","Paag","Packer","Pang","Panty","Penny","Piddle","Pimple","Pincher","Pipt","Pizzle","Pizzle","Plinker","Pocus","Prick","Prissy","Pubb","Pudding","Pyu","Quisp","Raco","Rams","Ramst","Rapp","Riddle","Road","Rod","Rool","Rump","Rune","Ryz","Sass","Seer","Shaft","Shafts","Shag","Shitling","Shoot","Shuffle","Skremp","Slapper","Slipper","Smelly","Snatch","Snicker","Sniffen","Sniffer","Spittle","Staff","Staffer","Star","Stith","Stone","Strating","Stratling","Stroop","Stroot","Stumble","Sundar","Tankle","Thok","Thorpe","Throck","Thwyp","Tinker","Tunn","Turkey","Tzim","Uk","Ul","Ur","Ursk","Urz","Val","Vela","Vex","Voll","Vree","Waddle","Waggler","Wall","Wallop","Wand","Washer","Wattle","Whistle","Wick","Wiggle","Willow","Wimple","Worme","Wort","Worthy","Wozz","Wump","Wurp","Xim","Yann","Yar","Ygg","Ylur","Zap","Zoot","Zsand","Zur","Curse","Flame","Dark","Null","Light","Vill","Green","Red","Blue","Time","Space","Redact","Scroll","Skull","Grow","Never","Alway","Fever","Silk","Diab","Illus","Magnet","Ism","Ology","Sorc","One","Seven","Eleven","Cipher","Ur"];
   var sillyConnect = [" "," "," "," "," "," "," de "," von "," val "," ix ","-"," a "," zu "," y "," of "," d'"];

   return wNP.sampleRec()+wNP.sampleRec().toLowerCase()+sillyConnect.sampleRec()+wNP.sampleRec()+wNP.sampleRec().toLowerCase()+" A.K.A. "+fname.sampleRec();

  case 12:
   // return Math.random().toString(100).substring(2,7).toCase()
   // return a.slice(0,4+r(4))+", ""+fname.sampleRec()+"""
   var a = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
   var b = "";
   for(i = 4+r(4); i>-1; i--){
     b += a.sampleRec(); }
   return b+', "'+fname.sampleRec()+'"';

  case 13:
   var cons = "bcdfghjklmnpqrstvwxz".split("");
   var vowels = "aeiouy".split("");
   var o = "";
   for (i = 8+r(4); i>-1; i--) {
    if (i%2==0)
     o += cons.sampleRec();
    else
     o += vowels.sampleRec();
   }
   return o.charAt(0).toUpperCase() + o.slice(1);

  case 14:
   return words.sampleRec()+" "+words.sampleRec();

  case 15:
   var roman = ["II","III","IV","V","VI","IX","XIII","XIV","XCI","CLVI"];
   return fname.sampleRec()+" "+roman.sampleRec();

  case 16:
   return fname.sampleRec()+" "+words.sampleRec();
 }
}

var aland = ["Abandoned","Aberrant","Abhorrent","Abominable","Abyssal","Accidental","Accursed","Acidous","Acrid","Actinic","Aerial","Afflicted","Akratic","Alien","Alpha","Amaranthine","Amethyst","Anarchic","Ancient","Angel","Angelic","Animalistic","Animistic","Antediluvian","Arcane","Arctic","Argent","Archaic","Arid","Artful","Ascendant","Ashen","Astral","Awoken","Axiomatic","Azure","Baleful","Banished","Barbaric","Barren","Bawdy","Beastly","Beautiful","Belligerent","Bewitched","Bizarre","Black","Blessed","Blighted","Blind","Blissful","Bloody","Blue","Boiling","Bone","Bountiful","Brave New","Brazen","Broken","Brooding","Brown","Brutal","Buried","Burning","Burnt","Calm","Cancerous","Cannibal","Capitalist","Capricious","Captivating","Carnal","Carrion","Cataclysmic","Caustic","Cavernous","Celestial","Central","Ceramic","Cerulean","Clockwise","Clockwork","Cobalt","Cold","Colourless","Communist","Conquering","Contaminated","Corpse","Corrupt","Coruscant","Cracked","Cratered","Creepy","Crenellated","Crimson","Crooked","Crown","Cruel","Cursed","Damned","Dancing","Dangerous","Dank","Dead","Deadly","Deathless","Deathly","Decaying","Deep","Deeper","Deepest","Defiant","Deformed","Demon","Demonic","Dendroid","Depraved","Deranged","Desecrated","Deserted","Desolate","Despoiled","Destroyed","Devil","Diabolic","Diamond","Dire","Diseased","Divine","Dolm","Doomed","Dormant","Draconic","Dragon","Dreadful","Dreaming","Dreary","Drowned","Dry","Dryad","Dusty","Dwarven","Dying","Earthen","Eastern","Ebon","Eldritch","Electric","Elven","Emerald","Empty","Empyrean","Enclosed","Enchanted","Enigmatic","Enlightened","Ephemeral","Epic","Errant","Eternal","Ethereal","Evening","Exalted","Experimental","Extradimensional","Fading","Failed","Fair","Fairy","Fallen","False","Familiar","Fancy","Far","Faraway","Fearful","Fearless","Fearsome","Feral","Ferric","Fertile","Fetid","Fey","Fiery","Filthy","Final","Flaming","Flawed","Flayed","Floating","Flowing","Forbidden","Forgotten","Forlorn","Forsaken","Forsworn","Foul","Fractal","Fractured","Fragrant","Frail","Freakish","Frenetic","Friendly","Frigid","Frosty","Frozen","Fuligin","Fungal","Gargantuan","Gay","Ghastly","Ghostly","Ghoulish","Giant","Ginger","Glacial","Gloomy","Glowing","Gnomish","Goblin","Golden","Good","Grand","Grandiose","Gray","Great","Greater","Green","Grim","Gruesome","Guarded","Hallowed","Hanging","Harsh","Haunted","Heavenly","Hellish","Hidden","Higher","Hoary","Hollow","Holy","Homeward","Hostile","Hot","Hungry","Hypergreen","Chained","Chaotic","Chthonic","Icy","Igneous","Ill-Fated","Illustrated","Immaculate","Immortal","Imperial","Inbred","Indigo","Industrial","Infected","Infernal","Infrared","Inhuman","Insidious","Irradiated","Jagged","Jale","Joyous","Knotted","Kobold","Kraken","Lachrymose","Last","Legendary","Leper","Lesser","Leviathan","Lifeless","Little","Long","Lost","Low","Lower","Lunar","Lush","Luxurious","Macabre","Mad","Magenta","Magical","Magnificent","Machine","Majestic","Marginal","Marked","Masked","Mechanical","Mercantile","Mercurial","Metablue","Midsummer","Mighty","Miraculous","Mirror","Mirthful","Miserable","Misty","Molten","Monster","Monstrous","Morning","Mouldy","Mournful","Mutant","Mysterious","Mystic","Narrow","Nascent","Negative","Nether","Ninth","Noble","Nocturnal","Nomadic","Northern","Noxious","Nuclear","Occidental","Occult","Octarine","Ogrish","Old","Omega","Orange","Orcish","Organic","Oriental","Ornery","Orthodox","Other","Overgrown","Pale","Pallid","Penitent","Peregrine","Perilous","Petrified","Phallic","Phasic","Phoenix","Pink","Pious","Plagued","Pleasant","Poisoned","Potent","Praised","Prehistoric","Primitive","Primordial","Prismatic","Pristine","Profane","Promiscuous","Pure","Purple","Putrescent","Putrid","Quiet","Radiant","Rambunctious","Rampant","Rapt","Ravaged","Ravenous","Ravished","Red","Reforged","Regal","Resplendent","Revenant","Rich","Rising","Rocky","Rotting","Royal","Ruby","Ruined","Runic","Sacred","Sanguine","Savage","Scandalous","Scarlet","Scarred","Scorched","Screaming","Sealed","Searing","Secret","Sentient","Serene","Serpent","Serpentine","Seventh","Shadowed","Shattered","Shifting","Shrouded","Sidereal","Silent","Sinful","Singing","Sinking","Sinuous","Skeletal","Skeleton","Skull","Sleeping","Snowy","Solar","Southern","Spectral","Spirit","Steampunk","Sterile","Stinking","Strange","Succulent","Sunken","Supernatural","Supreme","Tattered","Tepid","Terrestrial","Third","Thirteenth","Titanic","Torturous","Toxic","Tranquil","Transdimensional","Tribal","Trollish","Troubled","Turbulent","Twin","Twisted","Ugly","Ulfire","Ultraviolet","Unabashed","Unborn","Unconquered","Undying","Unholy","Unchained","Uncharted","Unicorn","Unknown","Unmapped","Unnamed","Unnatural","Unstable","Untamed","Upper","Vampire","Veiled","Vermillion","Very Small","Vibrant","Vicious","Vile","Villainous","Violet","Virgin","Viridian","Volcanic","Voltaic","Wandering","Warded","Warm","Warped","War-Torn","Wasting","Watery","Wayward","Wealthy","Weeping","Weird","Western","Whispering","White","Wicked","Wild","Winded","Windy","Withered","Witching","Wooded","Worm","Worthless","Wraith","Wretched","Wyrm","Xanthous","Xeric","Yawning","Yellow","Zombie"];
var pland = ["Adamant","Adventure","Alabaster","Amber","Apocalypse","Ash","Asphalt","Autumn","Bark","Beer","Blood","Brass","Briar","Brimstone","Bronze","Cinder","Cinnamon","Clay","Coal","Concrete","Copper","Coral","Crystal","Dark","Dawn","Deer","Dusk","East","Ember","Evil","Flame","Flint","Fog","Fossil","Glass","God","Gold","Gossamer","Grass","Honey","Chaos","Chrome","Ice","Iron","Ivory","Jade","Lichen","Magic","Malachite","Mandrake","Marble","Mead","Meat","Metal","Midnight","Milk","Mithril","Moss","Mourning","Mud","Mystery","Nephrite","Night","Nightmare","Noon","North","Obsidian","Onyx","Ooze","Opal","Pepper","Plastic","Platinum","Porcelain","Prism","Quicksilver","Rainbow","Rime","Rust","Saffron","Salt","Sand","Sap","Seaweed","Shadow","Sheep","Silk","Silver","Skin","Sky","Slime","Sludge","Snow","Soap","South","Spring","Steam","Steel","Stone","Sugar","Sulphur","Summer","Sweat","Throne","Trash","Treasure","Undead","Verdigris","Vinegar","Wax","West","Wine","Winter"];
var nland = ["Abyss","Academy","Badlands","Barony","Barrows","Bastion","Battlefield","Beach","Bog","Borderlands","Borough","Bulwark","Burrow","Caldera","Caliphate","Camp","Canton","Canyon","Castle","Catacombs","Cathedral","Cave","Cavern","Caverns","Caves","Cemetery","Citadel","City","Clearing","Cliffs","Cloister","Coast","Colony","Country","County","Court","Cove","Crater","Crossroads","Crypt","Dale","Deeps","Dell","Demesne","Den","Depths","Desert","Desolation","Dimension","District","Domain","Dunes","Dungeon","Dystopia","Earldom","Edge","Emirate","Empire","Estate","Exarchate","Expanse","Eyrie","Factory","Fen","Fiefdom","Field","Fields","Fissures","Fjord","Forest","Fort","Fortress","Freehold","Gaol","Garden","Glade","Glen","Gorge","Grassland","Graveyard","Grotto","Grounds","Gulch","Halls","Hamlet","Haven","Heaven","Hell","Highlands","Hillocks","Hills","Hive","Holdings","Hollow","Chambers","Channels","Chasm","Jungle","Keep","Kingdom","Laboratory","Labyrinth","Lair","Land","League","Library","Lowlands","Manse","March","Marsh","Marshland","Mausoleum","Maze","Meadow","Mine","Mines","Monastery","Moor","Mountain","Necropolis","Nest","Nexus","Oasis","Ossuary","Oubliette","Outlands","Palace","Paradise","Parish","Pass","Pastures","Paths","Pit","Pits","Place","Plain","Plains","Plane","Plateau","Prairie","Precinct","Prefecture","Prison","Protectorate","Province","Pyramid","Quagmire","Rampart","Ravine","Reach","Reaches","Realm","Refuge","Region","Reich","Retreat","Rift","Road","Ruins","Sanctuary","Sanctum","Savanna","Sea","Sepulcher","Sewers","Shire","Shrine","Springs","State","Steppe","Stronghold","Sultanate","Swamp","Taiga","Temple","Territory","Tomb","Towers","Town","Trenches","Tundra","Tunnels","Underground","Underworld","Utopia","Vale","Valley","Vault","Vineyard","Volcano","Warrens","Wasteland","Wastes","Wetland","Wild","Wilderness","Wilds","Wood","Woods","World","Ziggurat"];
var lland = ["Abortion","Adversity","Afflictions","Agony","Air","Alcohol","Alchemy","Angels","Anger","Anguish","Annihilation","Anomalies","Answers","Anxiety","Apes","Apotheosis","Apparitions","Architecture","Arson","Art","Artifice","Ascension","Ashes","Aspirations","Avarice","Baboons","Bandits","Banners","Baubles","Bears","Beasts","Bee-Eaters","Bees","Beggars","Bells","Berries","Berserks","Birds","Blades","Bliss","Blizzards","Bloodlust","Bloodshed","Boars","Bodies","Bogeymen","Bondage","Bones","Books","Boulders","Brambles","Bravery","Bread","Buffalos","Butterflies","Cacophony","Cactae","Cakes","Camels","Cancer","Candles","Candy","Carnage","Catastrophes","Cats","Cattle","Cauldron","Celebration","Centaurs","Claws","Clergy","Clocks","Clones","Clowns","Colossi","Compassion","Conquest","Contempt","Crabs","Crates","Crime","Crocodiles","Crows","Crucible","Crucifixion","Curses","Darkness","Daughters","Death","Decay","Deception","Deicide","Delight","Delirium","Delusion","Dementia","Demise","Demons","Depression","Desires","Despair","Desperation","Destiny","Destruction","Devolution","Dew","Diligence","Dinosaurs","Disasters","Discord","Diseases","Domes","Doom","Dragons","Dread","Drizzle","Drugs","Ducks","Duck-Sized Horses","Dust","Duty","Dwarves","Earth","Earthquake","Ectoplasm","Echoes","Elephants","Elves","Endings","Ennui","Envy","Essence","Eternity","Etiquette","Eunuchs","Exorcism","Explosions","Eyes","Fables","Fae","Failure","Fairies","Faith","Famine","Fangs","Fata Morgana","Fate","Fathers","Fear","Feasts","Feathers","Festivities","Fire","Fish","Flesh","Flotsam","Flowers","Forges","Forgiveness","Fortune","Freaks","Freedom","Fright","Frogs","Fruit","Funerals","Fungi","Furniture","Gambling","Garbage","Gardens","Gates","Gems","Genesis","Ghosts","Ghouls","Giants","Glory","Gluttony","Goblins","Golems","Gossip","Grace","Grandfathers","Grandmothers","Grapes","Gratitude","Graves","Greed","Growth","Hallucinations","Hammers","Harmony","Hatred","Haunts","Hazards","Healing","Hearts","Hellfire","Heresy","Heroes","Heroics","Herrings","Honour","Hope","Horrors","Horses","Horse-Sized Ducks","Hymns","Chains","Chants","Charity","Chastity","Cheese","Chickens","Chimneys","Chocolate","Idols","Ills","Illusions","Imagination","Imps","Incest","Ink","Insanity","Insects","Intimacy","Invaders","Jaywalking","Jesters","Jewels","Journeys","Joy","Keys","Knights","Knives","Koans","Kobolds","Kung Fu","Lakes","Lamentation","Lamentations","Lances","Lava","Leeches","Legends","Lemmings","Liars","Liberty","Lice","Lies","Life","Light","Lightning","Limbs","Lions","Lizard Kings","Lizards","Locks","Loot","Lords","Lore","Loss","Love","Lovers","Lust","Madness","Magma","Magpies","Maids","Maladies","Mana","Masochism","Mathematics","Melancholy","Memories","Mercury","Mercy","Mermaids","Mice","Might","Mildew","Mirrors","Mirth","Misery","Misfortune","Mist","Mockery","Monkeys","Monsters","Monuments","Moon","Mothers","Mucus","Murder","Muses","Mushrooms","Music","Mutants","Myths","Narwhals","Nature","Nausea","Needles","Nobility","Noise","Nymphs","Obelisks","Obliteration","Oblivion","Occultism","Octopi","Ogres","Olm","Orcs","Ordeals","Outlaws","Owls","Oysters","Pacifism","Pacts","Pain","Panthers","Parrots","Passion","Patience","Peace","Peacocks","Pearls","Penance","Penguins","Perdition","Peril","Perversion","Pestilence","Phantoms","Philosophy","Pigeons","Pillars","Pirates","Pitchforks","Plague","Plants","Plenty","Poetry","Power","Powers","Predators","Pretence","Pride","Promises","Prophecy","Prosperity","Protection","Providence","Puissance","Punishment","Purity","Pus","Putrescence","Pygmies","Pyres","Questions","Quests","Raiders","Rain","Rats","Ravens","Reason","Rebels","Rebirth","Reflections","Regret","Reincarnation","Remorse","Responsibility","Rest","Revelations","Rhythm","Riches","Rituals","Rivers","Roses","Rot","Sacrifice","Sadism","Saliva","Scorn","Scrap","Screams","Secrets","Serenity","Serpents","Servitude","Sex","Shame","Sharks","Shields","Ships","Sickness","Silence","Simulacra","Sin","Sins","Skulduggery","Skulls","Slaughter","Slavery","Sleep","Sloth","Slumber","Smoke","Snakes","Soldiers","Sons","Soot","Sorcerers","Sorcery","Sorrow","Souls","Spears","Spices","Spiders","Spirals","Spires","Spirits","Spoons","Squids","Stars","Statues","Staves","Storms","Strength","Strife","Succour","Suffering","Sun","Sunlight","Swans","Sweat","Swords","Sympathy","Taboos","Tea","Tears","Teatime","Teeth","Temperance","Temptation","Tentacles","Terror","Thieves","Thorns","Thoughts","Thunder","Tides","Tigers","Timber","Time","Titans","Tongues","Torment","Tornados","Torture","Tragedy","Traitors","Traps","Travels","Travesty","Treason","Trees","Trials","Trombones","Trouble","Trust","Truth","Tumult","Turnips","Turtles","Twilight","Underwear","Unicorns","Unrest","Urns","Valour","Vengeance","Vermin","Voices","Void","Vultures","Wands","War","Warlocks","Warmth","Wasps","Water","Wealth","Weapons","Weed","Werewolves","Whales","Whispers","Whores","Winds","Wisdom","Wizards","Woe","Wolves","Women","Wonder","Wood","Worms","Wrath","Wyrms","Wyverns"];
var tland = ["Aegis","Amazon","Angel","Archangel","Archmage","Archon","Army","Avatar","Baron","Bastard","Behemoth","Bull","Butcher","Cadaver","Cenobite","Clan","Council","Count","Countess","Daeva","Damned","Dead","Demigod","Demon","Devil","Druid","Eater","Eidolon","Emperor","Executioner","Fiend","Genie","God","Goddes","Heir","Herald","Hermit","Hero","Heroine","Hierophant","Horror","Champion","Child","Chimera","Imp","Juggernaut","King","Knave","Knight","Lady","Lich","Lord","Lotus","Mage","Magus","Master","Messenger","Mistress","Monk","Monolith","Mummy","Necromancer","Oracle","Orb","Paladin","Paragon","Parasite","Prince","Princess","Queen","Reaper","Saint","Scoundrel","Scourge","Seer","Sentinel","Seraph","Shaman","Sorcerer","Sorceress","Stag","Star","Starspawn","Syndicate","Tormentor","Trickster","Tyrant","Warlock","Warlord","Widow","Witch","Wizard","Worm","Wraith","Wyrm"];
var rland = ["Acheron","Albion","Alfheim","Ankh-Morpork","Annwn","Arcadia","Arendelle","Asgard","Atlantis","Avalon","Axis Mundi","Azeroth","Barsoom","Bas-Lag","Brahmapura","Bytopia","Caipi-Taal","Camelot","Carceri","Centerra","Cimmeria","Cockaigne","Cocytus","Dis","Eden","El Dorado","Elysium","Faeria","Gehennom","Helheim","Hy-Brasil","Hyperborea","Hyrule","Illyria","Infernum","Irkalla","Jotunheim","Lankhmar","Lemuria","Limbo","Lordran","Matrix","Mictlan","Midgard","Mordor","Mu","Muspelheim","Narnia","Netherworld","Neverwhere","Niflheim","Nirvana","Oz","Pandaemonium","Pangaea","Pern","Purgatory","Quendor","Qwghlm","Shambala","Shangri-La","Sierra de la Plata","Sodom","Sokovia","Stygia","Tartarus","the Dreamlands","the Moominland","the Promised Land","the Upside Down","the Wyld","Themiscyra","Thule","Ur","Valhalla","Wonderland","Xanadu","Xanth","Xibalba","Yendor","Zion"];

function newWorldName(){
 var wName = "";
 switch(r(16)){
  default:
   wName = "the "+["",pland,aland,aland].sampleRec()+" "+nland.sampleRec()+" of "+[pland,lland,lland].sampleRec();
   break;

  case 0:
   wName = fname.sampleRec()+"'s "+nland.sampleRec();
   break;

  case 1:
   if(!r(4)){ wName = rland.sampleRec(); break; } // Make this one more rare.
   //fallthrough

  case 2: case 3: case 4:
   wName = "the "+[pland,aland,aland].sampleRec()+" "+nland.sampleRec();
   break;

  case 5:
   wName = "the "+aland.sampleRec()+" and "+aland.sampleRec()+" "+nland.sampleRec();
   break;

  case 6: case 7:
   wName = "the "+nland.sampleRec()+" of "+[pland,lland].sampleRec()+" and "+[pland,lland].sampleRec();
   break;

  case 8: case 9: case 10:
   wName = "the "+nland.sampleRec()+" of "+[pland,aland,aland].sampleRec()+" "+lland.sampleRec();
   break;

  case 11:
   wName = "the "+nland.sampleRec()+" of the "+[pland,aland].sampleRec()+" "+tland.sampleRec();
   break;
 }

 return "<t style='color:#"+Math.random().toString(16).substr(2,6)+"'>"+wName+"</t>";
}

function getWorldName(){
 return worldData[worldPos.x][worldPos.y].name;
}

function getArmorName(){
 var armour = "";
 if(armor < armors.length) armour = armors[armor];
 else armour = armors[armors.length-1] + " +" + String(armor - armors.length + 1);
 armour += glyphs[glyph];
 return armour;
}

function getTileName(tile){
  switch (tile) {
    case '.':            return "floor";
    case '$':            return "memento";
    case '/':            return "inactive lever";
    case '\\':           return "activated lever";
    case ']':            return "suit of armour";
    case ',':            return "pile of rubble";
    case '?':            return "mysterious pile";
    case '^':            return "trap";
    case '_':            return "holy altar";
    //case emptyBlock:     return "ground";
    case wallBlock:      return "wall";
    case tileWater:      return "shallow water";
    case tileLava:       return "lava";
    case tileSludge:     return "toxic sludge";
    case tileBlood:      return "pool of blood";
    case tileQuicksand:  return "quicksand";
    case tileIce:        return "ice";
    case tileBlindGas:   return "dark smoke";
    case tileConfGas:    return "noxious fumes";
    case tileStunGas:    return "fetid odour";
    case tileKey:        return "key";
    case tileArmor:      return "magic armour";
    case tileStaff:      return "magic staff";
    case tileMobDoor:    return "heavy door";
    case tileGoldDoor:   return "locked door";
    case tileGoldWall:   return "golden wall";
    case tileTreasure:   return "memory trove";
    case tileBramble:    return "thorny bramble";
    case tileNettles:    return "dread nettles";
    case tileGrassTall:  return "tall grass";
    case tileGrassShort: return "grass";
    case tileBloodDrop:  return "bloodstain";
    case tileTreeStump:  return "tree stump";
    case tileTreeConif:  return "coniferous tree";
    case tileTreeLeafy:  return "leafy tree";
    case tileTreeDead:   return "dead tree";
    case tileBush:       return "shrubbery";
    case tileMacGuffin:  return "curious artifact";
    case tileSecretPath: return "secret path";
    case tileTeleporter: return "warp portal";
    default: return false;
  }
}

function getHint(says=""){
 // Random hints or lore.
 var hints = ["You don't deserve forgiveness.",
              "Did they really deserve it?",
              "Too late for regrets.",
              "Was it worth it?",
              "You cannot fix it anymore.",
              "Why did you do it?",
              "Why them?",
              "Seek the levers once your Self glows again.",
              "Conquering your inner demons brings a certain boon.",
              "Water will not harm you, Wanderer.",
              "Have you lost your way?",
              "You might never be the same again...",
              "May you find that which you seek.",
              "Strike down anyone who stands in your path.",
              "Their blood shall purify you.",
              "Your journey's end awaits in the distance.",
              "Nourish your Self or fade to oblivion.",];

 var compass = ["north","south","east","west"];
 var adj = ["mysterious","strange","rasping","barely audible","faint","familiar","unfamiliar","inhuman"];
 var voice = ["voice","whisper"];

 if(says == "")
   msg += "The "+compass.sampleRec()+" wind carries a "+adj.sampleRec()+" "+voice.sampleRec()+" saying: \"";
 else
   msg += says;

 if(score>1000 && says=="")
   msg += "Seek the levers, Wanderer. Seek the levers! ";
 else {
   switch(r(4)){
    case 1:
     var which = r(staves.length);
     msg += "A staff"+staves[which]+" "+staffDesc[which]+".";
     break;

    case 2:
     var which = r(glyphs.length);
     msg += "An armour"+glyphs[which]+" "+glyphDesc[which]+".";
     break;

    default:
     msg += hints.sampleRec();
     break;
   }
 }

 msg += "\" ";
}

// Make map:
function generateMap(){
 // Tiny chance that we create a crazy level full of special terrain.
 var chanceTerrain = !r(1000) && (visited>1);

 for (var i = 0; i < mapWidth; i++) {
  currentMap[i] = []; // empty map
  for (var j = 0; j < mapWidth; j++) {
   var edgeDistance = [i, mapWidth-i, j, mapWidth-j];
   edgeDistance.forEach(function(element){
    var chanceFilled = 10;
    if(element>0) chanceFilled = (1/Math.pow(element,2))*10;
    if(chanceFilled>r(10) && r(wallBreaks)) currentMap[i][j] = wallBlock;
   }); //makes 1/distance^2 a percentage chance of wall, 0 = 100%
   // add terrain
   if (currentMap[i][j]!=wallBlock){
    if (!r(1000) && r(distanceToOrigin())) {
     currentMap[i][j] = terrain_rare.sampleRec();
    }
    //else if(!r(Math.max(30-distanceToOrigin()))) {
    else if(!r(Math.max(Math.abs(25-distanceToOrigin()), 4)) || chanceTerrain) {
     // Terrain chance dependant on distanceToOrigin, first increases, but then decreases as we get too far.
     currentMap[i][j] = terrain.sampleRec();
    }
    else currentMap[i][j] = emptyBlock;
   }
  }
 }

 if(!r(5)) addLake();
 if(!r(2)) addRiver();
 if(!r(2)) addRiver();
 while(!r(10)) addStructure();
 addStructure(true);

 visited++;
}

function addRiver(){
 var x = 0;
 var y = 0;
 var move = 0;
 var lastMove = 0;

 var liquid = tileWater;
 if(r(visited)>20 || !r(100)) liquid = [tileLava,[tileSludge,tileBlood,tileQuicksand,tileIce]].sampleRec();

 switch(r(2)){
  case 0: //across
   x = r(mapWidth);
   while(inRangeCoords(x,y)){
    currentMap[x][y]=liquid;
    if(inRangeCoords(x+1,y)) currentMap[x+1][y] = liquid;
    move = [lastMove, 0, -1, -1, +1, +1][r(6)];
    lastMove = move;
    x += move;
    y++;
    if(inRangeCoords(x,y)){
     if(currentMap[x][y]==liquid) break;
    }
   }
  break;

  case 1: //down
   y = r(mapWidth);
   while(inRangeCoords(x,y)){
    currentMap[x][y] = liquid;
    if(inRangeCoords(x,y+1)) currentMap[x][y+1] = liquid;
    move = [lastMove, 0, -1, -1, +1, +1][r(6)];
    lastMove = move;
    y += move;
    x++;
    if(inRangeCoords(x,y)){
     if(currentMap[x][y]==liquid) break;
    }
   }
  break;

  case 2: //diagonal
   // TODO: fix!!!
   lastMove = +1;
   while(inRangeCoords(x,y)){
    currentMap[x][y] = liquid;
    if(inRangeCoords(x,y+1)) currentMap[x][y+1] = liquid;
    if(inRangeCoords(x+1,y)) currentMap[x+1][y] = liquid;
    move = [lastMove, 0, -1, +1, +1][r(6)];
    lastMove = move;
    if(r(2)){
      x++;
      y += move;
    } else {
      x += move;
      y++;
    }
   }
  break;
 }
}

function addLake(){
 var stepsTaken = 0;
 var stepsFailed = 0;
 var currStep = {x:r(mapWidth),y:r(mapWidth)};

 var liquid = emptyBlock; // Just to make sure we don't accidentaly make undefined lake.
 if(r(visited)>20) liquid = tileLava;
 else
   liquid = [tileWater,[',',tileGrassTall,tileBramble,tileNettles,tileSludge,tileBlood,tileIce,tileQuicksand,tileBlindGas,tileConfGas,tileStunGas]].sampleRec();

 while(stepsTaken<500 && stepsFailed<500){
  currentMap[currStep.x][currStep.y] = liquid;

  var nextStep = {x: currStep.x + r(3)-1, y: currStep.y + r(3)-1};
  if(inRange(nextStep)){
   currStep = nextStep;
   stepsTaken += 1;
  } else stepsFailed += 1;
 }
}

function addBoss(){
 var bossSpace = [];
 // I had it much more nicely and cleanly done, but it was buggy and broken. Now it's ugly and working. :(

 // Create boss arena:
 for(var k=-5; k < 6; k++){
  for(var l=-5; l < 6; l++){
   if(k==0 && l==0) currentMap[userPos.x][userPos.y] = '.';
   else if(!inRangeCoords(userPos.x+k,userPos.y+l)) continue;
   else if(distanceBetween(userPos, {x:userPos.x+k, y:userPos.y+l})==5)
     currentMap[userPos.x+k][userPos.y+l] = tileLava;
   else if(currentMap[userPos.x+k][userPos.y+l]==wallBlock && distanceBetween(userPos, {x:userPos.x+k, y:userPos.y+l})<5)
     currentMap[userPos.x+k][userPos.y+l] = ',';
   else if(currentMap[userPos.x+k][userPos.y+l]=='/')
     currentMap[userPos.x+k][userPos.y+l] = '^';

   if(checkEmpty(userPos.x+k,userPos.y+l)) bossSpace.push([k,l]);
  }
 }
 msg += "The whole area shudders and cracks as ancient mechanisms are brought to life with the stolen energy. ";
 // Spawn boss:
 if(bossSpace.length>0){
  var place = bossSpace[r(bossSpace.length)];
  mobBoss.x = userPos.x+place[0];
  mobBoss.y = userPos.y+place[1];
  currCre.push(mobBoss);
  msg += "The ground splits with the sound of whirling clockworks and a horrifying creature bearing the mockery of your own face emerges. "+mobBoss.name+" snarles at you. ";
 } else msg += "But something goes wrong and the mechanisms halt with horrid screeching. ";
}

function addStructure(special_rooms=false){
 var toAdd = [];
 var currentLine = "";
 // Individual rooms can be flagged not to be randomly mirrored/flipped/etc.
 var noMirror = false;
 var noFlip = false;
 var noRotate = false;
 // Declare random mob 'c' for rooms of specific type of monsters here, so we can
 // set it for individual rooms. Varied mobs 'm' and 'M' are not completely
 // random, so no need to have them prepared before actually generating the room.
 var randMob = creatureList.sampleRec();

 //TODO: Add starting vaults?
 if((r(visited)>20) && (r(distanceToOrigin())>=10) && (r(kills)>20) && special_rooms){
  //The winning place:
  toAdd = ["77===77                   77===77",
           "7.....7                   7.....7",
           "=.mmm.777777777777777777777.mmm.=",
           "=.mMm..^.................^..mMm.=",
           "=.mmm.777777777787777777777.mmm.=",
           "7.....7WWWWWWWW7.7WWWWWWWW7.....7",
           "777.777WWWWWW7778777WWWWWW777.777",
           "  7.7WWWWWWWW7555557WWWWWWWW7.7  ",
           "  7.7WWWWWWWW=55555=WWWWWWWW7.7  ",
           "  7.7WWWWWWWW=55@55=WWWWWWWW7.7  ",
           "  7.7WWWWWWWW=55555=WWWWWWWW7 .  ",
           "  7^7WWWWWWWW7555557WWWWWWWW7^7  ",
           "  7.7WWWWWWWW77===77WWWWWWWW7... ",
           "  7.7WWWWWWWWWWWWWWWWWWWWWWW7..W.",
           "  7.7WWWWWWWWWWWWWWWWWWWWWWW7W.. ",
           "  7.7  WWWWWWWWWWWWWWWWWWWWW7..  ",
           "777.77  WWWWWWWWWWWWWWWWWW777.777",
           "7.... .WWWWWWWWWWWWWWWWWWW7.....7",
           ". ... .77777777777777777777.mmm.=",
           " .. ........................mMm.=",
           "7... .777777777777777777777.mmm.=",
           "7......                   7.....7",
           "77 . 77                   77===77"];
 }
 else switch(r(240)) {
  default:
   if(score > 1000){
     toAdd = ["...",
              "./.",
              "..."];
   } else {
     toAdd = [["WWWWWWWWWWWWWW","WWWWWW..WWWWWW"][r(2)],
       "W............W",
       "W........"+['m','.'][r(2)]+"...W",
      ['W','.','.'][r(3)]+"............"+['W','.','.'][r(3)],
       "W..."+['i','.'][r(2)]+"........W",
       "W............W",
      ["WWWWWWWWWWWWWW","WWWWWW..WWWWWW"][r(2)],
     ];
   }
   break;

  case 1:
   if(r(2))
     toAdd = ["333333333333333333333333333333"];
   else
     toAdd = ["444444444444444444444444444444"];
   break;

  case 2:
   toAdd = [" W ",
            " W ",
            " W ",
            " W ",
            " W ",
            " W ",
            ".8.",
            " W ",
            " W ",
            " W ",
            " W ",
            " W ",
            " W ",
            ".8.",
            " W ",
            " W ",
            " W ",
            " W ",
            " W ",
            " W "];
   break;

  case 3:
   toAdd = [" 66 ",
            "6666",
            " 66 "];
   break;

  case 4:
   toAdd = [" 6666 ",
            "666666",
            "666666",
            " 6666 "];
   break;

  case 5:
   toAdd = [" ~~~~~~ ",
            "~~~~~~~~",
            "~~~~~~~~",
            "~~~~~~~~",
            " ~~~~~~ "];
   break;

  case 6:
   toAdd = ["WWWWWWWWWWW..W",
            ".........WW..W",
            "WWWWWWW..WW..W",
            "W$$^..Wm....."+['W','.'][r(2)],
            "W$$W..WWWWW..W",
            "WWWW.........W",
            "   WWW..WWWWWW"];
   break;

  case 7:
   toAdd = ["WWWWWWW..WWWWWWW",
            "WW...WW..WW...WW",
            "W.....W..W.....W",
            "...i..8..8..i...",
            "W.....W..W.....W",
            "WW...WW..WW...WW",
            "WWWWWWW..WWWWWWW"];
     break;

  case 8:
   toAdd = [" WWWWWWWWWWWWW",
            " W...444444.1W",
            "WW..WWWWWWWWWW",
     ['W','.'][r(2)]+"............"+['W','.'][r(2)],
            "WW#WWW33WWW#WW",
            "W???Wi..iW???W",
            "WWWWWWWWWWWWWW"];
     break;

  case 9:
   toAdd = ["WWWWWW..WWWWWW",
            "W....W..W_...W",
            "W./..4..W....W",
            "W....W..WWWW.W",
            "WWW3WW.....W.W",
            "W----W..W....W",
            "WWWWWW..WWWWWW"];
     break;

  case 10:
   toAdd = ["WWWWWW..WWWWWW",
            "W.1.WW..WW.9.W",
            "W...8....8...W",
            "WWWWWW..WWWWWW",
            "W...8....8...W",
            "W.5.WW..WW.].W",
            "WWWWWW..WWWWWW"];
     break;

  case 11:
   toAdd = ["WWWWWW..WWWWWW",
            "W............W",
            "W..WW....WW..W",
            "......66......",
            "W..WW....WW..W",
            "W............W",
            "WWWWWW..WWWWWW"];
     break;

  case 12:
   toAdd = ["WWWWWWWWWWWWWW",
            "W............W",
            "W.c.WWWWWW.c.W",
            "....W..10W....",
            "W.c.W3WWWW.c.W",
            "W............W",
            "WWWWWWWWWWWWWW"];
   break;

  case 13:
   toAdd = ["WWWWWW.WWWWWWW",
            "W???W???WWW.1W",
            "WW.WWW.WWWW..W",
            "........WWW3WW",
            "WWWWWW..WWW..W",
            "W........4...W",
            "W444WWWWWWWWWW"];
     break;

  case 14:
   toAdd = ["  WWWW...WWW  ",
            " WWWWWW...WWW ",
            "WWWWWW33...WWW",
            ".....3333.....",
            "WWW...33WWWWWW",
            " WWW...WWWWWW ",
            "  WWW...WWWW  "];
     break;

  case 15:
   toAdd = ["WWWWWW..WWW.WW",
            "W...1W..WW???W",
            "WW33WW..WWW.WW",
            ".............W",
            "WW33WW..WW._.W",
            "W1...W..WW...W",
            "WWWWWW..WWWWWW"];
     break;

  case 16:
   toAdd = ["WW.WW   777777",
            "W???W   71$$.7",
            "WW.WWWWW777787",
            ".............W",
            "W.WWWW44WWWW.W",
            "W/W........W..",
            "WWW.WWWWWW.WWW"];
     break;

  case 17:
    // Temple of the RNG
    // I actually fixed the strange bugs that crop up when generating this room,
    // but then it seemed so... boring. So for this room only, please don't fix the bugs. :D
    toAdd = ["&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;",
             "&#9608;...^....................................&#9608;",
             "&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;",
             "&#9608;..&#9608;......^...........................&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;^.&#9608;",
             "&#9608;..&#9608;..&#9608;........^...................&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;..&#9608;............^.........&#9608;..&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;^.&#9608;..&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;..&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;..&#9608;..&#9608;???&#9608;...$$...&#9608;...&#9608;..&#9608;..&#9608;.^&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;..&#9608;.0&#9608;???&#9608;..$55$..&#9608;.9.&#9608;..&#9608;..&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;..&#9608;..&#9608;???&#9608;...$$...&#9608;...&#9608;..&#9608;..&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;..&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;..&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;.^&#9608;......................&#9608;^.&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;..&#9608;............................&#9608;/.&#9608;..&#9608;",
             "&#9608;0.&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;..&#9608;",
             "&#9608;..&#9608;............^.....................&#9608;..&#9608;",
             "&#9608;..&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;..&#9608;",
             "&#9608;............................^...........&#9608;",
             "&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;"];

      var randTerrain = "i2[$?7.':S;!)pP%~,6/0=bsq#dfn^34xmMaAc&X".split('');
      for (var i = 0; i < toAdd.length; i++) {
       toAdd[i] = toAdd[i].replaceAt(r(toAdd[i].length),randTerrain[r(randTerrain.length)]); // Here comes the bug we're keeping, the replaceAt() breaks the hex code for walls into a string of characters.
       toAdd[i] = toAdd[i].replace(/&#9608;/g,"W");
       toAdd[i] = toAdd[i].replace("9","t");
       toAdd[i] = toAdd[i].replace("6",randTerrain[r(randTerrain.length)]);
       toAdd[i] = toAdd[i].replace("0",randTerrain[r(randTerrain.length)]);
       toAdd[i] = toAdd[i].replace("#",randTerrain[r(randTerrain.length)]);
       toAdd[i] = toAdd[i].replace(";",randTerrain[r(randTerrain.length)]);
       toAdd[i] = toAdd[i].replace("&",randTerrain[r(randTerrain.length)]);
       toAdd[i] = toAdd[i].replace("8",randTerrain[r(randTerrain.length)]);
      }
    break;

   case 18:
    toAdd = ["WWWWWWW...WWWWWWW",
             "W6666666.6666666W",
             "W6666666.6666666W",
             "W6666666.6666666W",
             "W666666...666666W",
             "W6666.......6666W",
             "W6666.......6666W",
             "W666W.......W666W",
             "W666....i....666W",
             "W666W.......W666W",
             "W6666.......6666W",
             "W6666.......6666W",
             "W666666...666666W",
             "W6666666.6666666W",
             "W6666666.6666666W",
             "W6666666.6666666W",
             "WWWWWWW...WWWWWWW"];
    break;

   case 19:
    toAdd = ["WWWW.WWWW",
             "W$$^.^$$W",
             "WWWW.WWWW",
             "W$$^.^$$W",
             "WWWW.WWWW",
             "W$$^.^$$W",
             "WWWW.WWWW"];
    break;

   case 20:
    toAdd = ["WWWW.WW",
             "W.....W",
             "..333.W",
             "W.313.W",
             "W.333..",
             "W.....W",
             "WW.WWWW"];
    break;

   case 21:
    toAdd = ["7777WW.WWW",
             "71.7.....W",
             "7..8.....W",
             "7777..._.W",
             "W........W",
             "W.WWWWWWWW",
             "W.........",
             "WWWWWWWWWW"];
    break;

   case 22:
    toAdd = ["   .   ",
             "7778777",
             "7$...$7",
             "7$.$.$7",
             "7$.5.$7",
             "7$.$.$7",
             "7$...$7",
             "7778777",
             "   .   "];
    break;

   case 23:
    toAdd = ["WWW.WWW",
             "WW$.$WW",
             "W$777$W",
             "..717..",
             "W$787$W",
             "WW...WW",
             "WWW.WWW"];
    break;

   case 24:
    toAdd = ["WWW.WWW",
             "WW...WW",
             "W.....W",
             "..._...",
             "W.....W",
             "WW...WW",
             "WWW.WWW"];
    break;

   case 25:
    toAdd = ["WWW.WWW",
             "WW...WW",
             "W.^...W",
             "...^...",
             "W...^.W",
             "WW...WW",
             "WWW.WWW"];
   break;

   case 26:
    toAdd = ["WWWWWWWWWW",
             "W...W....W",
             "....W....W",
             "W...W44W.W",
             "W...W44W.W",
             "....W..W.W",
             "W...8.1W.W",
             "WW.WWWWW.W"];
    break;

   case 27:
    toAdd = ["W..WWWWWWW",
             "W..3.....W",
             "W..3..i..W",
             "W..3..i..W",
             "W..3.....W",
             "W..WWWW44W",
             "W..../W...",
             "W..WWWWWWW"];
    break;

   case 28:
    toAdd = ["WWWW..WWWW",
             "W........W",
             "W.778777.W",
             "W.3....3.W",
             "..7.$].7..",
             "..7.$$.7..",
             "W.3....3.W",
             "W.737737.W",
             "W........W",
             "WWWW..WWWW"];
    break;

   case 29:
    toAdd = ["WWWW..WWWW",
             "W........W",
             "W.WW##WW.W",
             "..W????W..",
             "..W????W..",
             "W.WW##WW.W",
             "W........W",
             "WWWW..WWWW"];
    break;

   case 30:
    toAdd = ["WWWWW.WW",
             "W13....W",
             "W.3....W",
             "W.3..m..",
             "W8WWWWWW",
             "......0W",
             "WWWWW.WW"];
    break;

   case 31:
    toAdd = ["WWWWW.WWWWW",
             "W.........W",
             "W..W...W..W",
             "W.WWW8WWW.W",
             "W..W...W..W",
             "...8.9.8...",
             "W..W...W..W",
             "W.WWW8WWW.W",
             "W..W...W..W",
             "W.........W",
             "WWWWW.WWWWW"];
    break;

   case 32:
    toAdd = ["WWWW.WWWW",
             "W.......W",
             "W.WWWWW.W",
             "W.W$$$W.W",
             "W.W$$$W.W",
             "W.W$$$W.W",
             "W.WW8WW.W",
             ".........",
             "WWWWWWWWW"];
    break;

   case 33:
    toAdd = ["WWWW.WWWW",
             "W.......W",
             "W.W...W.W",
             "W.......W",
             "W.W...W.W",
             "W.......W",
             "W.W...W.W",
             "W.......W",
             "W.W...W.W",
             "W.......W",
             "WWWW.WWWW"];
    break;

   case 34:
    toAdd = ["WWWW.WWWW",
             "W.......W",
             "W.WW.WW.W",
             "W.WW.WW.W",
             ".........",
             "W.WW.WW.W",
             "W.WW.WW.W",
             "W.......W",
             "WWWW.WWWW"];
    break;

   case 35:
    toAdd = ["WWWWW.WWWWW",
             "W.........W",
             "W..W...W..W",
             "W.WWW.WWW.W",
             "W..W...W..W",
             ".....M.....",
             "W..W...W..W",
             "W.WWW.WWW.W",
             "W..W...W..W",
             "W.........W",
             "WWWWW.WWWWW"];
   break;

   case 36:
    toAdd = ["WWW.WWWWW",
             "W........",
             "W.W.W.W.W",
             "........W",
             "WWWWW.WWW"];
   break;

   case 37:
    toAdd = ["WWW'WWW'WWW",
             "W'''''''''W",
             "W'W'W'W'W'W",
             "'''c'c'c'''",
             "W'W'W'W'W'W",
             "W''c'c'c''W",
             "W'W'W'W'W'W",
             "'''c'c'c'''",
             "W'W'W'W'W'W",
             "W'''''''''W",
             "WWW'WWW'WWW"];
   break;

   case 38:
    toAdd = ["WWW.WWW.WWW",
             "W.........W",
             "W.W.W.W.W.W",
             "...........",
             "W.W.....W.W",
             "W...._....W",
             "W.W.....W.W",
             "...........",
             "W.W.W.W.W.W",
             "W.........W",
             "WWW.WWW.WWW"];
   break;

   case 39:
    toAdd = ["WWW.WWW.WWW",
             "WM.......MW",
             "W.W.W.W.W.W",
             "...........",
             "W.W.666.W.W",
             "W...666...W",
             "W.W.666.W.W",
             "...........",
             "W.W.W.W.W.W",
             "WM.......MW",
             "WWW.WWW.WWW"];
   break;

   case 40:
    toAdd = ["WWWW.WWWW",
             "WWW=.=WWW",
             "WWW=.=WWW",
             "W===.===W",
             ".........",
             "W===.===W",
             "WWW=.=WWW",
             "WWW=.=WWW",
             "WWWW.WWWW"];
   break;

   case 41:
    toAdd = ["7777777777",
             "71$71$71$7",
             "7$$7$$7$$7",
             "7787787787",
             "..........",
             "7777777777"];
   break;

   case 42:
    toAdd = ["WWWWW.WWWWW",
             "W.........W",
             "W.W3W3W3W.W",
             "W.3,,,,,3.W",
             "W.W,,,,,W.W",
             "..3,,1,,8.W",
             "W.W,,,,,W.W",
             "W.3,,,,,3.W",
             "W.W3W3W3W.W",
             "W.........W",
             "WWWWW.WWWWW"];
   break;

   case 43:
    toAdd = ["W..WWWWWWW",
             "W.......MW",
             "W........W",
             "WWWW8WW..W",
             "W.....WW..",
             "...i...WWW",
             "W........W",
             "WWWWWWWW.W"];
   break;

   case 44:
    toAdd = ["WW.WWWWWWW",
             "W...W....W",
             "W...?.....",
             "W?WWWW?WWW",
             "W..W.....W",
             "W..?..i..W",
             "...W.....W",
             "WWWWWW.WWW"];
   break;

   case 45:
    toAdd = ["WWWWWWWWW.WWWWWWWW",
             "WWWWW.........WWWW",
             "WWWWW.........WWWW",
             "WmmmW...333...WMMW",
             "W...W...313......W",
             "........313...W...",
             "W...W...333...WMMW",
             "WmmmW.........WWWW",
             "WWWWW.........WWWW",
             "WW0....77877.../WW",
             "WWWWWW77...77WWWWW"];
   break;

   case 46:
    toAdd = ["WWWW.WWWW",
             "W..?....W",
             "W.WWWWW.W",
             "W.W$WiW?W",
             "..8$W$8..",
             "W?WiW$W.W",
             "W.WWWWW.W",
             "W....?..W",
             "WWWW.WWWW"];
   break;

   case 47:
    toAdd = ["WWWWWW",
             "W.....",
             "W.WWWW",
             "W.??.W",
             "WWWW.W",
             ".....W",
             "WWWWWW"];
   break;

   case 48:
    toAdd = ["WWWWWWWW.W",
             ".........W",
             "W.777777.W",
             "W87$$$$7=W",
             "W.7$$$$7.W",
             "W.7????7.W",
             "W........W",
             "WWWWWWWWWW"];
   break;

   case 49:
    toAdd = ["WWWWW",
             "W$$$W",
             "W$$$W",
             "W$$$W",
             "WW8WW",
             "  .  "];
   break;

   case 50:
    toAdd = ["WWWWW:W",
             "::::W:W",
             "WWW:W:W",
             "W::?::W",
             "W:W:WWW",
             "W:W::::",
             "W:WWWWW"];
   break;

   case 51:
    toAdd = ["W:W:W",
             "W:W:W",
             "W:::W",
             "WW:WW",
             "WW:WW",
             "WW:WW"];
   break;

   case 52:
    toAdd = ["W:W:W",
             "W:W:W",
             "W:::W",
             "WW:WW",
             ":::WW",
             "WWWWW"];
   break;

   case 53:
    toAdd = ["WWW7WWW",
             "WWm7mWW",
             "W..7..W",
             "...8...",
             "W..7..W",
             "WWm7mWW",
             "WWW7WWW"];
   break;

   case 54:
    toAdd = ["WWW$WWW",
             "WW...WW",
             "W..7..W",
             "$.777.$",
             "W..7..W",
             "WW...WW",
             "WWW$WWW"];
   break;

   case 55:
    toAdd = ["WWW.WWW.WWW",
             "W.........W",
             "W.W.W.W.W.W",
             "...........",
             "W.W.===.W.W",
             "W...=1=...W",
             "W.W.===.W.W",
             "...........",
             "W.W.W.W.W.W",
             "W.........W",
             "WWW.WWW.WWW"];
   break;

   case 56:
    toAdd = ["WWW.WWW",
             "WW...WW",
             "W..3..W",
             "..313..",
             "W..3..W",
             "WW...WW",
             "WWW.WWW"];
   break;

   case 57:
    toAdd = ["WWWWWWWWWWWWW",
             "W...........W",
             "W.?.?.?.?.?.W",
             ".............",
             "W.?.?.?.?.?.W",
             "W...........W",
             "WWW^WWWWWWWWW"];
   break;

   case 58:
    toAdd = ["777777777 ",
             "7$.$.$.$7 ",
             "7...]...8.",
             "7$.$.$.$7 ",
             "777777777 "];
   break;

  case 59:
   toAdd = ["WWWW.WW",
            "W=.=.=W",
            "..c.c.W",
            "W=.=.=W",
            "W.c.c..",
            "W=.=.=W",
            "WW.WWWW"];
   break;

  case 60:
   toAdd = [" =============== ",
            "==.............==",
            "=.......1.......=",
            "=...............=",
            "=...............=",
            "=...............=",
            "=...............=",
            "=...............=",
            "=.......W.......=",
            "=...............=",
            "=...............=",
            "=...............=",
            "=...............=",
            "=...............=",
            "=.......1.......=",
            "==.............==",
            " =============== "];
   break;

  case 61:
   toAdd = ["  ...........  ",
            " 3.m.3...3.m.3 ",
            "...............",
            "...3...3...3...",
            "...............",
            ".3...3   3...3.",
            ".....      ....",
            ".m.3   i   3.m.",
            ".....      ....",
            ".3...3   3...3.",
            "...............",
            "...3...3...3...",
            "...............",
            " 3.m.3...3.m.3 ",
            "  ...........  "];
   break;

  case 62:
   toAdd = ["  .3...3...3.  ",
            " 3.3.3.3.3.3.3 ",
            ".......3.......",
            ".33333.3.33333.",
            ".......3.......",
            ".3.3.3.3.3.3.3.",
            "...3.M333M.3...",
            "33.3.3$i$3.3.33",
            "...3.M333M.3...",
            ".3.3.3.3.3.3.3.",
            ".......3.......",
            ".33333.3.33333.",
            ".......3.......",
            " 3.3.3.3.3.3.3 ",
            "  .3...3...3.  "];
   break;

  case 63:
   toAdd = ["=================================================================",
            "=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=",
            "=================================================================",
            "=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=1=$=$=$=$=$=$=$=$=$=$=$=",
            "=================================================================",
            "=$=$=$=$=$=$=$=$=$=$=$=1=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=",
            "=================================================================",
            "=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=$=",
            "================================================================="];
   break;

  case 64:
   toAdd = ["WWWWWWWWW.WWWWWWWWWWWWWWWWW.WWWWWWWWWWWWWWWWW.WWWWWWWWWWWWWWWWW.WWWWWWWWW",
            "WWWWWW.......WWWWWWWWWWW.......WWWWWWWWWWW.......WWWWWWWWWWW.......WWWWWW",
            "WWWW...........WWWWWWW...........WWWWWWW...........WWWWWWW...........WWWW",
            "WWW.............WWWWW.............WWWWW.............WWWWW.............WWW",
            "WW...............WWW...............WWW...............WWW...............WW",
            "WW...............WWW...............WWW...............WWW...............WW",
            "..................W.................W.................W..................",
            "W........a.................a.................a.................a........W",
            "W.......................................................................W",
            ".......a.=.................=.................=.................=.a.......",
            "W.......................................................................W",
            "W........a.................a.................a.................a........W",
            "..................W.................W.................W..................",
            "WW...............WWW...............WWW...............WWW...............WW",
            "WW...............WWW...............WWW...............WWW...............WW",
            "WWW.............WWWWW.............WWWWW.............WWWWW.............WWW",
            "WWWW...........WWWWWWW...........WWWWWWW...........WWWWWWW...........WWWW",
            "WWWWWW.......WWWWWWWWWWW.......WWWWWWWWWWW.......WWWWWWWWWWW.......WWWWWW",
            "WWWWWWWWW.WWWWWWWWWWWWWWWWW.WWWWWWWWWWWWWWWWW.WWWWWWWWWWWWWWWWW.WWWWWWWWW"];
   break;

  case 65:
   toAdd = ["WW.WWWWWWWWW.WW",
            "W...WWWWWWW...W",
            "..W.........W..",
            "W...WW333WW...W",
            "WW.WW33333WW.WW",
            "WW.WW77877WW.WW",
            "WW.WW7$$$7WW.WW",
            "WW.WW759]7WW.WW", // orb location?
            "WW.WW7$$$7WW.WW",
            "WW.WW77877WW.WW",
            "WW.WW33333WW.WW",
            "W...WW333WW...W",
            "..W.........W..",
            "W...WWWWWWW...W",
            "WW.WWWWWWWWW.WW"];
   break;

  case 66:
   toAdd = ["WW..WW",
            "W....W",
            "..WW..",
            "..WW..",
            "W....W",
            "WW..WW"];
   break;

  case 67:
   toAdd = ["WW.6.WW",
            "W..6..W",
            "..W6W..",
            "666a666",
            "..W6W..",
            "W..6..W",
            "WW.6.WW"];
   break;

  case 68:
   toAdd = ["WWWWWW..W ",
            "...mWW..W ",
            ".''.WW.'WW",
            "WW''..''..",
            " W..'''m..",
            " W.'WWWWWW",
            " Wm.W     ",
            " W..W     "];
   break;

  case 69:
   toAdd = ["   W..W   ",
            "   W..W   ",
            "WWWW..WWWW",
            "....mm....",
            "....mm....",
            "WWWW..WWWW",
            "   W..W   ",
            "   W..W   "];
   break;

  case 70:
   toAdd = ["WWWW.WWWW",
            "W13W.W31W",
            "W33...33W",
            "WW.....WW",
            "....M....",
            "WW.....WW",
            "W33...33W",
            "W13W.W31W",
            "WWWW.WWWW"];
   break;

  case 71:
   toAdd = ["WWWWW.WWWWW",
            "WWWW...WWWW",
            "WWW.....WWW",
            "WW.......WW",
            "W...W.W...W",
            ".....].....",
            "W...W.W...W",
            "WW.......WW",
            "WWW.....WWW",
            "WWWW...WWWW",
            "WWWWW.WWWWW"];
   break;

  case 72:
   toAdd = ["WWWWW.WWWWW",
            "W.........W",
            "W.W.W.W.W.W",
            "W.........W",
            ".....M.....",
            "W.........W",
            "W.W.W.W.W.W",
            "W.........W",
            "WWWWW.WWWWW"];
   break;

  case 73:
   toAdd = ["WWWWWW..WW",
            "W.i.W....W",
            "W...W..c.W",
            "....3....W",
            "W...W....W",
            "W.m.W.c..W",
            "W...W....W",
            "WW.WWW..WW"];
   break;

  case 74:
   toAdd = ["WWWWW",
            "..0..",
            "WW.WW",
            " W.W "];
   break;

  case 75:
   toAdd = [" WWWWW",
            ".44.WW",
            "777877",
            "7$$$$7",
            "7$$$$7",
            "7$$$$7",
            "7$$$$7",
            "778777",
            "WW..3.",
            "WWWWW "];
   break;

  case 76:
   toAdd = ["/W/",
            "WWW",
            "/W/"];
   break;

  case 77:
   toAdd = ["WWWWW...W",
            "...cW.m..",
            "....W....",
            ".c..8..m.",
            "....W....",
            "..c.WM...",
            "W...WWWWW"];
   break;

  case 78:
   toAdd = ["WWWWWWWWWWW ",
            "W....i....W ",
            "W.$......$W ",
            "W......7777 ",
            "W^.$.$.===7 ",
            ".^======1.8.",
            "W^.....===7 ",
            "W..$.$.7777 ",
            "W.......$.W ",
            "W...$.....W ",
            "WWWWWWWWWWW "];
   break;

  case 79:
   toAdd = ["   WWWWWW   ",
            "  WWWWWWWW  ",
            "WWW444444WW ",
            "WWW44WWW44WW",
            ".444WWWW44WW",
            ".44WW14444WW",
            ".44WW44444WW",
            ".444W4444WWW",
            "WW44WWW44WWW",
            " WW444444WWW",
            "  WWW44WWWW ",
            "   WWWWWW   "];
   break;

  case 80:
   toAdd = ["WW.W",
            "Wm.W",
            "W..W",
            "W..W",
            "....",
            "W..W",
            "W..W",
            "W.mW",
            "W.WW"];
   break;

  case 81:
   toAdd = ["WWWWWW.WW",
            "W/......W",
            "W.......W",
            "W.WWWWW.W",
            "W.W,,,W..",
            "W.W,1,W.W",
            "..W,,,W.W",
            "W.WWWWW.W",
            "W.......W",
            "WWW..WWWW"];
   break;

  case 82:
   toAdd = [" ,,,,, ",
            ",,sss, ",
            ",ssss,,",
            ",,ssss,",
            ",sssss,",
            ",,ss,,,",
            " ,,,,  "];
   break;

  case 83:
   toAdd = ["WW.WWWWWW",
            "WW...W...",
            "WW.W/W.WW",
            "WW.WWW.WW",
            "WW...3.WW",
            "..mWWW.WW",
            "WWWWWW.WW"];
   break;

  case 84:
   toAdd = ["WWW",
            "WiW",
            "W^W"];
   break;

  case 85:
   toAdd = ["WWWWWW",
            "W.....",
            "W/.a.W",
            "WWWWWW"];
   break;

  case 86:
   toAdd = ["  ,,==,,",
            "==,,,==,",
            "==,,,,=,",
            "====i,==",
            "====,,,=",
            ",,===,,,",
            " ,,===, "];
   break;

  case 87:
   toAdd = ["  =====   ",
            " ======   ",
            "========  ",
            "========  ",
            "==i ======",
            "===   ====",
            "=====  ===",
            " =====    ",
            "   ===    ",
            "     =    "];
   break;

  case 88:
   toAdd = ["W=====WW ",
            "W=======W",
            " ===1===W",
            " ===^===W",
            "W===^====",
            "====^===="];
   break;

   case 89:
    toAdd = ["   444 ",
             " 444444",
             " 44??44",
             "444??44",
             " 444444",
             " 44444 "];
   break;

   case 90:
    toAdd = ["WWWWWWW...WWWWWWW",
             "W===============W",
             "W===============W",
             "W===============W",
             "W======W.W======W",
             "W====.......====W",
             "W====.......====W",
             "W===W.......W===W",
             "W===..1.1.1..===W",
             "W===W.......W===W",
             "W====.......====W",
             "W====.......====W",
             "W======W.W======W",
             "W===============W",
             "W===============W",
             "W===============W",
             "WWWWWWW...WWWWWWW"];
    break;

   case 91:
    toAdd = ["WWW6WWW",
             "WW.6.WW",
             "W..6..W",
             "...6...",
             "W..6..W",
             "WW.6.WW",
             "WWW6WWW"];
   break;

   case 92:
    toAdd = ["WWW.WWW",
             "WW...WW",
             "W..b..W",
             "..~7=..",
             "W..s..W",
             "WW...WW",
             "WWW.WWW"];
   break;

   case 93:
    toAdd = ["W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W",
             "W:W"];
   break;

   case 94:
    toAdd = ["33333333333333333333",
             "....................",
             "33333333333333333333"];
   break;


   case 95:
    toAdd = ["WWWWWWWWWWWWW",
             "W...........W",
             "W.=.=.=.=.=.W",
             "......M......",
             "W.=.=.=.=.=.W",
             "W...........W",
             "WWW3WWWWWWWWW"];
   break;

   case 96:
    toAdd = ["WWW4WWW",
             "WW.4.WW",
             "W..4..W",
             "...4...",
             "W..4..W",
             "WW.4.WW",
             "WWW4WWW"];
   break;

   case 97:
    toAdd = ["...4...4...4...",
             ".4.4.4.4.4.4.4.",
             "...c...4...c...",
             ".44444.4.44444.",
             ".......4.......",
             ".4.4.44444.4.4.",
             "...4.4.$.4.4...",
             "44.4c4$$$4c4.44",
             "...4.4.$.4.4...",
             ".4.4.44444.4.4.",
             ".......4.......",
             ".44444.4.44444.",
             "...c...4...c...",
             ".4.4.4.4.4.4.4.",
             "...4...4...4..."];
   break;

   case 98:
    toAdd = ["W.WWWWW",
             "W=...#.",
             "W..$..W",
             "W.$_$.W",
             "W..$..W",
             ".s...^W",
             "WWWWW.W"];
   break;

   case 99:
    toAdd = ["W..W",
             ".44.",
             ".44.",
             "W..W"];
   break;

   case 100:
    toAdd = [" WW0WW ",
             "WW...WW",
             "3.$.$.3",
             "W..]..W",
             "3.$.$.3",
             "WW...WW",
             " WW8WW ",
             "   .   "];
   break;

   case 101:
    toAdd = ["WWWWWW.WW.WWWWWW",
             "W..............W",
             "W....WW..WW....W",
             ".....WW..WW.....",
             "W....WW..WW....W",
             "W......MM......W",
             "W....WW..WW....W",
             ".....WW..WW.....",
             "W....WW..WW....W",
             "W..............W",
             "WWWWWW.WW.WWWWWW"];
   break;

   case 102:
    toAdd = ["WWWWWWWWWWWW  ",
             ".....^.....WWW",
             ".WWWWWWWWW...W",
             "WW...^...WWW.W",
             " W.WWWWW.WWW^W",
             " W^Wi15$.WWW.W",
             " W.WWWWWWWW..W",
             " W....WWW...WW",
             " WWWW..^..WWW ",
             "    WWWWWWW   "];
   break;

   case 103:
    toAdd = [" ==.== ",
             "==,,,==",
             "=,,,,,=",
             "=,,1,,=",
             "==,,,= ",
             " ====  "];
   break;

   case 104:
    toAdd = ["     44444     ",
             "    4444444    ",
             "   44.....44   ",
             "  44.......44  ",
             " 44..44444..44 ",
             "44..4444444..44",
             "44..44$$$44..44",
             "44..44$$$44..44",
             "44..44$$$44..44",
             "44..4444444..44",
             " 44..44444..44 ",
             "  44.......44  ",
             "   44.....44   ",
             "    4444444    ",
             "     44444     "];
   break;

   case 105:
    toAdd = ["     W4W4W     ",
             "   W4.....4W   ",
             "  4...._....4  ",
             " W...........W ",
             " 4...37373...4 ",
             "W...3.....3...W",
             "4..7..$$$..7..4",
             "W..3..$1$..3..W",
             "4..7..$$$..7..4",
             "W...3.....3...W",
             " 4...37873...4 ",
             " W...........W ",
             "  4...._....4  ",
             "   W4.....4W   ",
             "     W4W4W     "];
   break;

   case 106:
    toAdd = ["     7.7.7     ",
             "   7.......7   ",
             "  .....m.....  ",
             " 7...........7 ",
             " .....7.7..... ",
             "7.............7",
             "...7.......7...",
             "7......1......7", // orb location?
             "...7.......7...",
             "7......m......7",
             " ............. ",
             " 7....7.7....7 ",
             "  ...........  ",
             "   7.......7   ",
             "     7.7.7     "];
   break;

   case 107:
    toAdd = ["   77777    77777   ",
             " 777414777777616777 ",
             "77$$4.4$$77$$6.6$$77",
             "77$$4.4$$77$$6.6$$77",
             "77$$4.4$$77$$6.6$$77",
             "77777877777777877777",
             "77   .  7777  .   77",
             "7        77        7"];
   break;

   case 108:
    toAdd = ["     WW     ",
             "  6WW16WW6  ",
             "WW66$W6666WW",
             "666WW66WW666",
             "WW6666W$66WW",
             "  6WW61WW6  ",
             "     WW     "];
   break;

   case 109:
    toAdd = ["7777777      ",
             "7.....7      ",
             "7._._.7.7.7.7",
             "7.....8......",
             "7._._.7.7.7.7",
             "7.....7      ",
             "7777777      "];
   break;

   case 110:
    toAdd = ["   WWWW...WWWW   ",
             "  W.....W.....W  ",
             "  W.??..W..??.W  ",
             "  W.??..W..??.W  ",
             "  W....WWW....W  ",
             "W....WW$$$WW....W",
             "W....8$$1$$8....W",
             "W....WW$$$WW....W",
             "  W....WWW....W  ",
             "  W.??..W..??.W  ",
             "  W.??..W..??.W  ",
             "  W.....W.....W  ",
             "   WWWW...WWWW   "];
   break;

   case 111:
    toAdd = ["W...W",
             "W...W",
             "W...W",
             "W...W",
             "W;;;W",
             "W;;;W",
             "W;;;W",
             "W;_;W",
             "W;;;W",
             "W;;;W",
             "W;;;W",
             "W...W",
             "W...W",
             "W...W",
             "W...W"];
   break;

   case 112:
    toAdd = ["~~~",
             "~~~",
             "~7~",
             "~~~",
             "~~~",
             "~~~",
             "~~~",
             "~7~",
             "~~~",
             "~~~",
             "~~~",
             "~~~",
             "~7~",
             "~~~",
             "~~~"];
   break;

   case 113:
    toAdd = ["7777777WWW7777777",
             "7$.$.$=...=$,$,$7",
             "7.;;;.=._.=,,,,,7",
             "7.;1;.=...=,$i$,7",
             "7.;;;.=...=,,,,,7",
             "7$.$.$=...=$,$,$7",
             "7777777...7777777",
             "     WWW8WWW     ",
             "        .        "];
   break;

   case 114:
    toAdd = ["    WWW    ",
             "    W_W    ",
             "    ...    ",
             "WWWWW.WWWWW"];
   break;

   case 115:
    toAdd = ["6    6  6  6   66",
             "66   6  6  6  66 ",
             " 66  66 6 66 66  ",
             "  66  6 6 6 66   ",
             "   66 6666666    ",
             "666 66 66666  666",
             "  666666666 666  ",
             "    666$$$666    ",
             "6666666$_$6666666",
             "    666$$$666    ",
             "  666 666666666  ",
             "666  66666 66 666",
             "    6666666 66   ",
             "   66 6 6 6  66  ",
             "  66 66 6 66  66 ",
             " 66  6  6  6   66",
             "66   6  6  6    6"];
   break;

   case 116:
    toAdd = [" .WWW  ",
             " ..4WW ",
             " 7744WW",
             "774444W",
             "7i$444W",
             "774444W",
             " 7744WW",
             " ..4WW ",
             " .WWW  "];
   break;

   case 117:
    toAdd = ["      77777      ",
             "      7$$$7      ",
             "      7$i$7      ",
             "      7$$$7      ",
             "      77877      ",
             "        .        ",
             "77777 77.77 77777",
             "7$$$7 7...7 7$$$7",
             "7$i$8...0...8$i$7",
             "7$$$7 7...7 7$$$7",
             "77777 77.77 77777",
             "        .        ",
             "      77877      ",
             "      7$$$7      ",
             "      7$i$7      ",
             "      7$$$7      ",
             "      77777      "];
   break;

   case 118:
    toAdd = ["  6.6  ",
             " 66.66 ",
             " 66666 ",
             " 66666 ",
             "WWW8WWW",
             "W$...$W",
             "W$._.$W",
             "W$...$W",
             "WW$$$WW",
             " WWWWW "];
   break;

   case 119:
    toAdd = [" ..'.WW   ",
             "WWm..'bWW ",
             "  WW..'bWW",
             "   WWW.'bW",
             "   WWWb'MW",
             "  '.'b'.WW",
             "WWW.bb'.W ",
             " ...'.WWW ",
             " ..m.WW   ",
             "  WWWW    "];
   break;

   case 120:
    toAdd = [" WW.WW ",
             "WWW0WWW",
             "WW$$$WW",
             ".0$1$0.",
             "WW$$$WW",
             "WWW0WWW",
             " WW.WW "];
   break;

   case 121:
    toAdd = ["    WWW    ",
             "   WW'WW   ",
             "   W'5'W   ",
             " WWWW'WWWW ",
             "WW''W8W''WW",
             "W'9'8.8']'W",
             "WW'WW.WW'WW",
             " WWW...WWW ",
             "   ..W..   ",
             "    WWW    "];
   break;

   case 122:
    noFlip = true;
    noRotate = true;
    toAdd = ["     .     ",
             "  77...77  ",
             " 777787777 ",
             "77$$787$$77",
             "77$$$$$$$77",
             " 77$$$$$77 ",
             "  77$1$77  ",
             "   77$77   ",
             "    777    "];
   break;

   case 123:
    noFlip = true;
    noRotate = true;
    toAdd = ["     777     ",
             "    77=77    ",
             "   77$=$77   ",
             "  77$$=$$77  ",
             " 77$$$=$$$77 ",
             "77$$$$=$$$$77",
             "7$9$78787$]$7",
             "77$77.7.77$77",
             " 777.^7^.777 ",
             "   ..777..   "];
   break;

   case 124:
    toAdd = ["'''''",
             "'b'b'",
             "''_''",
             "'b'b'",
             "'''''"];
   break;

   case 125:
    toAdd = [" WWWWW ",
             "WW6i6WW",
             "W$6.6WW",
             "WW6.6$W",
             "W$6.6WW",
             "WW6.6$W",
             "W$6.6WW",
             "WW6.6$W",
             "WWW8WWW",
             "   .   "];
   break;

   case 126:
    toAdd = ["  .  ",
             " ... ",
             ".._..",
             " ... ",
             "  .  "];
   break;

   case 127:
    toAdd = ["  666  ",
             " 66666 ",
             "6666666",
             "..._666",
             "6666666",
             " 66666 ",
             "  666  "];
   break;

   case 128:
    toAdd = ["    66666    ",
             "  666666666  ",
             " 66666666666 ",
             "66666$$$66666",
             "66666$_$66666",
             "66666$$$66666",
             " 66666666666 ",
             " 666666666   ",
             "   66666     "];
   break;

   case 129:
    toAdd = ["777.777.777...7777.7777....7777.7777...777.777.777",
             "77777777777787777777777788777777777778777777777777",
             "777.777.777...7777.7777....7777.7777...777.777.777"];
   break;

   case 130:
    toAdd = ["WWWW..WWWW",
             "WaWW..WWaW",
             "W........W",
             "W.bW^^W~.W",
             "..WW$$WW..",
             "..WW$$WW..",
             "W.=W^^Ws.W",
             "W........W",
             "WaWW..WWaW",
             "WWWW..WWWW"];
   break;

   case 131:
    toAdd = ["77777.77777",
             "7$$$7.7$$$7",
             "7$$$7.8$$$7",
             "7$$$7.7$$$7",
             "77877 77777",
             "....   ....",
             "77777 77877",
             "7$$$7.7$$$7",
             "7$$$8.7$$$7",
             "7$$$7.7$$$7",
             "77777.77777"];
   break;

   case 132:
    toAdd = ["bbbbbbbbbbbbb",
             "b'''''b'''''b",
             "b'bbbbbbbbb'b",
             "b'b'''b'''b'b",
             "b'b'bbbbb'b'b",
             "b'b'ba'ab'b'b",
             "bbbbb'_'bbbbb",
             "b'b'ba'ab'b'b",
             "b'b'bbbbb'b'b",
             "b'b'''b'''b'b",
             "b'bbbbbbbbb'b",
             "b'''''b'''''b",
             "bbbbbbbbbbbbb"];
   break;

   case 133:
    toAdd = ["777777777777",
             "7========$$7",
             ".,,,,,,,,$i7",
             "7========$$7",
             "777777777777"];
   break;

   case 134:
    toAdd = ["   WWW.WW.WW.WWW   ",
             "  WW'''''''''''WW  ",
             " WW'''''''''''''WW ",
             "WW'.............'WW",
             "W'......MbM......'W",
             "....m...bbb...m....",
             "....m...bbb...m....",
             "W'......MbM......'W",
             "WW'.............'WW",
             " WW'''''''''''''WW ",
             "  WW'''''''''''WW  ",
             "   WWW.WW.WW.WWW   "];
   break;

   case 135:
    toAdd = ["             WWWW             ",
             "       WWWWWW....WWWWWW       ",
             "    WWW................WWW    ",
             "  WW...........M..........WW  ",
             " W......W W........WWW......W ",
             "W.....WW W WW.....W   WW.....W",
             " ....W      W77877W     W.... ",
             "....W        7...7       W....",
             "..WW         7i.i7        WW  ",
             " W           7.i.7            ",
             "             77777            "];
   break;

   case 136:
    toAdd = ["       !!!!!!!      ",
             "     !!!!!PPP!!!    ",
             "  !!!!!!!;;PPPP!!!  ",
             "  !PPPPPPP;;PPPPP!  ",
             " !!PPPPPPPP;;;PPP!! ",
             " !PPP;;;;PPP;;;PPP! ",
             " !PP;;;;;PPP;;;;PP!!",
             "!!PP;;i;;?PP;;;;PPP!",
             "!PPP;;;;;PPP;;;;;PP!",
             "!PP;;;;;;PPP;;;;;PP!",
             "!PP;;;;;PPPP;;;;;PP!",
             "!PP;;;;;PPP;;;;;;PP!",
             "!PP;;;;;PP;;;;;;PPP!",
             "!PPP;?;;PP;;;1;;PPP!",
             "!!PP;;;;PP;;;;;;PP!!",
             " !PPP;;;PPP;;;;PPP! ",
             " !!PPP;;;PPPPPPPP!! ",
             "  !PPPPP;;PPPPPPP!  ",
             "  !!!PPPP;;!!!!!!!  ",
             "    !!!PPP!!!!!     ",
             "      !!!!!!!       "];
   break;

   case 137:
    toAdd = ["  WW.WW  ",
             " WW...WW ",
             "WW.....WW",
             "W.......W",
             "....i....",
             "W.......W",
             "WW.....WW",
             " WW...WW ",
             "  WW.WW  "];
   break;

   case 138:
    toAdd = ["   PPP...PPP   ",
             "  PP;;;;;;;PP  ",
             " PP;;;...;;;PP ",
             " P;;;.444.;;;P ",
             "PP;;.44444.;;PP",
             "P;;.44   44.;;P",
             "P;;.44 i 44.;;P",
             "P;;.44   44.;;P",
             "PP;;.44444.;;PP",
             " P;;;.444.;;;P ",
             " PP;;;...;;;PP ",
             "  PP;;;;;;;PP  ",
             "   PPP...PPP   "];
   break;

   case 139:
    toAdd = ["  777     777  ",
             " 7767777777677 ",
             "77...77677...77",
             "76.1..8.8..1.67",
             "77...77.77...77",
             " 7767766677677 ",
             "  77777.77777  ",
             "       .       "];
   break;

   case 140:
    toAdd = ["666 333",
             "6i6.313",
             "666.333",
             " ..0.. ",
             "PPP.444",
             "P1P.4i4",
             "PPP 444"];
   break;

   case 141:
    toAdd = ["          W          ",
             "         WWW         ",
             "        WW0WW        ",
             "   WWWWWW$$$WWWWWW   ",
             "   W0$$WWW3WWW$$0W   ",
             "   W$$WW.....WW$$W   ",
             "   W$WW.......WW$W   ",
             "   WWW....7....WWW   ",
             "  WWW...7...7...WWW  ",
             " WW$W...........W$WW ",
             "WW0$3..7.._..7..3$0WW",
             " WW$W...........W$WW ",
             "  WWW...7...7...WWW  ",
             "   WWW....7....WWW   ",
             "   W$WW.......WW$W   ",
             "   W$$WW.....WW$$W   ",
             "   W0$$WWW8WWW$$0W   ",
             "   WWWWWW0.0WWWWWW   ",
             "        WW.WW        ",
             "         ...         ",
             "          W          "];
   break;

   case 142:
    toAdd = ["                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                  .W.                  ",
             "                 ..W..                 ",
             "                .44W4..                ",
             "WWWWWWWWWWWWWWWWWW444WWWWWWWWWWWWWWWWWW",
             "                ..4W44.                ",
             "                 ..W..                 ",
             "                  .W.                  ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   ",
             "                   W                   "];
   break;

   case 143:
    toAdd = ["   ppp   ",
             " pppPppp ",
             " pPpppPp ",
             "ppppppppp",
             "pPppippPp",
             "ppppppppp",
             " pPpppPp ",
             " pppPppp ",
             "   ppp   "];
   break;

   case 144:
    toAdd = ["WWWWW..WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW..WWWWW",
             "WWWW....WWWWaWWWWaWWWWaWWWWaaaWWWWaaaWWWWaWWWWaWWWWaWWWW....WWWW",
             "WWW......WW...WW...WW...WW.....WW.....WW...WW...WW...WW..m...WWW",
             "WW..m.........................................................WW",
             ".......W....m.........W.....m............W....m.........W.......",
             "......WWW............WWW................WWW............WWW......",
             "WW...WWWWW..........WWWWW..............WWWWW..........WWWWW...WW",
             "WW...WWWWW...........WWW................WWW......m....WWWWW...WW",
             "......WWW........m....W........m.........W.............WWW...m..",
             "WW....WWW.....................M........................WWW....WW",
             "WW.....W................................................W.....WW",
             "WM........m...............M....77.............................MW",
             "WW...m........WW..............7777..M..m........WW........m...WW",
             "WWW....A.....WWWW..m..........7777.............WWWW.....A....WWW",
             "WW............WW..............7777..............WW............WW",
             "WM..........................M..77.............................MW",
             "WW.....W..................m.......M....m................W.....WW",
             "WW....WWW.........................................m....WWW....WW",
             "......WWW.....m.......W............m.....W.............WWW..m...",
             ".....WWWWW...........WWW................WWW...........WWWWW.....",
             "WW...WWWWW..........WWWWW..............WWWWW..........WWWWW...WW",
             "WW....WWW............WWW.........m......WWW...mm.......WWW....WW",
             "....m..W..m...........W..................W..............W.......",
             "WW.........................m..................................WW",
             "WWW......WW...WW...WW...WW.....WW.....WW...WW...WW...WW...m..WWW",
             "WWWW....WWWWaWWWWaWWWWaWWWWaaaWWWWaaaWWWWaWWWWaWWWWaWWWW....WWWW",
             "WWWWW..WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW..WWWWW"];
   break;

   case 145:
    toAdd = ["  ;;PPPP;;   ",
             " ;;P;;;;P;;  ",
             ";;P;;;~;;P;; ",
             ";P;;PP~~;P$;;",
             ";;;P~~i~~P;;;",
             ";;$P;~~PP;;P;",
             " ;;P;;~~;;P;;",
             "  ;;P;;;;P;; ",
             "   ;;PPPP;;  "];
   break;

   case 146:
    toAdd = [" 7777777777777777777",
             " 7b7???a???1???a???7",
             ".8b7?a1??a???a???a?7",
             " 7b7???a???t???a???7",
             ".8b8'a???a???a???a?7",
             " 7b7???a???????a??17",
             ".8b7?a???a???a???a?7",
             " 7b7???a??????1a???7",
             " 7777777777777777777"];
   break;

   case 147:
    toAdd = ["    W.W    ",
             "    W.W    ",
             "    W.W    ",
             "   WW.WW   ",
             "WWWW###WWWW",
             "....#i#....",
             "WWWW###WWWW",
             "   WW.WW   ",
             "    W.W    ",
             "    W.W    ",
             "    W.W    "];
   break;

   case 148:
    toAdd = ["   7 7   ",
             " 7PP3PP7 ",
             " PP;);PP ",
             "7P;););P7",
             " 3);1;)3 ",
             "7P;););P7",
             " PP;);PP ",
             " 7PP3PP7 ",
             "   7 7   "];
   break;

   case 149:
    toAdd = ["        77777        ",
             "        7$$$7        ",
             "        7$i$7        ",
             "        7$$$7        ",
             "        77877        ",
             "          .          ",
             "                     ",
             "    3333      PPPP   ",
             "    3$$3      P$$P   ",
             "    3$$3      P$$P   ",
             "    3333      PPPP   ",
             "                     ",
             "          _          ",
             "6666             4444",
             "6??6             4??4",
             "6??6             4??4",
             "6666             4444"];
   break;

   case 150:
    toAdd = [" W  WWWWWWWWWW    ",
             "WW  WWmWWWiWWWPWW ",
             "  ' W$$$W$$$W$$$WW",
             " '' W$9$P$$$=$$$0W",
             "WW..W$$$W$$$W$$$WW",
             "WW..WW8WWW8WWW3WWW",
             "W44.............6W",
             "W44444..........6W",
             "WWW4WWW8WWW8WW..WW",
             "WW44$W$$$W$$$W..WW",
             "W44$$=$$$P$]$W.'' ",
             "WW$$$W$$$W$$$W'   ",
             "WWWiWWWmWWWmWW' WW",
             " WWWWWWWWWWWWW  W "];
   break;

   case 151:
    toAdd = ["      .      ",
             "   W3W8W3W   ",
             "  WW##.##WW  ",
             " WW#..7..#WW ",
             " 3#.7.).7.#3 ",
             " W#..)))..#W ",
             ".8.7))1))7.8.",
             " W#..)))..#W ",
             " 3#.7.).7.#3 ",
             " WW#..7..#WW ",
             "  WW##.##WW  ",
             "   W3W8W3W   ",
             "      .      "];
   break;

   case 152:
    toAdd = ["    WWWWW        ",
             "    W...W        ",
             "    W.i.W        ",
             "    W...W        ",
             "WW WW...WW WW    ",
             "W....6 .....W    ",
             " .m.. 6 .m..     ",
             "W......6....W    ",
             "WW WWWWW6WWWWW WW",
             "    W....6......W",
             "     .m.. 6 ..m. ",
             "    W..... 6....W",
             "    WW WW...WW WW",
             "        W...W    ",
             "        W.i.W    ",
             "        W...W    ",
             "        WWWWW    "];
   break;

   case 153:
    toAdd = ["  WWWWWWW..         ",
             " WWWWWWW ...WWWWWWW ",
             " WW$$..WW... WWWWWWW",
             " WW$$WsWW...WW4444WW",
             " WW.WWssWW..WW4714WW",
             " WW.sssss..WW44774WW",
             " WWWWssWW...8.4444WW",
             " W WWWWW....WW4MWWWW",
             " ....W.. 66 .WWWWW W",
             "........6666...W....",
             "....W...6666........",
             "W WWWWW. 66 ..W.... ",
             "WWWW$$WW....WWWWW W ",
             "WW$cc..8...WWbbWWWW ",
             "WW$77c.WW..8.bbb.WW ",
             "WWc]7cWW..WWbbWWmWW ",
             "WWcc$$WW...WWbW5mWW ",
             "WWWWWWW ...WWbbmmWW ",
             " WWWWWWW... WWWWWWW ",
             "         ..WWWWWWW  "];
   break;

   case 154:
    toAdd = ["            WWWWWWWWWWW  ",
             "            W%%.%W%...W  ",
             "           WW.%.%%%.%.WWW",
             "         WWW..%..%..%....",
             "         W%..%%%.%.%%%.P.",
             "         W$%%%W%$..%W%...",
             "         Wi%.%%WWWWWWW   ",
             "   WWWWWWW%%.%iW         ",
             "...%W%.%$%W%%%$W         ",
             ".P.%%%.%.%%%..%W         ",
             "....%..%..%..WWW         ",
             "WWW.%.%%%.%.WW           ",
             "  W.%.%W%.%%W            ",
             "  WWWWWWWWWWW            "];
   break;

   case 155:
    toAdd = ["          777          ",
             "         77$77         ",
             "        77$$$77        ",
             "       77sssss77       ",
             "77777777sss7sss77777777",
             "7$$$$$$sssssssss$$$$$$7",
             "777$$ssss7sss7ssss$$777",
             "  777ssssss$ssssss777  ",
             "    777sss$t$sss777    ",
             "  777ssssss$ssssss777  ",
             "777$$ssss7sss7ssss$$777",
             "7$$$$$$sssssssss$$$$$$7",
             "77777777sss7sss77777777",
             "       77sssss77       ",
             "        77sss77        ",
             "         77?77         ",
             "          7.7          ",
             "          ...          "];
   break;

   case 156:
    toAdd = ["  WW44W44WW  ",
             " WW44WWW44WW ",
             "WWW$$WWW$$WWW",
             "WWW$WWWWW$WWW",
             "WWWWWW_WWWWWW",
             "WW$a66M66a$WW",
             " WWa66.66aWW ",
             " WWaa...aaWW ",
             "  WWaa.aaWW  ",
             "   WWa.aWW   ",
             "    WW8WW    ",
             "      .      "];
   break;

   case 157:
    toAdd = ["      7      ",
             "     777     ",
             "    77577    ",
             "   77$$$77   ",
             "  777787777  ",
             " 77$7.m.7$77 ",
             "779$8.=.8$]77",
             " 77$7...7$77 ",
             "  777787777  ",
             "   77=.=77   ",
             "    77.77    ",
             "     7.7     ",
             "      .      "];
   break;

   case 158:
    toAdd = ["          ;          ",
             "          ;          ",
             "         ;;;         ",
             "         ;!;         ",
             "        ;;!;;        ",
             "       ;;!!!;;       ",
             "      ;;!!;!!;;      ",
             "     ;;!!;;;!!;;     ",
             "    ;;!P;;);;P!;;    ",
             "  ;;;!!;;)$);;!!;;;  ",
             ";;;!!!;;)$_$);;!!!;;;",
             "  ;;;!!;;)$);;!!;;;  ",
             "    ;;!P;;);;P!;;    ",
             "     ;;!!;;;!!;;     ",
             "      ;;!!;!!;;      ",
             "       ;;!!!;;       ",
             "        ;;!;;        ",
             "         ;!;         ",
             "         ;;;         ",
             "          ;          ",
             "          ;          "];
   break;

   case 159:
    toAdd = [" 77777777 ",
             "77......77",
             "7$.=..=.$7",
             "7$$=..=$$7",
             "7$$=..=$$7",
             "7$$=..=$$7",
             "777=44=777",
             "  7=44=7  ",
             "  444444  ",
             "  7====7  "];
   break;

   case 160:
    toAdd = ["777777777",
             "71$$$$$17",
             "7ccc)ccc7",
             "7..)M)..7",
             "7c.....c7",
             "777787777",
             "777bbb777",
             "77b'''b77",
             " 77'''77 ",
             "  7b'b7  "];
   break;

   case 161:
    toAdd = ["      ~~~~      ",
             "   ~~~~~~~~~~   ",
             "  ~~~7~~~~7~~~  ",
             " ~~~~~~~~~~~~~~ ",
             " ~~7~~7777~~7~~ ",
             " ~~~~~8$$7~~~~~ ",
             "~~7~777$$787~7~~",
             "~~~~7$i==$$7~~~~",
             "~~~~7$$==i$7~~~~",
             "~~7~787$$777~7~~",
             " ~~~~~7$$8~~~~~ ",
             " ~~7~~7777~~7~~ ",
             " ~~~~~~~~~~~~~~ ",
             "  ~~~7~~~~7~~~  ",
             "   ~~~~~~~~~~   ",
             "      ~~~~      "];
   break;

   case 162:
    toAdd = ["  .WWWWWWWWWW.  ",
             " .............. ",
             "..$..........$..",
             "W....666666....W",
             "W..6666666666..W",
             "W..6666666666..W",
             "W....666666....W",
             "..$..........$..",
             " .............. ",
             "  .WWWWWWWWWW.  "];
   break;

   case 163:
    toAdd = ["WWW...WWW",
             "WW..)..WW",
             "W..)))..W",
             "..)...)..",
             ".))._.)).",
             "..)...)..",
             "W..)))..W",
             "WW..)..WW",
             "WWW...WWW"];
   break;

   case 164:
    toAdd = ["7777.7777",
             "7#######7",
             "7#78777#7",
             "7#71718#7",
             ".#77777#.",
             "7#81717#7",
             "7#77787#7",
             "7#######7",
             "7777.7777"];
   break;

   case 165:
    toAdd = ["WWWWWWWWWWWWWW",
             "?$?$?$WW$?$?$?",
             "WWWWWWWWWWWWWW",
             "?$?$?$WW$?$?$?",
             "WWWWWWWWWWWWWW",
             "?$?$?$WW$?$?$?",
             "WWWWWWWWWWWWWW",
             "?$?$?$WW$?$?$?",
             "WWWWWWWWWWWWWW"];
   break;

   case 166:
    toAdd = [" PPPPP   PPPPP ",
             "PP;p;PP PP;;;PP",
             "P;;;;;P P;;p;;P",
             "P;;;;p;;;;;;;;P",
             "P;p;;;PPP;;;;;P",
             "PP;;;PP$PPp;;PP",
             "  P;PP$$$PP;P  ",
             "  P;PP$$$PP;P  ",
             "PP;;;PP$PP;;;PP",
             "P;;p;;PPP;;;p;P",
             "P;;;;;;;;;p;;;P",
             "P;;;p;P P;;;;;P",
             "PP;;;PP PP;;;PP",
             " PPPPP   PPPPP "];
   break;

   case 167:
    toAdd = ["WWWWWW.WWWWWWW",
             "WWW........WWW",
             "WW...6666...WW",
             "W...666666...W",
             "....66ii66....",
             "W...666666...W",
             "WW...6666...WW",
             "WWW........WWW",
             "WWWWWWW.WWWWWW"];
   break;

   case 168:
    toAdd = ["    !    ",
             "   !;!   ",
             "  !;);!  ",
             " !;)!);! ",
             "!;)!1!);!",
             " !;)!);! ",
             "  !;);!  ",
             "   !;!   ",
             "    !    "];
   break;

   case 169:
    toAdd = [" WWWWWWWWWWWWWWWWWWWWWWWWWWWWWW ",
             " .?...?...?...?...?...?...?...? ",
             "================================",
             " ?..?...?...?...?...?...?...?.. ",
             " WWWWWWWWWWWWWWWWWWWWWWWWWWWWWW "];
   break;

   case 170:
    toAdd = ["    676    ",
             "   67_76   ",
             "  67.6.76  ",
             " 67$...$76 ",
             "67$$787$$76",
             " 7777.7777 "];
   break;

   case 171:
    toAdd = [" 7777777 ",
             " 7]75797 ",
             "778787877",
             "77$$$$$77",
             "77$$$$$77",
             "777877777",
             "7$$$7$$$7",
             "7$i$8$$$7",
             "7$$$7$$$7",
             "777778777",
             " 77$$$77 ",
             " 7778777 ",
             "   ...   "];
   break;

   case 172:
    toAdd = ["  xx  ",
             " xxxx ",
             "xxxxxx",
             "xxxxxx",
             " xxxx ",
             "  xx  "];
   break;

   case 173:
    toAdd = ["WWW.WWW",
             "W$6..$W",
             "W.6666W",
             "..6i6..",
             "W6666.W",
             "W$..6$W",
             "WWW.WWW"];
   break;

   case 174:
    toAdd = [" WWpppWW ",
             "WWpp%ppWW",
             "Wpp%%%ppW",
             "pp%%$%%pp",
             "p%%$_$%%p",
             "pp%%$%%pp",
             "Wpp%%%ppW",
             "WWpp%ppWW",
             " WWpppWW "];
   break;

   case 175:
    toAdd = [" 666      6666 ",
             "66666  6  66666",
             "66$66     66$66",
             "66666     66666",
             " 66666 6 66666 ",
             "    6666666    ",
             "     66.66     ",
             " 6  66.2.66  6 ",
             "     66.66     ",
             "    6666666    ",
             " 66666 6 66666 ",
             "66666     66666",
             "66$66     66$66",
             "66666  6  66666",
             " 6666      666 "];
   break;

   case 176:
    toAdd = ["        777   777777  ",
             " 77777=77=77=77.9.=77 ",
             ".8$$$777...777....7777",
             " 7$$$.8.._..8..M..8.57",
             ".8$$$777...777....7777",
             " 77777=77=77=77.].=77 ",
             "        777   777777  "];
   break;

   case 177:
    toAdd = [" ...WWWW   ",
             " W.WWWWWWW ",
             "WW.W..c..WW",
             "WW.W.WWW.WW",
             "WWcWcW1W.WW",
             "WW.W.W.WcWW",
             "WW.W...W.WW",
             "WW.WWWWW.WW",
             "WW..c....WW",
             " WWWWWWWWW ",
             "  WWWWWWW  "];
   break;

   case 178:
    toAdd = ["WWWWWWWWW",
             "W?$?W?$?W",
             "W$W$W$W$W",
             ".?W?$?W$W",
             "WWWWWWWWW"];
   break;

   case 179:
    toAdd = ["     W     ",
             "     W     ",
             "  W..W..W  ",
             "  .a.W.a.  ",
             "  ...W...  ",
             "WWWWWWWWWWW",
             "  ...W...  ",
             "  .a.W.a.  ",
             "  W..W..W  ",
             "     W     ",
             "     W     "];
   break;

   case 180:
    toAdd = ["  P%P%P%P  ",
             " p%p%p%p%p ",
             "P%P%P$P%P%P",
             "%p%p%p%p%p%",
             "P%P%P$P%P%P",
             "%p$p$$$p$p%",
             "P%P%P$P%P%P",
             "%p%p%p%p%p%",
             "P%P%P$P%P%P",
             " p%p%p%p%p ",
             "  P%P%P%P  "];
   break;

   case 181:
    toAdd = ["..WW WW..",
             "...WWW...",
             "W...W...W",
             "WW.%;%.WW",
             " WW;_;WW ",
             "WW.%;%.WW",
             "W...W...W",
             "...WWW...",
             "..WW WW.."];
   break;

   case 182:
    toAdd = [" WW...WW ",
             "WWW...WWW",
             "WWW444WWW",
             ".........",
             "....i....",
             ".........",
             "WWW444WWW",
             "WWW...WWW",
             " WW...WW "];
   break;

   case 183:
    toAdd = ["WWWWWWWWWWWWWWWWWWWW",
             "..W??W??W??W??W??W..",
             "..W??W??W??W??W??W..",
             "W..................W",
             "W...a.....a.....a..W",
             "Wa....a.....a.....aW",
             "W..................W",
             "..W??W??W??W??W??W..",
             "..W??W??W??W??W??W..",
             "WWWWWWWWWWWWWWWWWWWW"];
   break;

   case 184:
    toAdd = ["       777        ",
             "     777$777      ",
             "   777.$$$.777    ",
             "  77........M77   ",
             "  7....M......7   ",
             " 77...........77  ",
             " 7.............7  ",
             "77..M...ccc....77 ",
             "71......ccc.....+.",
             "77..M...ccc....77 ",
             " 7.............7  ",
             " 77...........77  ",
             "  7....M......7   ",
             "  77........M77   ",
             "   777.$$$.777    ",
             "     777$777      ",
             "       777        "];
   break;

   case 185:
    toAdd = ["  WWWWW    ",
             " WW$$$WW   ",
             "WW$$1$$WW  ",
             " WW$$$WW   ",
             " WWW+WWWW  ",
             "WWcc.cccWWW",
             "Wc..MMM.ccW",
             "WW..M_M..WW",
             "Wcc.MMM..cW",
             "WWWcc..ccWW",
             "  WWW++WWW ",
             "    W..W   "];
   break;

   case 186:
    toAdd = [".WWWWWWWWWWW.",
             "..W.......W..",
             "W...WW.WW...W",
             "WWWW.....WWWW",
             "W[....M..../W",
             "WWWWWW.WWWWWW",
             ".............",
             "WWWWWWWWWWWWW"];
   break;

   case 187:
    toAdd = [" 666666666 ",
             "6........66",
             ".66666666.6",
             "66.....66.6",
             "6.66.$..6.6",
             "6.6.$_$.6.6",
             "6.6..$..6.6",
             "6.66...66.6",
             "6.6666666.6",
             "66.......66",
             " 666666666 "];
   break;

   case 188:
    toAdd = ["WWWW   ",
             " WWWW  ",
             "   WWW ",
             "   WW  ",
             "   W   ",
             "  :::  ",
             "   W   ",
             "  WW   ",
             " WWW   ",
             "  WWWW ",
             "   WWWW"];
   break;

   case 189:
    toAdd = ["   % % % % %   ",
             "  %;%;%;%;%;%  ",
             " %;:::::::::;% ",
             "%;:::::::::::;%",
             " %:::::::::::% ",
             "%;::::$c$::::;%",
             " %:::$c_c$:::% ",
             "%;::::$c$::::;%",
             " %:::::::::::% ",
             "%;:::::::::::;%",
             " %;:::::::::;% ",
             "  %;%;%;%;%;%  ",
             "   % % % % %   "];
   break;

   case 190:
    toAdd = ["   WWWWW   ",
             "  WW777WW  ",
             " WW77_77WW ",
             "WW77...77WW",
             "W77..M..77W",
             "W7.c...c.7W",
             "W7...c...7W",
             "W7.......7W",
             "77.......77",
             " ......... ",
             "  .......  "];
   break;

   case 191:
    toAdd = ["              ~~~~~  ",
             "             ~~;~~~~ ",
             "            ~~;;~~~~~",
             "            ~;;~~~~;~",
             "            ~;~~7~~;~",
             "         ~~~~;;~~~;;~",
             "        ~~~;;%;;~;;~~",
             "  ~~~~~~~~~~;;;;%;~~ ",
             " ~~;;%~~;~~~;;;;;~~  ",
             "~~;;~;;;;;~~~%;;;;~  ",
             "~~~~~~;;;;~~~~~~~~~  ",
             "~~~~7~~;%;;~~~~~~~~  ",
             "~~~~~~;;;;~~~~~~~~~  ",
             "~~;;~;;%;;~~~;;;;;~  ",
             " ~~;;;~~;~~~;;%;;~~  ",
             "  ~~~~~~~~~~;;;;;;~~~",
             "        ~~~;;;;;~%;~~",
             "         ~~~~%;~~~;;~",
             "            ~;~~7~~;~",
             "            ~;;~~~~;~",
             "            ~~;;~~~~~",
             "             ~~%~~~~ ",
             "              ~~~~~  "];
   break;

   case 192:
    toAdd = ["      =========      ",
             "    =============    ",
             "   =====77777=====   ",
             "  ====.77...77.====  ",
             " ====....._.....==== ",
             " ===.$..7...7..$.=== ",
             "===....77.$.77....===",
             "===7..77.....77..7===",
             "==77$77...7...77$77==",
             "==7......777......7==",
             "==7.1.M.77777.M.1.7==",
             "==7......777......7==",
             "==77$77...7...77$77==",
             "===7..77.....77..7===",
             "===....77.$.77....===",
             " ===.$..7...7..$.=== ",
             " ====....._.....==== ",
             "  ====.77...77.====  ",
             "   =====77777=====   ",
             "    =============    ",
             "      =========      "];
   break;

   case 193: // Snowflake!
    if(!r(2)){
      toAdd = ["           %           ",
               "          %%%          ",
               "    %    %%%%%    %    ",
               "    %%    %%%    %%    ",
               "  %%%%% 2  %  2 %%%%%  ",
               "   %%%% %% % %% %%%%   ",
               "    %%  %%%%%%%  %%    ",
               "         %%%%%         ",
               "    2%%   %%%   %%2    ",
               "  %  %%%   %   %%%  %  ",
               " %%%  %%% %%% %%%  %%% ",
               "%%%%%%%%%%%%%%%%%%%%%%%",
               " %%%  %%% %%% %%%  %%% ",
               "  %  %%%   %   %%%  %  ",
               "    2%%   %%%   %%2    ",
               "         %%%%%         ",
               "    %%  %%%%%%%  %%    ",
               "   %%%% %% % %% %%%%   ",
               "  %%%%% 2  %  2 %%%%%  ",
               "    %%    %%%    %%    ",
               "    %    %%%%%    %    ",
               "          %%%          ",
               "           %           "];
    } else {
      toAdd = ["           :           ",
               "          :::          ",
               "    :    :::::    :    ",
               "    ::    :::    ::    ",
               "  ::::: :  :  : :::::  ",
               "   :::: :: : :: ::::   ",
               "    ::  :::::::  ::    ",
               "         :::::         ",
               "    :::   :::   :::    ",
               "  :  :::   :   :::  :  ",
               " :::  ::: ::: :::  ::: ",
               ":::::::::::::::::::::::",
               " :::  ::: ::: :::  ::: ",
               "  :  :::   :   :::  :  ",
               "    :::   :::   :::    ",
               "         :::::         ",
               "    ::  :::::::  ::    ",
               "   :::: :: : :: ::::   ",
               "  ::::: :  :  : :::::  ",
               "    ::    :::    ::    ",
               "    :    :::::    :    ",
               "          :::          ",
               "           :           "];
    }
   break;

   case 194:
    toAdd = ["WWWWWWWW ",
             "W....... ",
             "W8WWWWWWW",
             "W..44..WW",
             "WMWWWW.WW",
             "WMW$$$$WW",
             "WWW$$$$WW",
             "WMW$$$$WW",
             "WMWWWW.WW",
             "W..66..WW",
             "W8WWWWWWW",
             "W....... ",
             "WWWWWWWW "];
   break;

   case 195:
    toAdd = ["77     77",
             "7       7",
             "   7 7   ",
             "  77 77  ",
             "         ",
             "  77 77  ",
             "   7 7   ",
             "7       7",
             "77     77"];
   break;

   case 196:
    toAdd = [" 7 77777 7",
             "   7...7  ",
             " 777.1.777",
             " 7cc.....7",
             ".8cc.M._.7",
             " 7cc.....7",
             " 777.1.777",
             "   7...7  ",
             " 7 77777 7"];
   break;

   case 197:
    toAdd = ["   =   ",
             "7..=..7",
             "77.=.77",
             " 7.=.7 ",
             " 7+7+7 ",
             "77$$$77",
             "7$ccc$7",
             "7$cMc$7",
             "7$ccc$7",
             "77$$$77",
             " 77777 "];
   break;

   case 198:
    toAdd = ["WWWWW    WWWWW",
             "W:::WW  WW:::W",
             "W:t::WWWW$:2:W",
             "W::::$WW:::::W",
             "WW$:M::::M:$WW",
             " WW::::::::WW ",
             "  WW::WW::WW  ",
             "  WW::WW::WW  ",
             " WW::::::::WW ",
             "WW$:M::::M:$WW",
             "W:::::WW$:::XW",
             "W:i:$WWWWX:XXW",
             "W:::WW  WWXXX:",
             "WWWWW    WWWX "];
   break;

   case 199:
    toAdd = ["7777.7777",
             "7^.....^7",
             "7.77777.7",
             "7.7$$$7.7",
             "..7$1$7..",
             "7.7$$$7.7",
             "7.77877.7",
             "7^.....^7",
             "777787777",
             "    .    "];
   break;

   case 200:
    toAdd = [" WWW7^.^7WWW ",
             " W7^^^6^^^7W ",
             "WW^^.....^^WW",
             "W7^.6...6.^7W",
             " ^^..-.-..^^ ",
             "..6.......6..",
             " ^^...[...^^ ",
             "W7^.6...6.^7W",
             "WW^^.....^^WW",
             " W7^^^6^^^7W ",
             " WWW7^.^7WWW "];
   break;

   case 201:
    toAdd = ["    ...    ",
             " ....$.... ",
             "...........",
             "  777+777  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             "  7c...c7  ",
             "  77...77  ",
             " 7777+7777 ",
             " 77.....77 ",
             " 7.......7 ",
             " 7..._...7 ",
             " 7.......7 ",
             " 7.._._..7 ",
             " 7.......7 ",
             " 77.....77 ",
             " 777777777 "];
   break;

   case 202:
    toAdd = ["WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW",
             "WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW",
             "WW.........WWW$$$WWW.........WW",
             "WW....c....WWW$]$WWW....c....WW",
             "WW.........WWW$$$WWW.........WW",
             "WW...WWW...WWW...WWW...WWW...WW",
             "WW.a.WWW.a.WWW.c.WWW.a.WWW.a.WW",
             "WW...WWW.M.WWW...WWW.M.WWW...WW",
             "WWc..WWW....c..M..c....WWW..cWW",
             "WW...WWW....M.....M....WWW...WW",
             "WW...WWW.......c.......WWW...WW",
             "WW...WWWWWWWWWWWWWWWWWWWWW...WW",
             "WW.M.WWWWWWWWWWWWWWWWWWWWW.M.WW",
             "WW...WWWWWWWWWWWWWWWWWWWWW...WW",
             "WW...WWW...............WWW...WW",
             "WW...WWW..c.m.....m.c..WWW...WW",
             "WWc..WWW...............WWW..cWW",
             "WW...WWW...WWW...WWW...WWW...WW",
             "WW.c.WWW.m.WWW.c.WWW.m.WWW.c.WW",
             "WW...WWW...WWW...WWW...WWW...WW",
             "WW.........WWWc.cWWW.........WW",
             "WW....c....WWW...WWW....c....WW",
             "WW.........WWW...WWW.........WW",
             "WWWWWWWWWWWWWW...WWWWWWWWWWWWWW",
             "WWWWWWWWWWWWW     WWWWWWWWWWWWW"];
   break;

   case 203:
    toAdd = ["    ~~~~~~~~~     ",
             "  ~~~WWWWWWW~~~   ",
             " ~~WWWWWWWWWWW~~  ",
             "~~WWWWWcMcWWWWW~~ ",
             "~WWWW...c...WWWW~ ",
             "~WWW..WWWWW..WWW~~",
             "~WWW+WW$_$WW+WW~~~",
             "~WW0aW2$$$2WM.+...",
             "~WWW+WWW8WWWWWW~~~",
             "~WWW.m.WcW.M-WWW~~",
             "~WWWWmc.c.c.WWWW~ ",
             "~~WWWWWcMcWWWWW~~ ",
             " ~~WWWWWWWWWWW~~  ",
             "  ~~~WWWWWWW~~~   ",
             "    ~~~~~~~~~     "];
   break;

   case 204:
    toAdd = [" 7777777777777 ",
             "77...........77",
             "77.7777+7777.77",
             "77.77m...m77.77",
             "778777...777877",
             "7c$c7m...m7c$c7",
             "7$$$77.-.77$$$7",
             "7c$c7m...m7c$c7",
             "7$$$77...77$$$7",
             "7c$M7m...m7M$c7",
             "7777777+7777777",
             " 77 77...77 77 "];
   break;

   case 205:
    toAdd = ["   777777777   ",
             " 777.bb1bb.777 ",
             "77$..MbbbM..$77",
             "7$$2...M...i$$7",
             "77$.........$77",
             "7777.......7777",
             "77$77..^..77$77",
             "7$.M.......M.$7",
             "77$77.....77$77",
             "7777bbcccbb7777",
             "77bbbbbbbbbbb77",
             "7bbbbbbbbbbbbb7",
             "77bbbbbbbbbbb77",
             " 777bbbbbbb777 ",
             "   777787777   ",
             "       .       "];
   break;

   case 206:
    toAdd = ["WWWWWWWWWWWWWWWWW",
             "Wm..W$$W...m....W",
             "W.W.W$$W.WWWW.W.W",
             "W.W.+.MW....W$W.W",
             "W.WWWWWWWWW+WWW.W",
             "W..m...W$$M.W.m.W",
             "W.WWWW.W$$..W.W.W",
             "W$W....W$$.MW.W$W",
             "WWW.WWWWWWWWW.WWW",
             "W$..W..m..W.m...W",
             "WWW.W.WWW.W.WWW+W",
             "W.m.W.W$..W.W$.MW",
             "W.WWW.WWW.W.W$i.W",
             "W.......W...W$$$W",
             "WWWWWWW+WWWWWWWWW",
             "       .         "];
   break;

   case 207:
    toAdd = ["   4444444444   ",
             "  44........44  ",
             " 44..44..44..44 ",
             "44..444  444..44",
             "44.44      44.44",
             " 4.4  3333  4.4 ",
             " 4.4  3113  4.4 ",
             "44.44 3333 44.44",
             "44..44    44..44",
             " 44..444444..44 ",
             "  44..4444..44  ",
             "   44......44   ",
             "    444..444    "];
   break;

   case 208:
    toAdd = ["      W.W      ",
             "      W.W      ",
             "      W.W      ",
             "   WWWW.WWWW   ",
             "   W$.3.3.$W   ",
             "   W..W.W..W   ",
             "WWWW..3.3..WWWW",
             ".....iW.Wi.....",
             "WWWW..3.3..WWWW",
             "   W..W.W..W   ",
             "   W$.3.3.$W   ",
             "   WWWW.WWWW   ",
             "      W.W      ",
             "      W.W      ",
             "      W.W      "];
   break;

   case 209:
    toAdd = ["WWWWWWWWW",
             "W.8...8.W",
             "W.W.1.W.W",
             "W.W...W.W",
             "W.WW=WW.W",
             "W.=aaa=.W",
             "W.=.M.=.W",
             "W.=.=.=.W",
             "W.W.W.W.W",
             "W...W...W",
             "W==...==W",
             "WWWW+WWWW",
             "    .    "];
   break;

   case 210:
    toAdd = ["     777777777     ",
             "   7777..1..7777   ",
             "   777..7.7..777   ",
             " 7777....2....7777 ",
             " 777...........777 ",
             "777..2..===..2..777",
             "77.....==.==.....77",
             "7......=...=......7",
             "7+777777...777777+7",
             "7aaaaa+.....+aaaaa7",
             "77aaa77.....77aaa77",
             " 77777... ...77777 "];
   break;

   case 211:
    toAdd = ["  WWWWWWW        ",
             " WW3333.WW       ",
             "WW...8...WWWWW   ",
             "W1.WWWWW.....WW  ",
             "WW...0...WW...WW ",
             " WW3333.WWW.&..WW",
             "  WWWWWWWW  .... "];
   break;

   case 212:
    toAdd = ["  7777777  ",
             " 77ssMss77 ",
             "77sssssss77",
             "7ss77+77ss7",
             "7ss7$$$7ss7",
             "7sM7$$$7Ms7",
             "7ss7$$$7ss7",
             "7ss77777ss7",
             "77sssMsss77",
             " 77sssss77 ",
             "  777+777  ",
             "     .     "];
   break;

   case 213:
    toAdd = [" ======        ",
             "==a=aa= 7777   ",
             "=a....=77aa77  ",
             "==.==..7....77 ",
             "=a.===.+.....+.",
             "=a...==7....77 ",
             "==7787777aa77  ",
             " 77...777777   ",
             "77.....77      ",
             "72..M..27      ",
             "77.....77      ",
             " 777t777       ",
             "   777         "];
   break;

   case 214:
    toAdd = [" 77777777777777777777777",
             " 77A7-.MM.7a7$aaA7c..817",
             " 77$77777?7a7$7777...777",
             " 77$7.m.7.7$7.7.M+.c.817",
             " 77+7+7+7+7+7+7+77...777",
             ".7....7XXXXXXXXXX7c..817",
             ".8....7XXXXXXXXXX7777777",
             ".7....7XXXXXXXXXX7c..817",
             " 77+7+7+7+7+7+7+77...777",
             " 77$7.M.7.7$7.7.M+.c.817",
             " 77$77777?7a7$7777...777",
             " 77A7-.MM.7a7$aaA7c..817",
             " 77777777777777777777777"];
   break;

   case 215:
    toAdd = ["       ...       ",
             "7777777...7777777",
             "7$.1.$7...7$.1.$7",
             "7.$.$.7...7.$.$.7",
             "7..$..7.M.7..$..7",
             "7c...c7...7c...c7",
             "7...c.7+++7.c...7",
             "7m.c......m..c..7",
             "7.....m........m7",
             "7..m...M_M..m...7",
             "7&..m....m.....&7",
             "77777777777777777"];
   break;

   case 216:
    toAdd = ["         ...         ",
             "       WWW.WWW       ",
             "    ...WWW.WWW...    ",
             "   WW...WW.WW...WW   ",
             "  .WWW..WW.WW..WWW.  ",
             "  ..WWW..W.W..WWW..  ",
             "  ...WWW.W.W.WWW...  ",
             " WW...WW.W.W.WW...WW ",
             " WWWW....666....WWWW ",
             ".WWWWWWW66a66WWWWWWW.",
             "........6a[a6........",
             ".WWWWWWW66a66WWWWWWW.",
             " WWWW....666....WWWW ",
             " WW...WW.W.W.WW...WW ",
             "  ...WWW.W.W.WWW...  ",
             "  ..WWW..W.W..WWW..  ",
             "  .WWW..WW.WW..WWW.  ",
             "   WW...WW.WW...WW   ",
             "    ...WWW.WWW...    ",
             "       WWW.WWW       ",
             "         ...         "];
   break;

   case 217:
    toAdd = ["        WWWWW     WWWWW        ",
             "        W...W  m  W...W        ",
             "        W.A.+.   .+.A.W        ",
             "        W...W  m  W...W        ",
             "    WWWWWW+WW     WW+WWWWWW    ",
             "    W...W .         . W...W    ",
             "   .+.A.+.m   m m   m.+.A.+.   ",
             "    W...W             W...W    ",
             "WWWWWWWWW    WW WW    WWWWWWWWW",
             "W...W        W...W        W...W",
             "W.A.+.m    m.+.A.+.m    m.+.A.W",
             "W...W      . W...W .      W...W",
             "WW+WW    WW+WWWWWWW+WW    WW+WW",
             "  .    m W...W   W...W m    .  ",
             " m m    .+.A.W   W.A.+.    m m ",
             "       m W...W   W...W m       ",
             "         WWWWW   WWWWW         "];
   break;

   case 218:
    toAdd = ["                WWWWW        ",
             "                W...W m      ",
             "              m W.A.+.   m m ",
             "                W...W m   .  ",
             "            WWWWWW+WW   WW+WW",
             "          m W...W .     W...W",
             "     m m   .+.A.+.m   m.+.A.W",
             "          m W...W     . W...W",
             "    WWWWW   WWWWW   WW+WWWWWW",
             "    W...W m       m W...W    ",
             "  m.+.A.W    m m    W.A.W m  ",
             "  . W...W m       m W...W    ",
             "WW+WWW+WW   WWWWW   WW+WW    ",
             "W...W .     W...W m   .      ",
             "W.A.W m   m.+.A.+.   m m     ",
             "W...W     . W...W m          ",
             "WW+WW   WW+WWWWWW            ",
             "  .   m W...W                ",
             " m m    W.A.+.m              ",
             "      m W...W                ",
             "        WWWWW                "];
   break;

   case 219:
    toAdd = ["WWWWW       WWWWW    ",
             "W'''W m   m W...W    ",
             "W'_'       .+.A.W    ",
             "W'''W m   m W...W    ",
             "WW WW       WW+WWWWWW",
             "            W...W...W",
             " m m    m   W.A.+.A.W",
             "            W...W...W",
             "        WWWWWWWWWW+WW",
             "      m W...W     .  ",
             " m m    W.A.+.m  m m ",
             "  .   m W...W        ",
             "WW+WW   WW+WWW+WW    ",
             "W...W     . W...W m  ",
             "W.A.+.m   m W.A.W    ",
             "W...W .     W...W m  ",
             "WWWWWW+WWWWWWW+WW    ",
             "    W...W...W .      ",
             "    W.A.+.A.+m m     ",
             "    W...W...W        ",
             "    WWWWWWWWW        "];
   break;

   case 220:
    toAdd = ["    777               777    ",
             "    72777     .     77727    ",
             "    7)%%777   .   777:::7    ",
             "    7%p%p%7   .   7:::::7    ",
             "    7%%%%$777...777a::::7    ",
             "    77%%p%%a77+77$:::::77    ",
             "     7a%%$%!;+.+::::::$7     ",
             "     7%p%%p%77+77::::::7     ",
             "     77$%%%776.677:::a77     ",
             "      7%pa776.$.677:::7      ",
             "      777776..a..677777      ",
             "     777766..$?$..667777     ",
             "    77s$76.$a?A?a$.67d,77    ",
             "  777$ss+....$?$....+,,$777  ",
             " 77$ssss776...a...677#,,f$77 ",
             "77sssssss766..$..667a,,,,,#77",
             "7Ass$sss$7666...6667$,n$#,,i7",
             "77777777777777877777777777777",
             "         7a.......a7         ",
             "         77$xxxxx$77         ",
             "          7xxxxxxx7          ",
             "          77$xxx$77          ",
             "           7..M..7           ",
             "           7.mmm.7           ",
             "           77.M.77           ",
             "            7...7            ",
             "            77177            ",
             "             777             "];
   break;

   case 221:
    toAdd = ["WWWWWWWWW ",
             "W.8.....W ",
             "W.W..W..W ",
             "W.^.WWW.W ",
             "W.W..W..W ",
             "W.^c..c.W ",
             "W.W.cW..W ",
             "W.^cWWW.W ",
             "W.W.cW..W ",
             "W1W...c.+.",
             "WWWWWWWWW "];
   break;

   case 222:
    toAdd = ["WWWWWWWW...WWWWWWWW",
             "WWWW...........WWWW",
             "WW.......m.......WW",
             "W$....m.....m....$W",
             "WWWW.....m.....WWWW",
             "WWWWWWWW...WWWWWWWW",
             "WWWi...........iWWW",
             "WWWWWWWW...WWWWWWWW",
             "WWWW.....m.....WWWW",
             "W$....m.....m....$W",
             "WW.......m.......WW",
             "WWWW...........WWWW",
             "WWWWWWWW...WWWWWWWW"];
   break;

   case 223:
    toAdd = ["         WWWWWWWWWWWWWW",
             "        WWWWW...WWWWWWX",
             "        WWW.mmW.~~WWX~~",
             "WWWWWWWWW...WWWWW~W~~X ",
             "W$$$WWWWW.WWWWWWWXWX~~ ",
             "W$i$.....MWWWWWWXXX~~  ",
             "W====WWWWWWWWWWWXXWX~  ",
             "W$i$.....MWWWWWWXXXX~  ",
             "W$$$WWWWW.WWWWWWWXWXX~ ",
             "WWWWWWWWW...WWWWWXW~XX ",
             "        WWW.mmW.~~WW~~X",
             "        WWWWW...WWWWWW~",
             "         WWWWWWWWWWWWWW"];
   break;

   case 224:
    toAdd = ["          .          ",
             "        77877        ",
             "     7777...7777     ",
             "    77.........77    ",
             "   77...........77   ",
             "  77.............77  ",
             "  7...666...666...7  ",
             "  7...666.&.666...7  ",
             " 77...666...666...77 ",
             " 7.................7 ",
             ".8.....&..1..&.....8.",
             " 7.................7 ",
             " 77...666...666...77 ",
             "  7...666.&.666...7  ",
             "  7...666...666...7  ",
             "  77.............77  ",
             "   77...........77   ",
             "    77.........77    ",
             "     7777...7777     ",
             "        77877        ",
             "          .          "];
   break;

   case 225:
    toAdd = ["     WW...WW     ",
             "     W.....W     ",
             "     W.mmm.W     ",
             "     W.....W     ",
             "    WW.....WW    ",
             "WWWWW7778777WWWWW",
             "W....7$$.$$7....W",
             "..m..7$...$7..m..",
             "..m..8.._..8..m..",
             "..m..7$...$7..m..",
             "W....7$$.$$7....W",
             "WWWWW7778777WWWWW",
             "    WW.....WW    ",
             "     W.....W     ",
             "     W.mmm.W     ",
             "     W.....W     ",
             "     WW...WW     "];
   break;

   case 226:
    toAdd = ["  W.....W  ",
             "  W.....W  ",
             "WWW.....WWW",
             "Wa+.....+aW",
             "WWW.....WWW",
             "Wa+.....+aW",
             "WWW.....WWW",
             "Wa+.....+aW",
             "WWW.....WWW",
             "  W.....W  ",
             "  W.....W  "];
   break;

   case 227:
    toAdd = ["  WWWWWWWWWWWWW  ",
             " ............... ",
             "W.WWWW..WWWWWW..W",
             "W.Wa....W..aaW..W",
             "W.WW....W..WWW..W",
             "W.Wa............W",
             "W.W...WWWWW..W..W",
             "W....WW......W..W",
             "W...WW....a..W..W",
             "W..WW...W....W..W",
             "W..W.a..WW..aW..W",
             "W..W....aWW..W..W",
             "W..WaA.a..W..W..W",
             "W..W..a....a.W..W",
             "W..WWWWWWWWWWW..W",
             " ............... ",
             "  WWWWWWWWWWWWW  "];
   break;

   case 228:
    toAdd = ["    WWWWWWWWWWWWW    ",
             "    Wc.....c....W    ",
             "    W..c......c.W    ",
             "   WW...77877...WW   ",
             "   Wc..77$.$77..cW   ",
             "   W.c.7$.1.$7...W   ",
             "  WW...77$.$77c..WW  ",
             "  W...c.77777.....W  ",
             "  Wc...........c..W  ",
             " WW..WW..a........WW ",
             ".+...Wa....WWW.....+.",
             " WW..WWWW...aW...aWW ",
             "  WWa..aWW..WW...WW  ",
             "   WWW...W..Wa.WWW   ",
             "     WW...M...WW     ",
             "      WW.....WW      ",
             "       WWW.WWW       ",
             "         W+W         ",
             "          .          "];
   break;
 }

 // Mirror, flip, rotate:
 var mirrorRoom = r(2);
 if(!r(2) && !noFlip) // Flip vertically.
   toAdd = toAdd.reverse();
 // if(!r(2) && !noRotate) { // Rotate room:
 //   // We have to transform the array of strings into a matrix to properly
 //   // transpose it, then back to array of strings because of code below...
 //   for (var i = 0; i < toAdd.length; i++)
 //     toAdd[i] = toAdd[i].split('');
 //   for (var k = 0; k < toAdd.length; k++) {
 //     for (var l = 0; l < k; l++) {
 //       const tmp = toAdd[k][l];
 //       toAdd[k][l] = toAdd[l][k];
 //       toAdd[l][k] = tmp;
 //     }
 //   }
 //   for (var j = 0; j < toAdd.length; j++)
 //     toAdd[j] = toAdd[j].join('');
 // } // Somewhere here in the transpose function is a BUG, fix it!

 // Get coordinates for the upper left corner of our new structure. Let really big structures be generated
 // partially outside of the map, but limit smaller structures to within the map's confines.
 var x;
 var y;
 if(toAdd.length > mapWidth || toAdd[0].length > mapWidth){
   x = r(mapWidth);
   y = r(mapWidth);
 } else {
   x = r(mapWidth - toAdd.length);
   y = r(mapWidth - toAdd[0].length);
 }

 // Defined here to make it consistent for each room.
 var randDanger = ['^',tileLava,tileSludge,wallBlock].sampleRec();
 var randAnnoy = [',',tileBramble,tileNettles,tileBlindGas,tileConfGas,tileStunGas,tileQuicksand].sampleRec();
 var randGas = gases.sampleRec();
 var randLiquid = liquids.sampleRec();
 var randPlantSmall = plants_small[r(plants_small.length-1)];
 var randPlantLarge = plants_large.sampleRec();

 for (var i = 0; i < toAdd.length; i++) {
  currentLine = toAdd[i];
  currentLine = currentLine.split('');
  if(mirrorRoom && !noMirror) currentLine.reverse();

  for (var j = 0; j < currentLine.length; j++) {
   if(inRangeCoords(x+i,y+j)) {
    switch(currentLine[j]){
    default:
     currentMap[x+i][y+j] = currentLine[j];
     break;
    case "W":
     currentMap[x+i][y+j] = wallBlock;
     break;
    case "~":
     currentMap[x+i][y+j] = tileWater;
     break;
    case "=":
     currentMap[x+i][y+j] = tileLava;
     break;
    case "'": // bloody floor
     currentMap[x+i][y+j] = tileBloodDrop;
     break;
    case ":": // ice floor
     currentMap[x+i][y+j] = tileIce;
     break;
    case "S": // secret path
     currentMap[x+i][y+j] = tileSecretPath;
     break;
    case "+": // normal door
     currentMap[x+i][y+j] = tileMobDoor;
     break;
    case "x": // completely random tile
     currentMap[x+i][y+j] = terrain_any.sampleRec();
     break;
    case "-":
     currentMap[x+i][y+j] = tileKey;
     break;
    case "[": // normal armor
     currentMap[x+i][y+j] = ']';
     break;
    case "]": // enchanted armor
     currentMap[x+i][y+j] = tileArmor;
     break;
    case ";": // tall grass
     currentMap[x+i][y+j] = tileGrassTall;
     break;
    case "!": // thorny bramble
     currentMap[x+i][y+j] = tileBramble;
     break;
    case ")": // nettles
     currentMap[x+i][y+j] = tileNettles;
     break;
    case "#": // gases
     currentMap[x+i][y+j] = randGas;
     break;
    case "d": // smoke
     currentMap[x+i][y+j] = tileBlindGas;
     break;
    case "f": // confusion gas
     currentMap[x+i][y+j] = tileConfGas;
     break;
    case "n": // stun gas
     currentMap[x+i][y+j] = tileStunGas;
     break;
    case "%": // random plants
     currentMap[x+i][y+j] = [plants_small,plants_large].sampleRec();
     break;
    case "p": // small plants
     if(!r(10))
       currentMap[x+i][y+j] = plants_small.sampleRec();
     else
       currentMap[x+i][y+j] = randPlantSmall;
     break;
    case "P": // large plants
     if(!r(10))
       currentMap[x+i][y+j] = plants_large.sampleRec();
     else
       currentMap[x+i][y+j] = randPlantLarge;
     break;
    case "|": // dead tree or wooden wall?
     currentMap[x+i][y+j] = tileTreeDead;
     break;
    case "T": // normal tree
     currentMap[x+i][y+j] = [tileTreeLeafy,tileTreeConif][r(2)];
     break;
    case "b": // blood
     currentMap[x+i][y+j] = tileBlood;
     break;
    case "s": // sludge
     currentMap[x+i][y+j] = tileSludge;
     break;
    case "q": // quicksand
     currentMap[x+i][y+j] = tileQuicksand;
     break;
    case "t": // random treasure
     currentMap[x+i][y+j] = treasures[r(treasures.length-1)];
     break;
    case "2": // TODO: magic item
    case "i": // minor treasure
     currentMap[x+i][y+j] = ['$','_',']',tileKey][r(4)];
     break;
    case "1": // major treasure
     currentMap[x+i][y+j] = [tileTreasure,tileStaff,tileArmor][r(3)];
     break;
    case "3": // random danger
     currentMap[x+i][y+j] = randDanger;
     break;
    case "4": // random annoyance
     currentMap[x+i][y+j] = randAnnoy;
     break;
    case "5": // treasure pile
     currentMap[x+i][y+j] = tileTreasure;
     break;
    case "6":
     currentMap[x+i][y+j] = randLiquid;
     break;
    case "7": // golden wall
     currentMap[x+i][y+j] = tileGoldWall;
     break;
    case "8": // locked door
     currentMap[x+i][y+j] = tileGoldDoor;
     break;
    case "9": // magic staff
     currentMap[x+i][y+j] = tileStaff;
     break;
    case "0": // teleporter
     currentMap[x+i][y+j] = tileTeleporter;
     break;
    case " ":
     // Do nothing, so that we can leave pieces of normally generated terrain in rooms.
     break;
    case "m": // random mob
     currCre.push(cloneCreature(creatureList.sampleRec()));
     currCre[currCre.length-1].x = x+i;
     currCre[currCre.length-1].y = y+j;
     currentMap[x+i][y+j] = '.';
     break;
    case "M": // uppercase mob
     currCre.push(cloneCreature(creatureList[r(parseInt(creatureList.length/2))]));
     currCre[currCre.length-1].x = x+i;
     currCre[currCre.length-1].y = y+j;
     currentMap[x+i][y+j] = '.';
     break;
    case "a": // random mob + treasure
     currCre.push(cloneCreature(creatureList.sampleRec()));
     currCre[currCre.length-1].x = x+i;
     currCre[currCre.length-1].y = y+j;
     currentMap[x+i][y+j] = '$';
     break;
    case "A": // uppercase mob + treasure
     currCre.push(cloneCreature(creatureList[r(parseInt(creatureList.length/2))]));
     currCre[currCre.length-1].x = x+i;
     currCre[currCre.length-1].y = y+j;
     currentMap[x+i][y+j] = treasures[r(treasures.length-1)];
     break;
    case "c": // pre-defined mob
     currCre.push(cloneCreature(randMob));
     currCre[currCre.length-1].x = x+i;
     currCre[currCre.length-1].y = y+j;
     currentMap[x+i][y+j] = '.';
     break;
    case "&": // demon
     currCre.push(cloneCreature(creatureList[0]));
     currCre[currCre.length-1].x = x+i;
     currCre[currCre.length-1].y = y+j;
     currentMap[x+i][y+j] = emptyBlock;
     break;
    case "X": // ice block
     currCre.push(cloneCreature(mobIceBlock));
     currCre[currCre.length-1].x = x+i;
     currCre[currCre.length-1].y = y+j;
     currentMap[x+i][y+j] = [tileWater,tileIce][r(2)];
     break;
    case "@": // the End
     currentMap[x+i][y+j] = tileMacGuffin;
     break;
    }
   }
  }
 }
}

function newMap(x,y){
 //upon exiting the map, save it, if the new map is empty, generate it, then load whatever is there
 currentMap.clone2d(worldData[worldPos.x][worldPos.y].map);
 while(currCre.length>0)
   worldData[worldPos.x][worldPos.y].mobs.push(currCre.pop());

 worldPos.x += x;
 worldPos.y += y;
 if(worldData[worldPos.x]==null)
  worldData[worldPos.x] = [];
 if(worldData[worldPos.x][worldPos.y]==null){
  worldData[worldPos.x][worldPos.y] = {
    map: [],
    name: "",
    mobs: [],
  };
  worldData[worldPos.x][worldPos.y].name = newWorldName();
  generateMap();
  spawnMobs();
  fixEntry(x,y,false);
 } else {
  worldData[worldPos.x][worldPos.y].map.clone2d(currentMap);
  fixEntry(x,y,true);
  while(worldData[worldPos.x][worldPos.y].mobs.length>0)
    currCre.push(worldData[worldPos.x][worldPos.y].mobs.pop());
 }
 currentMap.clone2d(worldData[worldPos.x][worldPos.y].map);
}

function spawnMobs(){
  var cQ = Math.max(distanceToOrigin(), r(visited)); // How many to spawn.
  // More powerful enemies are towards the start of creatureList, so spawn more powerful enemies in later areas.
  var cHere = r(Math.max(creatureList.length-distanceToOrigin(),creatureList.length/2));
  for (var i = 0; i < cQ; i++) {
   currCre.push(cloneCreature(creatureList[cHere]));
   if(!r(10)) cHere = r(creatureList.length); // Change to any enemy.
   do {
    currCre[currCre.length-1].x = r(mapWidth);
    currCre[currCre.length-1].y = r(mapWidth);
   } while(impassable.includes(currentMap[currCre[currCre.length-1].x][currCre[currCre.length-1].y]));
  }
}

function fixEntry(a,b, showBlue){
 if(currentMap[userPos.x][userPos.y]==wallBlock){
  currentMap[userPos.x][userPos.y] = emptyBlock;
  var escapePath = {x:userPos.x+a,y:userPos.y+b};
  while(!checkEmpty(escapePath.x,escapePath.y)){
   if(showBlue) currentMap[escapePath.x][escapePath.y] = tileSecretPath;
   else currentMap[escapePath.x][escapePath.y] = emptyBlock;
   switch(r(3)){
    default:
     escapePath.x += a;
     escapePath.y += b;
    break;

    case 0: //go left/right;
     if(a==0) escapePath.x += [-1,1][r(2)];
     if(b==0) escapePath.y += [-1,1][r(2)];
   }
   if(!inRange(escapePath)) break;
  }
  if(showBlue)
    msg += "You discover a <t style='color:#85C1E9'>secret path</t>. ";
 }
}

function addUser(){
 userPos.x = r(mapWidth);
 userPos.y = r(mapWidth);

 while(!checkEmpty(userPos.x,userPos.y)){
  userPos.x = r(mapWidth);
  userPos.y = r(mapWidth);
 }
 //TODO: Make sure player doesn't start in lava or in a locked treasure room!

 userName = "<t style='color:#"+Math.random().toString(16).substr(2,6)+"'>"+newName()+"</t>";
}

function teleportUser(){
 msg += "You teleport. ";
 do {
  userPos.x = r(mapWidth);
  userPos.y = r(mapWidth);
 } while(!checkEmpty(userPos.x,userPos.y));
}

function teleportMob(i){
  if(distanceBetween(userPos,currCre[i])<10)
    msg += currCre[i].name+" disappears. ";
  var p;
  var q;
  do {
    p = r(mapWidth);
    q = r(mapWidth);
  } while(!checkEmpty(p,q));
  currCre[i].x = p;
  currCre[i].y = q;
  if(distanceBetween(userPos,currCre[i])<10)
    msg += currCre[i].name+" reappears. ";
}

function useStaff(){
 if(staff==0){
  msg += "You need to find a magical staff, first. ";
  return;
 }
 if(score<=10){
    msg += "You are too weak to use this magic. ";
    return;
 }
 score -= 10;
 msg += "You channel the magical energies. ";

 var powerWord;
 if(confused>0){
   powerWord = r(staves.length);
   msg += "You mispronounce the Word of Power! ";
 } else
   powerWord = staff;

 switch(powerWord){
  default:
   msg += "Nothing happens. ";
   break;

  case 1: //teleport
   teleportUser();
   break;

  case 2: //time stop
   timestop += 10;
   msg += "Everything around you grinds to a halt. ";
   break;

  case 3: //secret paths
   var digPath = [{x:userPos.x,y:userPos.y},{x:userPos.x+1,y:userPos.y},{x:userPos.x-1,y:userPos.y},{x:userPos.x,y:userPos.y+1},{x:userPos.x,y:userPos.y-1}];
   for(var i = 0; i < digPath.length; i++){
    if(inRange(digPath[i])){
      if(currentMap[digPath[i].x][digPath[i].y]==wallBlock)
        currentMap[digPath[i].x][digPath[i].y] = tileSecretPath;
    }
   }
   msg += "New paths open for you. ";
   break;

  case 4: //life
   cureAll();
   break;

  case 5: //vorpal
   msg += "Snicker-snack! A whirlwind of sharpness surrounds you. ";
   for(var i = 0; i < currCre.length; i++){
    if(distanceBetween(userPos,currCre[i])<=2) killCreature(i);
   }
   for(var k=-1; k < 2; k++){
    for(var l=-1; l < 2; l++){
     if(inRangeCoords(userPos.x+k,userPos.y+l)){
       switch(currentMap[userPos.x+k][userPos.y+l]){
         case tileNettles:
          currentMap[userPos.x+k][userPos.y+l] = tileBloodDrop;
          break;

         case tileGrassTall: case tileBramble: case tileBush:
          currentMap[userPos.x+k][userPos.y+l] = tileGrassShort;
          break;

         case tileTreeConif: case tileTreeLeafy: case tileTreeDead:
          msg += "You cut down the tree. ";
          currentMap[userPos.x+k][userPos.y+l] = tileTreeStump;
          break;
       }
     }
    }
   }
   break;

  case 6: //leaping
   leap = true;
   msg += "Leap in which direction? ";
   break;

  case 7: //orbs
   orb = true;
   msg += "Where would you like to direct them? ";
   break;

  case 8: //burgeoning
   for(var k=-1; k < 2; k++){
    for(var l=-1; l < 2; l++){
     if(inRangeCoords(userPos.x+k,userPos.y+l)){
       if(!impassable.includes(currentMap[userPos.x+k][userPos.y+l]))
         currentMap[userPos.x+k][userPos.y+l] = tileGrassTall;
     }
    }
   }
   msg += "Everything around you is swallowed by plant life. ";
   for(var m = 0; m < currCre.length; m++){
    if(distanceBetween(userPos,currCre[m])<=2){
      var dx = currCre[m].x - userPos.x;
      var dy = currCre[m].y - userPos.y;
      if(inRangeCoords(currCre[m].x+dx,currCre[m].y+dy) && checkEmpty(currCre[m].x+dx,currCre[m].y+dy)) {
        currCre[m].x += dx;
        currCre[m].y += dy;
        msg += currCre[m].name+" is pushed away by the rapidly growing vegetation. ";
      }
    }
   }
   break;

  case 9: //chaos
   msg += "You are surrounded by a storm of primordial chaos. ";
   for(var k=-3; k < 4; k++){
    for(var l=-3; l < 4; l++){
      if(k==0 && l==0)
        currentMap[userPos.x+k][userPos.y+l] = emptyBlock;
      else if(inRangeCoords(userPos.x+k,userPos.y+l) && distanceBetween(userPos,{x:userPos.x+k,y:userPos.y+l})<=3)
        currentMap[userPos.x+k][userPos.y+l] = terrain_any.sampleRec();
    }
   }
   for(var m = 0; m < currCre.length; m++){
    if(distanceBetween(userPos,currCre[m])<=3){
      if(currCre[m].flags.includes("boss")){
        msg += currCre[m].name+" shrugs off the magic. ";
      } else {
        var newMob = cloneCreature(creatureList.sampleRec());
        newMob.x = currCre[m].x;
        newMob.y = currCre[m].y;
        currCre[m] = newMob;
      }
    }
   }
   break;
 }
 // Do not take a turn, or staves of Conjuration and Soaring Leap will be broken.
 displayMap();
}

function cureAll(){
 var cured = false;

 if(aflame>0){
  aflame = 0;
  cured = true;
 }
 if(blinded>0){
  blinded = 0;
  cured = true;
 }
 if(confused>0){
  confused = 0;
  cured = true;
 }
 if(panicked>0){
  panicked = 0;
  cured = true;
 }
 if(poisoned>0){
  poisoned = 0;
  cured = true;
 }
 if(stunned>0){
  stunned = 0;
  cured = true;
 }

 if(cured){
   if(glyph==2 && currentMap[userPos.x][userPos.y]==tileWater)
     msg += "Your armour glows with soft blue light. ";
   msg += "Your afflictions are lifted. ";
 }
 return cured;
}

function checkEmpty(x,y){
 for (var i = 0; i < currCre.length; i++) {
  if(currCre[i].x==x && currCre[i].y==y) return false;
 }
 return !impassable.includes(currentMap[x][y]);
}

function playerTakeDamage(dmg,i=9999){
 if(dmg<=0) return;
 if(ward>0){
  msg += "Your warding absorbs the blow. ";
  ward--;
  return;
 }

 var resist = armor;
 if(phased>0) resist = parseInt(resist*1.5); // Extra armour when phased.
 if(i != 9999){
   // Armor piercing monster attack:
   if(currCre[i].flags.includes("pierce")) resist = 0;
 }
 if(bloodied>0) dmg += r(kills); // Extra damage when bloodied.
 dmg = Math.max(1, dmg-resist);
 score -= dmg;
 msg += "["+((dmg > Math.max(10, score/10)) ? "<t style='color:#FF0000'>"+String(dmg)+"</t> " : String(dmg))+" dmg] ";

 // Proc glyphs:
 if(!r(3)){
  if(glyph==3 && (i != 9999)){ //mortal terror
    if(r(kills) > r(visited)){
      currCre[i].flags.push("flee");
      msg += currCre[i].name+" panics. ";
    }
  }
  if(glyph==4) teleportUser(); //displacement
  if((glyph==5) && (i != 9999)){ //retribution
   msg += "Your "+getArmorName()+" guides your hand to vengeance. ";
   damageCreature(i);
  }
  if(glyph==6){ //invulnerability
   msg += "Your "+getArmorName()+" glows with protective aura. ";
   ward++;
  }
  if(glyph==7){ //phasing
   msg += "Your "+getArmorName()+" envelops you in shadows. ";
   phased += 10+r(20);
  }
 }
}

function tryPlayerMove(x,y){
 for (var i = 0; i < currCre.length; i++) {
  if(currCre[i].x==x && currCre[i].y==y){
    if(!panicked)
     damageCreature(i);
    else
      msg += "You are too panicked to fight! ";

   // We are blocked from moving, anyway.
   return false;
  }
 }

 // Only allow the player to walk through heavy door with no adjacent mobs:
 if(currentMap[x][y]==tileMobDoor){
   for (i = 0; i < currCre.length; i++) {
     if(stepsBetween(userPos,currCre[i])<=1){
       msg += "You cannot haul the heavy door open while "+currCre[i].name+" is so close. ";
       return false;
     }
   }
   return true;
 }
 // Check if player has keys for opening golden doors:
 if(currentMap[x][y]==tileGoldDoor && keys > 0) return true;

 // Handle phasing, otherwise check impassable terrain.
 if(phased>0 && currentMap[x][y] != tileGoldWall) return true;
 return !impassable.includes(currentMap[x][y]);
}

function damageCreature(i){
 if(stunned>0 && !r(3)){
   msg += "You miss "+currCre[i].name+". ";
   return;
 } else
   msg += "You strike "+currCre[i].name+". ";
 if(currCre[i].flags.includes("invulnerable")) {
   msg += currCre[i].name+" ignores your attack. ";
   return;
 }
 if(currCre[i].flags.includes("boss") && timestop>0) {
   msg += currCre[i].name+" is standing outside of time! ";
   return;
 }
 if((phased>0 || currCre[i].flags.includes("phase")) && !r(3)){
   msg += "Your attack phases right through "+currCre[i].name+". ";
   return;
 }
 // Attempt to lowercase the monster, if already lowercase, kill it instead. Vorpal staff always kills.
 var injured = currCre[i].icon.replaceAt(25, currCre[i].icon.charAt(25).toLowerCase());
 var dead = false;
 if(currCre[i].icon != injured && staff != 5){
  currCre[i].icon = injured;
  if(!r(5) || (glyph==3)){
   currCre[i].flags.push("flee");
   msg += currCre[i].name+" panics. ";
  }
 } else
   dead = killCreature(i);

 // Staff of burgeoning makes mobs slip when they fight you on grass.
 if(!dead && staff==8){
   if(!plants_small.includes(currentMap[currCre[i].x][currCre[i].y]))
     return;
   var dx = currCre[i].x - userPos.x;
   var dy = currCre[i].y - userPos.y;
   if(inRangeCoords(currCre[i].x+dx,currCre[i].y+dy) && checkEmpty(currCre[i].x+dx,currCre[i].y+dy)) {
     currCre[i].x += dx;
     currCre[i].y += dy;
     msg += currCre[i].name+" slips on the vegetation. ";
   }
 }
}

function killCreature(i){
 if(currCre[i].flags.includes("dodge") && !r(2)){
  msg += currCre[i].name+" dodges your attack. ";
  return false;
 }
 if(currCre[i].flags.includes("lifesaved")){
  currCre[i].flags = currCre[i].flags.removeElement("lifesaved");
  currCre[i].icon = currCre[i].icon.replaceAt(25, currCre[i].icon.charAt(25).toUpperCase());
  msg += currCre[i].name+" dies. But wait... "+currCre[i].name+" looks much better! ";

  // Special case for boss fight:
  if(currCre[i].flags.includes("boss")){
    currCre[i].flags.push("pierce");
    msg += currCre[i].name+" lets out a hate-filled roar. ";
    var m;
    var nbr = 0;
    for(var k=-1; k < 2; k++){
     for(var l=-1; l < 2; l++){
      if(checkEmpty(userPos.x+k,userPos.y+l) && inRangeCoords(userPos.x+k,userPos.y+l) && (k!=0 || l!=0)){
       m = r(currCre.length);
       currCre[m].x = userPos.x+k;
       currCre[m].y = userPos.y+l;
       currCre[m].flags.push("stun"); // Because getting surrounded in the middle of the boss fight is quite deadly.
       nbr++;
      }
     }
    }
    if(nbr>0) msg += "Monsters suddenly appear all around you. ";
    teleportMob(i);
  }

  return false;
 }

 // A little bit of score for killing enemies:
 if(staff!=5 && !currCre[i].flags.includes("worthless"))
   score += 10;
 if(glyph==8){ // blood knight armour
   if(bloodied>0){
     score += 10+r(10);
     msg += "You drain the lifeblood of "+currCre[i].name+". ";
   } else {
     bloodied += r(4);
     if(bloodied>0)
       msg += "You are splashed with the lifeblood of "+currCre[i].name+". ";
   }
 }

 msg += currCre[i].name+" dies. ";
 onDeath(i);
 currCre = currCre.removeElement(currCre[i]);
 kills += 1;
 return true;
}

function inRange(area){
 return (area.x>-1 && area.x<mapWidth && area.y>-1 && area.y<mapWidth);
}

function inRangeCoords(x,y){
 return (x>-1 && x<mapWidth && y>-1 && y<mapWidth);
}

function distanceToOrigin(){
 return Math.ceil(Math.sqrt(Math.pow(worldPos.x,2)+Math.pow(worldPos.y,2)));
}

function distanceBetween(mob1, mob2){
 return Math.ceil(Math.sqrt(Math.pow(mob1.x-mob2.x,2)+Math.pow(mob1.y-mob2.y,2)));
}

function stepsBetween(mob1, mob2){
 return Math.abs(mob1.x-mob2.x) + Math.abs(mob1.y-mob2.y);
}

// BUG: Something is broken...
// function checkFreeLineBetween(mob1, mob2, max_dist=999){
//   var dx = mob2.x-mob1.x;
//   var dy = mob2.y-mob1.y;
//   var ox = mob1.x;
//   var oy = mob1.y;
//
//   var dist = Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2));
//   if(dist>max_dist) return false;
//
//   dx /= (dist*8);
//   dy /= (dist*8);
//
//   for(var i = 0; i < (dist*8); i++){
//     if(impassable.includes(currentMap[ox][oy]))
//       return false;
//     ox += dx;
//     oy += dy;
//   }
//   return true;
// }

function semiModulo(a,b){
 if(a<0) return b-1;
 else if(a>=b) return 0;
 else return a;
}

// Main loop
function moveUser(x,y){
 // Update message log and clear messages for next turn:
 if(msg != ""){
   if(msgLog.length > 1 && msg == msgLog[msgLog.length-1].msg){
     // Join same messages and update their turn number:
     msgLog[msgLog.length-1].turn = turn;
     msgLog[msgLog.length-1].times += 1;
   } else if(!msg.includes('F5')) // Do not log game-end messages, they can stay fresh on screen.
     msgLog.push({
       msg: msg,
       turn: turn,
       times: 1,
     });
 }
 msg = "";

 // Do nothing but display win message if the player already won:
 if(haveWon){
  msg = "<t style='color:#FF1493'>You win!</t><br />Your final score is "+getFinalScore()+" after "+String(turn)+" turns. Maybe there is a meaning to everything, after all.<br />Press 'F5' to play again.";
  displayMap();
  return;
 }
 // Hunger and status effects:
 score--;
 if(poisoned>0){
  score--;
  poisoned--;
 }
 if(aflame>0){
  if(glyph==1){
   // Armor of Brimstone
   score++;
   if(!r(5)) msg += ["Your inner flame burns bright! ","The flames refresh you. "][r(2)];
  } else if(!r(2)){
    // Damage based on duration left and capped at 50.
    var dmg = Math.min(r(aflame), 50);
    score -= dmg;
    if(dmg>0)
      msg += "You burn! ["+((dmg > Math.max(10, score/10)) ? "<t style='color:#FF0000'>"+String(dmg)+"</t> " : String(dmg))+" dmg] ";
  } else if(!r(2))
    msg += "You burn! ";
  aflame--;
 }
 if(blinded>0) blinded--;
 if(confused>0){
   // Swap direction of movement:
   x = -x;
   y = -y;
   confused--;
 }
 if(bloodied>0) bloodied--;
 if(hasted>0 && (turn % 2 != 0)) hasted--;
 if(panicked>0) panicked--;
 if(phased>0){
   phased--;
   // Warn player when phasing will run out soon.
   if(phased == 10)
     msg += "The ethereal shadows are starting to fade away. ";
   if(phased == 5)
     msg += "You are about to phase back in. ";
 }
 if(stunned>0){
   // Randomize direction of movement:
   if(!r(3)){
     if(!r(2)){
       x = [-1,1][r(2)];
       y = 0;
     } else {
       x = 0;
       y = [-1,1][r(2)];
     }
     msg += "You stumble. ";
   }
   stunned--;
 }

 // Blood knight armour also refreshes you when on blood(stains):
 if(glyph==8 && (currentMap[userPos.x][userPos.y]==tileBlood || currentMap[userPos.x][userPos.y]==tileBloodDrop))
   score++;
 // Quicksand can prevent moving away:
 if(currentMap[userPos.x][userPos.y]==tileQuicksand && r(5) && !phased && !leap){
   if(x!=0 || y!=0)
     msg += ["You are stuck! ","The quicksand clings to your legs too strongly. ","The quicksand holds you in place. ","You cannot move. ",""].sampleRec();
   x = 0;
   y = 0;
 }

 // Handle death:
 if(score<0){
  if(staff==4){
   msg += "Your Staff"+staves[staff]+" shatters in a wave of life-giving energy. You feel reinvigorated. ";
   score = 50;
   cureAll();
   staff = 0;
  }else{
   msg = "You fade away...<br />Your final score is "+getFinalScore()+" after "+String(turn)+" turns. Better luck next life!<br />Press 'F5' to play again.";
   displayMap();
   return;
  }
 }

 // Handle conjuration staff:
 if(orb){
  if((x != 0 || y != 0) && inRangeCoords(userPos.x+x,userPos.y+y) && checkEmpty(userPos.x+x,userPos.y+y)){
   msg += "You conjure an orb of prismatic energy. ";
   // Create an orb creature with behaviour that will move in one direction until blocked, then explode.
   var mobOrb = {icon:"<t style='color:#800080'>*</t>",
                 name:"<t style='color:#800080'>Prismatic Orb</t>",
                 attack:"kamikazes",
                 aggro:10, // Doesn't really matter.
                 x:0, y:0,
                 flags:[{x:x,y:y}, "explode"],
                 behaviour: function(){
                  // Change colour randomly:
                  this.icon = this.icon.replaceAt(17, Math.random().toString(16).substr(2,6));
                  // Move in one direction, then explode:
                  var i = currCre.indexOf(this);
                  if(tryMove(this.x+this.flags[0].x,this.y+this.flags[0].y,i)){
                   doMove(this.x+this.flags[0].x,this.y+this.flags[0].y,i);
                  } else {
                   msg += currCre[i].name+" explodes. ";
                   onExplosion(i);
                  }
                  return true;
                 }
                };
   currCre.push(mobOrb);
   currCre[currCre.length-1].x = userPos.x+x;
   currCre[currCre.length-1].y = userPos.y+y;
  } else {
    msg += "The conjuration fizzles. ";
    // Refund cost of unused magic:
    score += 10;
  }

  orb = false;
 } else {
  // Handle soaring leap:
  if(leap){
   // Move player in direction until blocked by terrain. Any mobs in the way are
   // attacked and passed through.
   var leaped = 0;
   msg += "@@"; // Workaround to make sure we include the "You leap!" message before any attack messages.
   if(x!=0 || y!=0){ // Don't jump in place forever. ;)
     while(inRangeCoords(userPos.x+x,userPos.y+y) && !impassable.includes(currentMap[userPos.x+x][userPos.y+y])) {
       for (var i = 0; i < currCre.length; i++) {
        if(currCre[i].x==userPos.x+x && currCre[i].y==userPos.y+y){
          if(!inRangeCoords(userPos.x+x+x,userPos.y+y+y) || impassable.includes(currentMap[userPos.x+x+x][userPos.y+y+y])){
            // Move the creature a square back if we would otherwise land in the same space as it.
            currCre[i].x -= x;
            currCre[i].y -= y;
          }
          if(!panicked)
            damageCreature(i);
          else
            msg += "You soar right past "+currCre[i].name+". ";
        }
       }
       userPos.x += x;
       userPos.y += y;
       leaped += 1;
     }
   }

   if(leaped>1) msg = msg.replace("@@","You leap! ");
   else if(leaped==1) msg = msg.replace("@@","You jump. ");
   else {
     msg = msg.replace("@@","You balk at the leap. ");
     // Refund cost of unused magic:
     score += 10;
   }

   leap = false;
  } // Fallthrough to normal movement, so that the player can enter new map/attack with a leap.

  // Normal movement.
  // If at edge of map, enter new map; otherwise try moving, attacking any monsters in the way.
  if(!inRangeCoords(userPos.x+x,userPos.y+y)) {
   userPos.x = semiModulo(userPos.x+x, mapWidth);
   userPos.y = semiModulo(userPos.y+y, mapWidth);
   newMap(x,y);
 } else if(tryPlayerMove(userPos.x+x,userPos.y+y)) {
   userPos.x += x;
   userPos.y += y;
  }
 }

 // Handle enchanted armor.
 if(glyph==2 && currentMap[userPos.x][userPos.y]==emptyBlock && !r(20)){
  // Armor of cleansing water sometimes creates puddles of water.
  msg += "Your "+getArmorName()+" makes it rain. ";
  currentMap[userPos.x][userPos.y]=tileWater;
 }
 if(glyph==4 && x==0 && y==0 && !r(10)) teleportUser(); //displacement
 if(glyph==7 && !r(100)){ //phasing
   msg += "Your "+getArmorName()+" envelops you in shadows. ";
   phased += 10+r(20);
 }
 if(glyph==8 && currentMap[userPos.x][userPos.y]==emptyBlock && bloodied>0){
  // Armor of the blood knight trails blood as the player moves.
  currentMap[userPos.x][userPos.y]=tileBloodDrop;
 }

 // Handle special terrain underfoot.
 switch(currentMap[userPos.x][userPos.y]){
  case '$': //small treasure
   currentMap[userPos.x][userPos.y]=['.',',',emptyBlock][r(3)];
   score += 20;
   msg += "You collect the memento. ";
   break;

  case tileTreasure: //big treasure
   currentMap[userPos.x][userPos.y]=['.',',',emptyBlock][r(3)];
   score += 200;
   msg += "You loot the memory trove. ";
   break;

  case '^': //trap
   msg += "You step on a pressure plate. ";
   if(timestop>0){
     msg += "It seems to be stuck in time. ";
     break;
   }
   switch(r(15)){
    case 0:
     if(r(visited)>10){
      aflame += r(30)+r(30)+3;
      msg += "A gout of hellfire sets you ablaze! ";
     }
     else{
      poisoned += r(30)+visited;
      msg += "A poisoned dart pricks you. ";
     }
     break;

    case 1:
     msg += "You hear the grinding of ancient mechanisms. ";
     if(r(2)) currentMap[userPos.x][userPos.y]=wallBlock;
     else {
      var q = r(10)+3;
      var intoWhat = [wallBlock,'^'][r(2)];
      while(q--){
       currentMap[r(mapWidth)][r(mapWidth)]=intoWhat;
      }
     }
     break;

    case 2:
     // Msg handled by the function.
     teleportUser();
     break;

    case 3:
     msg += "Something stinky and sticky covers your face. ";
     blinded += r(10)+1;
     break;

    case 4:
     if(glyph != 3){
       msg += "You are surrounded by horrific gas. ";
       if(panicked==0)
         msg += "You panic! ";
       panicked += r(50)+r(50)+5;
     } else msg += "You are surrounded by pleasant odour. ";
     break;

    case 5:
     if(staff>0 && !r(2)){
       msg += "Your Staff"+staves[staff]+" glows dull brown for a moment and looses all its magic. ";
       staff = 0;
       break;
     }
     //fallthrough

    case 6: //convocation
     var m;
     var nbr = 0;
     for(var k=-1; k < 2; k++){
      for(var l=-1; l < 2; l++){
       if(checkEmpty(userPos.x+k,userPos.y+l) && inRangeCoords(userPos.x+k,userPos.y+l) && (k!=0 || l!=0)){
        m = r(currCre.length);
        currCre[m].x = userPos.x+k;
        currCre[m].y = userPos.y+l;
        nbr++;
       }
      }
     }
     if(nbr>0)
       msg += "Monsters suddenly appear all around you. ";
     else
       msg += "You hear a distant growl. ";
     break;

    case 7:
     msg += "You are surrounded by noxious gas. ";
     confused += r(50)+r(50)+5;
     break;

    case 8:
     msg += "You are surrounded by fetid odour. ";
     stunned += r(50)+r(50)+5;
     break;

    case 9:
     if(glyph>0 && !r(2)){
       msg += "Your "+getArmorName()+" glows dull brown for a moment and looses all its magic. ";
       glyph = 0;
       break;
     }
     //fallthrough

    case 10:
     var trapTerrain = [tileSludge,tileBlood,tileQuicksand,tileBlindGas,tileConfGas,tileStunGas,tileBramble,tileNettles].sampleRec();
     msg += "Your surroundings are blasted with transformative magic. ";
     for(var k=-1; k < 2; k++){
      for(var l=-1; l < 2; l++){
       if(inRangeCoords(userPos.x+k,userPos.y+l) && !impassable.includes(currentMap[userPos.x+k][userPos.y+l]))
         currentMap[userPos.x+k][userPos.y+l] = trapTerrain;
      }
     }
     break;

    default:
     msg += "A quarrel shoots out and hits you. ";
     playerTakeDamage(r(10)+visited);
     break;
   }
   break;

  case '?': //random fun
   if(!r(100)) currentMap[userPos.x][userPos.y]=[']','_','/',tileKey,tileTeleporter][r(5)];
   else if(!r(100)) currentMap[userPos.x][userPos.y]=[tileArmor,tileStaff][r(2)];
   else currentMap[userPos.x][userPos.y]=['$','^',','][r(3)];
   msg += "You investigate the mysterious pile. ";
   break;

  case '/': //lever
   if(timestop>0){
     msg += "The lever cannot be activated with the mechanisms stuck in time. ";
     break;
   }
   msg += "The lever clicks as you turn it. ";
   currentMap[userPos.x][userPos.y]='\\';
   // Create boss arena:
   if(score>1000){
     if(!r(2) && userPos.x>4 && userPos.x<(mapWidth-6) && userPos.y>4 && userPos.y<(mapWidth-6)){
       msg += "Suddenly, you feel a mysterious force tear a piece of your soul away. ";
       score = parseInt(score/2);
       msg += "[<t style='color:#FF0000'>"+String(score)+"</t> dmg] "; // Halved, so display the half as damage.
       addBoss();
       break;
     } else
       msg += ["You hear a distant rumble coming close, but then it subsides. ",
               "You feel a strange presence watching you intently. ",
               "You sense a mysterious force brush past you. "].sampleRec();
   } else if(!r(10))
     getHint("You hear a grinding voice saying: \"");

   // Create secret paths:
   var q = r(10)+1;
   var testX = 0;
   var testY = 0;
   while(q){
    testX = userPos.x+r(10)-5;
    testY = userPos.y+r(10)-5;
    if(inRangeCoords(testX,testY)){
     if(currentMap[testX][testY]==wallBlock){
      q--;
      currentMap[testX][testY] = tileSecretPath;
     }
    }
   }
   msg += "Walls crumble around you. ";
   break;

  case tileTeleporter:
   if(timestop>0) break;
   msg += "You step into the portal. ";
   teleportUser();
   break;

  case tileKey: //key
   msg += "You collect the key. ";
   currentMap[userPos.x][userPos.y]=['.',',',emptyBlock][r(3)];
   keys += 1;
   break;

  case tileGoldDoor:
   if(keys > 0){
     msg += "You unlock the door. ";
     keys -= 1;
     currentMap[userPos.x][userPos.y]=tileMobDoor;
     break;
   } else {
     // Won't normally happen, but the player might wander into a door from another map with no keys.
     msg += "You smash open the door. Ouch, that hurt! ";
     playerTakeDamage(r(10)+distanceToOrigin());
     currentMap[userPos.x][userPos.y]=',';
     break;
   }

  case tileStaff: //magic staff
   currentMap[userPos.x][userPos.y]='.';
   staff = 1+r(staves.length-1);
   msg += "You find a Staff"+staves[staff]+" and equip it. It "+staffDesc[staff]+". ";
   break;

  //armor enchanted
  case tileArmor:
   currentMap[userPos.x][userPos.y]='.';
   var old_glyph = glyph;
   var old_armor = armor;
   armor = Math.max(r(visited), parseInt(distanceToOrigin()/2)+1);
   glyph = 1+r(glyphs.length-1);
   // Guarantee either different glyph, or better armour:
   if(glyph==old_glyph && armor<old_armor)
     armor = old_armor + r(4)+1;
   msg += "You find a "+getArmorName()+" and equip it. It "+glyphDesc[glyph]+". ";
   break;

  //armor normal
  case "]":
   currentMap[userPos.x][userPos.y]='.';
   var new_armor = Math.max(r(visited), parseInt(distanceToOrigin()/2)+1);
   if(new_armor>armor){
     armor = new_armor;
     glyph = 0;
     msg += "You find a "+getArmorName()+" and equip it. ";
   } else {
     msg += "You find a "+armors[new_armor]+", but as you already have a better armour, you discard it. ";
   }
   break;

  case tileWater:
   if(glyph==2) //cleansing
     cureAll();
   else if(aflame>0){
    aflame = 0;
    msg += "You no longer burn. ";
   }
   if(bloodied>0){
    bloodied = 0;
    msg += "You wash yourself clean. ";
   }
   break;

  case tileLava:
   if(!r(20))
     msg += "Aargh! The floor is lava here! ";
   aflame += r(30)+1;
   break;

  case tileSludge:
   if(!r(4))
     msg += "Ack! This sludge is "+["disgusting","revolting","foul","nauseating"].sampleRec()+". ";
   poisoned += r(10)+distanceToOrigin();
   break;

  case tileBlindGas:
   if(!r(4))
     msg += "The dense smoke stings your eyes. ";
   blinded += r(4)+1;
   break;

  case tileConfGas:
   if(!r(4))
     msg += ["What was that? ","What's happening? ","You can't seem to think straight. "][r(3)];
   if(!confused) confused += 10;
   confused += r(10);
   break;

  case tileStunGas:
   if(!r(4))
     msg += "You feel unsteady. ";
   stunned += r(20)+2;
   break;

  case tileBlood:
   if(glyph==8 && !r(10)) // blood knight armour
     msg += ["What's that smell? The sweet blood! It's enough to make a man sick. ",
             "Glorious blood! Oh, it sings to me! ",
             "Blessed be blood! ",
             "Blood makes us human, makes us more than human, makes us human no more. "].sampleRec();
   else if(!r(4))
     msg += ["You wade knee deep in blood. ","You are covered in blood. "].sampleRec();
   else if(!r(100))
     msg += "Where does all this blood come from? ";
   if(aflame>0){
     aflame = 0;
     msg += "You no longer burn. ";
   }
   bloodied += r(10)+kills;
   break;

  case ',': //rubble
   if(phased>0) break;
   var stumbleStep = {x: userPos.x + r(3)-1, y: userPos.y + r(3)-1};
   if(inRange(stumbleStep) && checkEmpty(stumbleStep.x,stumbleStep.y)){
     userPos.x = stumbleStep.x;
     userPos.y = stumbleStep.y;
     msg += "You stumble on the rubble. ";
   }
   break;

  case tileGrassTall:
   if(aflame>0){
     msg += "You burn the grass. ";
     currentMap[userPos.x][userPos.y]='.';
   } else {
     msg += "You trample the grass. ";
     currentMap[userPos.x][userPos.y]=tileGrassShort;
   }
   break;

  case tileBramble:
   if(aflame>0){
     msg += "You burn the bramble. ";
     currentMap[userPos.x][userPos.y]='.';
   } else {
     msg += "You tear through the bramble. ";
     playerTakeDamage(r(6)+distanceToOrigin()+2);
     currentMap[userPos.x][userPos.y]=tileGrassShort;
   }
   break;

  case tileNettles:
   if(aflame>0){
     msg += "You burn the dread nettles. ";
     currentMap[userPos.x][userPos.y]='.';
   } else {
     msg += "You trample the dread nettles. ";
     if(glyph != 3){
       if(panicked==0)
         msg += "You panic! ";
       panicked += r(10)+currCre.length;
     }
     currentMap[userPos.x][userPos.y]=tileBloodDrop; // Close enough.
   }
   break;

  case "_":
   msg += "You kneel at the altar. ";
   // Set score to 100 if it's low enough.
   if(score<20){
     score = 100;
     msg += "You feel uplifted. ";
   }
   // Cure afflictions, but if you have none, you instead get a random boon.
   else if(!cureAll()){
    switch(r(6)){
     default:
      // Enchants armor, otherwise tries to give a different boon.
      if(glyph==0){
       msg += "Your "+armors[armor]+" glows bright purple for a second. ";
       glyph = 1+r(glyphs.length-1);
       break;
      }
      //fallthrough

     case 0:
      ward += 1;
      msg += "You are surrounded by a golden shimmer. ";
      break;

     case 1:
      phased += 50+r(100);
      msg += "You are surrounded by an ethereal glow. ";
      break;

     case 2:
      timestop += 40+r(60);
      msg += "Everything seems to slow down to a halt. ";
      break;

     case 3:
      msg += "Your "+armors[armor]+" is engulfed in bright blue flames. ";
      armor += Math.min(1+r(distanceToOrigin()), 5);
      msg += "The flames subside, revealing a brand new "+armors[armor]+". ";
      break;

     case 4:
      hasted += 60+r(100);
      msg += "Your heart races. ";
      break;
    }
   }
   currentMap[userPos.x][userPos.y]=emptyBlock;
   break;

  case tileIce:
   if(timestop>0) break;
   if(aflame>0){
     msg += "The ice under your feet thaws. ";
     currentMap[userPos.x][userPos.y]=tileWater;
   } else {
     // Move player in direction until blocked.
     var slipped = 0;
     if(x!=0 || y!=0){
       // Don't jump in place forever. ;)
       while(inRangeCoords(userPos.x+x,userPos.y+y) && checkEmpty(userPos.x+x,userPos.y+y) &&
             currentMap[userPos.x][userPos.y]==tileIce){
        userPos.x += x;
        userPos.y += y;
        slipped += 1;
       }
     }
     if(slipped>1) msg += "You slip on the ice! ";
     else if(slipped==1) msg += "You slip on the ice. ";
   }
   break;

  case tileMacGuffin:
   //TODO: Amulet, Orb, Crown
   var winStuff = ["Absolution","Reconciliation","Inner Peace"];
   msg += "You have found <t style='color:#FF1493'>"+winStuff[r(winStuff.length)]+"</t>! ";
   haveWon = true;
   break;

  default:
   break;
 }

 if(timestop>0){
  timestop--;
 }else moveCreatures();

 // Staff of Burgeoning leaves behind tall grass:
 if(staff==8 && currentMap[userPos.x][userPos.y]==emptyBlock && !r(5))
   currentMap[userPos.x][userPos.y]=tileGrassTall;

 // If no other message is displayed, you have a chance to receive a hint:
 if((msg == "") && !r(100))
   getHint();

 turn++;
 displayMap();
}

// MonsterMove/MobAttackPlayer function
function tryMove(x,y,i){
 if(userPos.x == x && userPos.y == y){
  msg += currCre[i].name+" "+currCre[i].attack+" you. ";
  playerTakeDamage(r(10)+visited,i);

  // Special attacks
  for(var j = 0; j < currCre[i].flags.length; j++){
   // Stop if someone teleports:
   if(distanceBetween(userPos,currCre[i])>2)
     break;

   switch(currCre[i].flags[j]){
    case "agony":
     msg += "Horrible agony tears at the very core of your being. ";
     score = parseInt(score/2);
     msg += "[<t style='color:#FF0000'>"+String(score)+"</t> dmg] "; // Halved, so display the half as damage.
     break;

    case "flame":
     msg += currCre[i].name+" burns you. ";
     aflame += r(visited)+r(visited)+1;
     break;

    case "venom":
     msg += "You feel a little ill. ";
     poisoned += r(distanceToOrigin()*2)+3;
     break;

    case "toxic":
     msg += "You feel a deathly ill. ";
     poisoned += 10+parseInt(score/5);
     break;

    case "blind":
     msg += "Your eyes! You cannot see! ";
     blinded += r(10)+1;
     break;

    case "confother":
     msg += ["Half-forgotten","Repressed","Unwanted"][r(3)]+" memories stir deep in your mind. ";
     confused += r(50)+5;
     break;

    case "stunother":
     msg += "You feel unsteady. ";
     stunned += r(kills)+10;
     break;

    case "panic":
     if(glyph==3)
       msg += currCre[i].name+" seems a little taken aback. ";
     else{
       msg += "You panic! ";
       panicked += r(10)+kills;
     }
     break;

    case "regen":
     var healed = currCre[i].icon.replaceAt(25, currCre[i].icon.charAt(25).toUpperCase());
     if((currCre[i].icon != healed) && r(4)){
      msg += currCre[i].name+" drains your life force and heals. ";
      currCre[i].icon = healed;
     }
     break;

    case "trapper":
     if(currentMap[userPos.x][userPos.y]==emptyBlock){
      msg += currCre[i].name+" vomits a strange mechanism under your feet. ";
      currentMap[userPos.x][userPos.y] = '^';
     }
     break;

    case "teleother":
     teleportUser();
     break;

    case "knockback":
     var dx = userPos.x - currCre[i].x;
     var dy = userPos.y - currCre[i].y;
     if(inRangeCoords(userPos.x+dx,userPos.y+dy) && checkEmpty(userPos.x+dx,userPos.y+dy)){
      userPos.x += dx;
      userPos.y += dy;
      msg += "You are knocked back. ";
     }
     break;

    case "flingback":
     var dx = userPos.x - currCre[i].x;
     var dy = userPos.y - currCre[i].y;
     var moved = 0;
     while (inRangeCoords(userPos.x+dx,userPos.y+dy) && checkEmpty(userPos.x+dx,userPos.y+dy)){
       userPos.x += dx;
       userPos.y += dy;
       moved += 1;
     }
     if(moved == 1)
       msg += "You are knocked back. ";
     else if(moved > 1)
       msg += "You are flung back. ";
     break;

    case "steal":
     if(!r(2)) break; // This is so evil it shouldn't proc always.
     if(keys>0){
      msg += currCre[i].name+" steals a key from you. ";
      keys--;
      break;
     }
     if(staff>0){
      msg += currCre[i].name+" steals your Staff"+staves[staff]+"! ";
      staff=0;
      break;
     }
     break;

    case "disenchant":
     if(!r(2)) break; // This is so evil it shouldn't proc always.
     if(glyph>0){
      msg += currCre[i].name+"'s touch drains the magic from your armour! ";
      glyph=0;
      break;
     }
     if(armor>0){
      msg += currCre[i].name+"'s touch polymorphs your armour into a weaker form! ";
      armor -= 1+r(distanceToOrigin());
      if(armor<0) armor = 0;
     }
     break;

    case "explode":
     msg += currCre[i].name+" explodes. ";
     onExplosion(i);
     break;

    case "bloody":
     msg += currCre[i].name+" sprays blood everywhere. ";
     bloodied += 10+kills;
     // Lots of blood:
     for(var k=-1; k < 2; k++){
      for(var l=-1; l < 2; l++){
       if(inRangeCoords(currCre[i].x+k,currCre[i].y+l)){
         // I will rather make doubly sure we're not checking outside the map's borders.
         if(currentMap[currCre[i].x+k][currCre[i].y+l] == emptyBlock)
           currentMap[currCre[i].x+k][currCre[i].y+l] = tileBloodDrop;
       }
      }
     }
     break;

    case "dispel":
     msg += "You feel powerless. ";
     if(hasted>0) hasted=0;
     if(phased>0) phased=0;
     if(timestop>0) timestop=0; // I'm not sure if this can even happen, but...
     if(ward>0) ward=0;
     break;

    case "extend":
     aflame *= 2;
     blinded *= 2;
     bloodied *= 2;
     confused *= 2;
     panicked *= 2;
     poisoned *= 2;
     stunned *= 2;
     msg += "You feel much worse than before. ";
     break;

    case "extraattack":
     msg += currCre[i].name+" "+currCre[i].attack+" you. ";
     playerTakeDamage(r(10)+visited,i);
     break;

    case "teleself":
     teleportMob(i);
     break;

    case "swap":
     if(r(3)){
       var dx = userPos.x - currCre[i].x;
       var dy = userPos.y - currCre[i].y;
       currCre[i].x += dx;
       currCre[i].y += dy;
       userPos.x -= dx;
       userPos.y -= dy;
       msg += currCre[i].name+" swaps with you. ";
     }
     break;

    case "jumpover":
     var dx = userPos.x - currCre[i].x;
     var dy = userPos.y - currCre[i].y;
     if(inRangeCoords(userPos.x+dx,userPos.y+dy) && checkEmpty(userPos.x+dx,userPos.y+dy) && r(3)){
       currCre[i].x = userPos.x+dx;
       currCre[i].y = userPos.y+dy;
       msg += currCre[i].name+" jumps over your head. ";
     }
     break;
   }
  }

  return true; // Won't move, but will stop the mobs turn.
 }

 if(!inRangeCoords(x,y))
   return false;
 if(!checkEmpty(x,y)){
   if(currentMap[x][y]==wallBlock){
     if(currCre[i].flags.includes("phase"))
       return true;
     else if(currCre[i].flags.includes("dig")){
       currentMap[x][y] = [emptyBlock,'.',','][r(3)];
       if(distanceBetween(userPos,currCre[i])<10)
         msg += currCre[i].name+" tears down the wall. ";
       return true;
     }
   }
   return false;
 }
 return true;
}

function doMove(x,y,i){
 if(userPos.x == x && userPos.y == y) return;
 if(currCre[i].flags.includes("immobile")) return;
 // Not blocked by player, move.
 currCre[i].x = x;
 currCre[i].y = y;
}

function onDeath(i){
 var k;
 var l;
 // Handle special death effects:
 for(var j = 0; j < currCre[i].flags.length; j++){
  switch(currCre[i].flags[j]){
   case "bloodpool":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && !impassable.includes(currentMap[currCre[i].x+k][currCre[i].y+l]))
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileBlood;
     }
    }
    msg += currCre[i].name+" explodes in a shower of gore. ";
    break;

   case "lavapool":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l))
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileLava;
     }
    }
    msg += "Horrible heat spreads from "+currCre[i].name+". ";
    break;

   case "toxicpool":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && !impassable.includes(currentMap[currCre[i].x+k][currCre[i].y+l]))
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileSludge;
     }
    }
    msg += currCre[i].name+" dissolves into toxic sludge. ";
    break;

   case "waterpool":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && !impassable.includes(currentMap[currCre[i].x+k][currCre[i].y+l]))
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileWater;
     }
    }
    msg += currCre[i].name+" bleeds an endless torrent of water. ";
    break;

   case "sandpool":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && !impassable.includes(currentMap[currCre[i].x+k][currCre[i].y+l]))
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileQuicksand;
     }
    }
    msg += currCre[i].name+" disintegrates into a flood of sand. ";
    break;

   case "icepool":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && !impassable.includes(currentMap[currCre[i].x+k][currCre[i].y+l]))
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileIce;
     }
    }
    msg += currCre[i].name+" freezes everything around. ";
    break;

   case "smoke":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && currentMap[currCre[i].x+k][currCre[i].y+l]==emptyBlock)
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileBlindGas;
     }
    }
    msg += currCre[i].name+" disappears into a billowing cloud of heavy smoke. ";
    break;

   case "confgas":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && currentMap[currCre[i].x+k][currCre[i].y+l]==emptyBlock)
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileConfGas;
     }
    }
    msg += currCre[i].name+" discorporates into a cloud of noxious fumes. ";
    break;

   case "stungas":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l) && currentMap[currCre[i].x+k][currCre[i].y+l]==emptyBlock)
        currentMap[currCre[i].x+k][currCre[i].y+l] = tileStunGas;
     }
    }
    msg += currCre[i].name+" dissolves into horrid stench. ";
    break;

   case "chaos":
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l))
        currentMap[currCre[i].x+k][currCre[i].y+l] = terrain_any.sampleRec();
     }
    }
    msg += currCre[i].name+" explodes in a multicoloured blast of magic. ";
    break;

   case "boss":
    // Lots of blood:
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(inRangeCoords(currCre[i].x+k,currCre[i].y+l)){
        // I will rather make doubly sure we're not checking outside the map's borders.
        if(currentMap[currCre[i].x+k][currCre[i].y+l] == emptyBlock)
          currentMap[currCre[i].x+k][currCre[i].y+l] = tileBloodDrop;
      }
     }
    }
    // Spawn MacGuffin when the boss dies.
    currentMap[currCre[i].x][currCre[i].y] = tileMacGuffin;
    break;

   case "convoke":
    var m;
    var nbr = 0;
    for(k=-1; k < 2; k++){
     for(l=-1; l < 2; l++){
      if(checkEmpty(userPos.x+k,userPos.y+l) && inRangeCoords(userPos.x+k,userPos.y+l) && (k!=0 || l!=0)){
       m = r(currCre.length);
       currCre[m].x = userPos.x+k;
       currCre[m].y = userPos.y+l;
       nbr++;
      }
     }
    }
    msg += currCre[i].name+" lets out a horrific screech. ";
    if(nbr>0) msg += "Monsters suddenly appear all around you. ";
    break;

   case "boonphase":
    phased += Math.min(5+kills, 50);
    msg += "You absorb some essence of shadows from "+currCre[i].name+". ";
    break;

   case "boontime":
    timestop += Math.min(5+kills, 50);
    msg += "You absorb some essence of time from "+currCre[i].name+". ";
    break;

   case "boonscore":
    score += Math.min(5+kills, 50); // Not much at first, but snowballs if you keep killing.
    msg += "You absorb some essence of memory from "+currCre[i].name+". ";
    break;

  case "boonhaste":
   hasted += Math.min(5+kills, 50);
   msg += "You absorb some essence of speed from "+currCre[i].name+". ";
   break;

   case "dropscore":
    if(currentMap[currCre[i].x][currCre[i].y]==emptyBlock)
      currentMap[currCre[i].x][currCre[i].y] = '$';
    msg += currCre[i].name+" leaves behind a memento. ";
    break;

   case "droppile":
    if(currentMap[currCre[i].x][currCre[i].y]==emptyBlock)
      currentMap[currCre[i].x][currCre[i].y] = '?';
    msg += currCre[i].name+" leaves something behind. ";
    break;

   case "droptrap":
    if(currentMap[currCre[i].x][currCre[i].y]==emptyBlock)
      currentMap[currCre[i].x][currCre[i].y] = '^';
    msg += currCre[i].name+" leaves behind a strange mechanism. ";
    break;
  }
 }

 // Create a bloodstain:
 if(currentMap[currCre[i].x][currCre[i].y] == emptyBlock)
   currentMap[currCre[i].x][currCre[i].y] = tileBloodDrop;
}

function onExplosion(i){
 var self = currCre[i];
 for(var k=-1; k < 2; k++){
  for(var l=-1; l < 2; l++){
   if(inRangeCoords(currCre[i].x+k,currCre[i].y+l)){
    // Destroy some terrain types:
    switch (currentMap[currCre[i].x+k][currCre[i].y+l]) {
      case tileNettles:
       currentMap[currCre[i].x+k][currCre[i].y+l] = tileBloodDrop;
       break;

      case tileGrassTall: case tileBramble: case tileBush:
       currentMap[currCre[i].x+k][currCre[i].y+l] = tileGrassShort;
       break;

      case tileTreeConif: case tileTreeLeafy: case tileTreeDead:
       msg += "The tree shatters into a thousand splinters. ";
       currentMap[currCre[i].x+k][currCre[i].y+l] = tileTreeStump;
       break;

      case tileMobDoor:
       msg += "The door is blown off its hinges. ";
       currentMap[currCre[i].x+k][currCre[i].y+l] = '.';
       break;

      case wallBlock:
       currentMap[currCre[i].x+k][currCre[i].y+l] = ',';
       break;

      case tileBlindGas: case tileConfGas: case tileStunGas:
       msg += "The vapours disperse. ";
       currentMap[currCre[i].x+k][currCre[i].y+l] = emptyBlock;
       break;
    }
    // Deal damage to the player if they get caught in the explosion:
    if(userPos.x == currCre[i].x+k && userPos.y == currCre[i].y+l){
     msg += "You are pummeled by the explosion. ";
     playerTakeDamage(10+parseInt(score/4));
    }
   }
  }
 }
 // Kill mobs caught in the explosion:
 for(var m = 0; m < currCre.length; m++){
  if(currCre[m] == self) continue;
  else if(distanceBetween(self,currCre[m])<=2){
    if(currCre[m].flags.includes("boss")){
      // The boss is immune, but we still stun it.
      currCre[m].flags.push("stun");
      msg += currCre[m].name+" is stunned by the explosion. ";
    } else if(currCre[m].flags.includes("lifesaved")){
     currCre[m].flags = currCre[m].flags.removeElement("lifesaved");
     currCre[m].icon = currCre[m].icon.replaceAt(25, currCre[m].icon.charAt(25).toUpperCase());
     msg += currCre[m].name+" is torn apart. But wait... "+currCre[m].name+" coalesces back together! ";
    } else {
      msg += currCre[m].name+" is torn apart. ";
      onDeath(m);
      currCre = currCre.removeElement(currCre[m]);
    }
  }
 }
 // And finally kill the exploding mob:
 onDeath(currCre.indexOf(self));
 currCre = currCre.removeElement(self);
}

function moveCreatures(){
 for (var k = 0; k < currCre.length; k++) {
  // Slow creatures only act once per two turns.
  if((currCre[k].flags.includes("slow") || hasted>0) && (turn % 2 != 0))
    continue;

  // Check for special action:
  if(!currCre[k].flags.includes("stun")) {
    if(currCre[k].behaviour()) continue;
  } else if(!r(4))
    currCre[k].flags = currCre[k].flags.removeElement("stun");

  // Get direction to player normalized to <-1,1>.
  var dist = distanceBetween(userPos,currCre[k]);
  var nextStep = [];
  var tryStep;

  // Pursue the player if close enough, or if the creature has ESP.
  if((dist <= currCre[k].aggro || currCre[k].flags.includes("esp")) &&
     !currCre[k].flags.includes("stun")) {
   var dx = Math.round((userPos.x - currCre[k].x)/dist);
   var dy = Math.round((userPos.y - currCre[k].y)/dist);

   if(currCre[k].flags.includes("flee")){
     if(dist>=4 && !r(4)) // calm down eventually
      currCre[k].flags = currCre[k].flags.removeElement("flee");
     else {
       dx = -dx;
       dy = -dy;
     }
   }

   if(dx!=0) nextStep.push({x: currCre[k].x+dx, y: currCre[k].y});
   if(dy!=0) nextStep.push({x: currCre[k].x, y: currCre[k].y+dy});
   nextStep.shuffle();
   if(currCre[k].flags.includes("diagonal"))
     nextStep.push({x: currCre[k].x+dx, y: currCre[k].y+dy});
   else if(stepsBetween(userPos,currCre[k])==2 && r(5) && !currCre[k].flags.includes("dumb")){
     // When one step away from player, sometimes don't move and let the player come.
     continue;
   }

   // Move in one of possible directions, if blocked try the another:
   var moved = false;
   while(nextStep.length>0) {
     tryStep = nextStep.pop();
     if(tryMove(tryStep.x,tryStep.y,k)){
       doMove(tryStep.x,tryStep.y,k);
       moved = true;
       break;
     }
   }
   if(moved) continue;
  }

  // Move randomly otherwise.
  nextStep = [{x: currCre[k].x+1, y: currCre[k].y},{x: currCre[k].x-1, y: currCre[k].y},{x: currCre[k].x, y: currCre[k].y+1},{x: currCre[k].x, y: currCre[k].y-1}];
  if(currCre[k].flags.includes("diagonal")) nextStep.push({x: currCre[k].x+1, y: currCre[k].y+1},{x: currCre[k].x+1, y: currCre[k].y-1},{x: currCre[k].x-1, y: currCre[k].y+1},{x: currCre[k].x-1, y: currCre[k].y-1});
  tryStep = nextStep.sampleRec();
  if(tryMove(tryStep.x,tryStep.y,k))
    doMove(tryStep.x,tryStep.y,k);
 }
}

function getFinalScore(){
 var winner = (Math.max(score, 0) / 10) + ((visited-1) * 5) + (kills * 5) + (keys * 20) + (armor * 10);
 if(staff!=0) winner *= 1.1;
 if(glyph!=0) winner *= 1.1;
 return "<t style='color:#8B008B; font-weight: bold;'>"+String(parseInt(winner))+"</t>";
}

function displayMap(highlight=""){
 var displayString = "";
 var outputMap = [];
 var i;
 var j;

 // Check if we didn't hide the right div:
 if(document.getElementById("additional-info").style.display == 'none')
   document.getElementById("additional-info").style.display = 'initial';

 // Clone the map for output, then add monster symbols to it:
 currentMap.clone2d(outputMap);
 if(blinded>0 || highlight != ""){
  // If blind, we only display the player. Highlighting can display the player,
  // mobs and treasures, or outline of nearby/furthest reachable area.
  for (i = 0; i < mapWidth; i++) {
   for (j = 0; j < mapWidth; j++) {
     if(blinded>0) // Blindess overrides highlighting.
       outputMap[i][j] = emptyBlock;
     else if(highlight == "interests" && treasures.includes(outputMap[i][j]))
       continue;
     else if(highlight == "area") {
       if(stepsBetween(userPos, {x:i,y:j}) == 9 && score > 10)
         outputMap[i][j] = "<t style='background-color:#9ACD32'>"+outputMap[i][j]+"</t>";
       else if(stepsBetween(userPos, {x:i,y:j}) == score)
         outputMap[i][j] = "<t style='background-color:#FF0000'>"+outputMap[i][j]+"</t>";
       // Otherwise leave map as is.
     }
     else
       outputMap[i][j] = emptyBlock;
   }
  }
 }
 if(blinded==0 && highlight != "player") {
   for (i = 0; i < currCre.length; i++) {
     if(!currCre[i].flags.includes("invisible") || (distanceBetween(userPos, currCre[i]) <= 2))
       outputMap[currCre[i].x][currCre[i].y]=currCre[i].icon;
   }
 }
 // Always display the player:
 outputMap[userPos.x][userPos.y] = getUserChar();

 for (i = 0; i < mapWidth; i++) {
  displayString += outputMap[i].join("")+"<br />";
 }

 // Highlight Self levels:
 var currentSelf;
 if(score <= 0) {
   currentSelf = "<t style='color:#FF0000; font-weight: bold;'>faded</t>";
 } else if(score < 50) {
   currentSelf = "<t style='background-color:#FF0000; padding: 1px;'>"+String(score)+"</t>";
 } else if(score > 1000){
  currentSelf = "<t style='color:#8B008B; font-weight: bold;'>"+String(score)+"</t>";
 } else {
   currentSelf = String(score);
 }

 // Prepare the status lines and messages:
 var names = userName + " - " + getWorldName();
 var attributes = "Self: " + currentSelf + " - Visited: " + String(visited) + " - Keys: " + String(keys) + " - Kills: " + String(kills);
 var equipped = "Weapon: Staff" + staves[staff] + "<br />Armour: " + getArmorName() + " - Defense: "+String(armor);
 var states = ((aflame>0) ? "<t style='color:#FF4500'>Aflame</t> " : "") +
              ((blinded>0) ? "<t style='background-color:#000000; color:#FFFFFF;'>Blind</t> " : "") + // white on black
              ((bloodied>0) ? "<t style='color:#8A0303'>Bloodied</t> " : "") +
              ((confused>0) ? "<t style='color:#FF1493'>Confused</t> " : "") +
              ((hasted>0) ? "<t style='color:#7FFF00; font-style: italic;'>Haste</t> " : "") +
              ((panicked>0) ? "<t style='color:#DC143C'>Panicked</t> " : "") +
              ((phased>0) ? "<t style='color:#4B0082'>Phasing</t> " : "") +
              ((poisoned>0) ? "<t style='color:#00FF00'>Poisoned</t> " : "") +
              ((stunned>0) ? "<t style='background-color:#FFFF00'>Stun</t> " : "") +
              ((timestop>0) ? "<t style='color:#00BFFF'>Time Stop</t> " : "") +
              ((ward>0) ? "<t style='color:#DAA520'>Ward</t> " : "");

 // Create a list of nearby things:
 var nearbyThings = [];
 var nearbyMobList = [];
 var nearbyTileList = [];
 for (i = 0; i < currCre.length; i++) {
   if(distanceBetween(userPos,currCre[i]) <= 2){
     if(!nearbyThings.includes(currCre[i].name)){
       nearbyThings.push(currCre[i].name);
       nearbyMobList.push(currCre[i].icon+"&nbsp;&nbsp;"+currCre[i].name+"<br />");
     }
   }
 }
 for(var j=-1; j < 2; j++){
  for(var k=-1; k < 2; k++){
   if(inRangeCoords(userPos.x+j,userPos.y+k)){
     if(!nearbyThings.includes(currentMap[userPos.x+j][userPos.y+k])){
       nearbyThings.push(currentMap[userPos.x+j][userPos.y+k]);
       if(getTileName(currentMap[userPos.x+j][userPos.y+k]))
         nearbyTileList.push(currentMap[userPos.x+j][userPos.y+k]+"&nbsp;&nbsp;"+getTileName(currentMap[userPos.x+j][userPos.y+k])+"<br />");
     }
   }
  }
 }
 nearbyMobList.sort();
 nearbyTileList.sort();
 nearbyThings = "<t style='line-height: 105%;'>";
 if(blinded>0)
   nearbyThings += "Nothing you can see.<br />";
 else if(!nearbyMobList.length && !nearbyTileList.length)
   nearbyThings += "Nothing of interest.<br />";
 else
   nearbyThings += nearbyMobList.join('')+nearbyTileList.join('');
 // Tiny hack to prevent the list of nearby things from moving based on length of individual names:
 nearbyThings += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</t>";

 // Prepare messages:
 var messages = (msg=="") ? "<t style='color:#686868'>" : msg+"<br /><t style='color:#686868'>";
 if(!msg.includes('F5')){
   for (i = msgLog.length-1; i > msgLog.length-msgNbrToShow-1 && i >= 0; i--){
     if(msgLog[i].turn < turn-msgTurnsToShow) break; // Don't display too old messages.
     messages += msgLog[i].msg;
     if(msgLog[i].times > 1) messages += "x"+String(msgLog[i].times);
     messages += "<br />";
   }
 }
 messages += "</t>";

 // Print everything on screen:
 document.getElementById("mapText").innerHTML = displayString;
 document.getElementById("statusLine").innerHTML = names+"<br />"+attributes+"<br />"+equipped+"<br />"+states;
 document.getElementById("nearbyList").innerHTML = nearbyThings;
 document.getElementById("msgWindow").innerHTML = messages;
}

// Player commands:
document.onkeydown = function(e) {
    switch (e.keyCode) {
        case 65: //A
        case 72: //H
        case 100://4
        case 37: //left
         moveUser(0,-1);
         break;
        case 87: //W
        case 75: //K
        case 104://8
        case 38: //up
         moveUser(-1,0);
         break;
        case 68: //D
        case 76: //L
        case 102://6
        case 39: //right
         moveUser(0,1);
         break;
        case 83: //S
        case 74: //J
        case 98: //2
        case 40: //down
         moveUser(1,0);
         break;
        case 190://.
        case 101://5
        case 32: //space
         moveUser(0,0);
         break;
        case 88: //X
        case 96: //0
         useStaff();
         break;
        case 188://?
        case 191:// An alternate question mark code, apparently.
         // Open a help window.
         alert("Wanderer "+VERSION+"\n\n"+
               "Use arrow keys, numpad keys, 'WASD' or 'HJKL' to move. Space, '.' or '5' waits a turn.\n"+
               "Press 'X' or '0' to invoke the powers of your magic staff.\n\n"+
               "Press 'M' for message history.\n"+
               "Hold 'Ctrl' to highlight your avatar.\n"+
               "Hold 'Alt' to highlight monsters and treasure.\n"+
               "Hold 'Shift' to outline the nearby area in green and the furthest you could reach with your current Self in red.\n\n"+
               "Gather the '$' memories of your life, or you may fade away before you reach your closure.");
         displayMap();
         break;
        case 77: //M
         document.getElementById("mapText").innerHTML = "Message history. Press Esc to dismiss.";
         var messages = "Turn<br />";
         messages += (msg=="") ? "" : String(turn).padStart(4,'.')+'&nbsp;&nbsp;'+msg.replace('<br />','<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;')+"<br />";
         for (var i = msgLog.length-1; i >= 0; i--){
           messages += String(msgLog[i].turn).padStart(4,'.')+'&nbsp;&nbsp;'+msgLog[i].msg.replace('<br />','<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;');
           if(msgLog[i].times > 1) messages += "x"+String(msgLog[i].times);
           messages += "<br />";
         }
         document.getElementById("statusLine").innerHTML = messages;
         // Clear so that we don't have messages twice next to each other.
         document.getElementById("additional-info").style.display = 'none';
         break;
        case 16: //Shift
         displayMap("area");
         break;
        case 17: //Ctrl
         displayMap("player");
         break;
        case 18: //Alt
         displayMap("interests");
         break;
        case 27: //Esc
         displayMap();
         break;

        //DEBUG
        // case 66: //B
        //  addBoss();
        //  displayMap();
        //  break;
        // case 86: //V
        //  score = 500-r(500);
        //  visited = r(20)+2;
        //  staff = r(staves.length);
        //  glyph = r(glyphs.length);
        //  armor = r(20);
        //  keys = r(5);
        //  kills = r(30);
        //  spawnMobs();
        //  displayMap();
        //  break;
    }
};

document.onkeyup = function(e) {
    switch (e.keyCode) {
        case 16: //Shift
        case 17: //Ctrl
        case 18: //Alt
         displayMap();
         break;
    }
};

Array.prototype.clone2d = function(target) {
 for (var i = 0; i < this.length; i++) {
  target[i] = this[i].slice(0);
 }
};

Array.prototype.shuffle = function() {
  var temp, loc;
  for (var i = this.length-1; i>0; i--) {
    loc = r(i+1);
    temp = this[i];
    this[i] = this[loc];
    this[loc] = temp;
  }
};

String.prototype.replaceAt=function(index, replacement) {
    return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
};

Array.prototype.sampleRec = function () {
 var output = this[Math.floor(Math.random() * this.length)];
 if(Array.isArray(output)) return output.sampleRec();
 else return output;
};

Array.prototype.removeElement = function(element) {
 return this.filter(function(ele){ return ele != element; });
};

function cloneCreature(creature){
 var clone = {icon:"",name:"",attack:undefined,aggro:0,x:0,y:0,flags:[],behaviour:function(){return false;}};
 clone.icon = creature.icon;
 clone.name = creature.name;
 clone.attack = creature.attack;
 clone.aggro = creature.aggro;
 clone.flags = creature.flags.slice();
 clone.behaviour = creature.behaviour;

 return clone;
}

function initialise(){
 // Init creatures:
 var creatureName = "abcdefghijklmnopqrstuvwxyz".split('');
 for (var i = 0; i < creatureName.length; i++)
   mobNames[creatureName[i]].shuffle();
 mobSelves.shuffle();
 for (; creatureChar.length>0; ) {
  var base = {icon:"",name:"",attack:undefined,aggro:0,x:0,y:0,flags:[],behaviour:function(){return false;}};
  base.icon = "<t style='color:#"+Math.random().toString(16).substr(2,6)+"'>"+creatureChar.pop()+"</t>";
  base.name = "<t style='color:#"+base.icon.substr(17,6)+"'>"+getMobName(base.icon.charAt(25))+"</t>";
  base.attack = attackVerbs[r(attackVerbs.length)];
  base.aggro = r(10)+r(5)+4;
  base.flags = getMobFlags();
  base.behaviour = getMobBehaviour();
  creatureList.push(base);
 }

 // Init map:
 worldData[0] = [];
 worldData[0][0] = {
   map: [],
   name: "",
   mobs: [],
 };
 worldData[0][0].name = newWorldName();
 generateMap();
 spawnMobs();

 var welcome = ["May you find that which you seek.",
                "Strike down anyone who stands in your path.",
                "Their blood shall purify you.",
                "Your journey's end awaits in the distance.",
                "Nourish your Self or fade to oblivion.",
                "Seek the levers once your Self glows again. ",
                "Venture beyond, where new lands await. ",];

 // Init game:
 addUser();
 staff = r(staves.length); // Start with a random staff.
 if(staff==0){ // Compensate no magic staff with a random armour glyph.
   armor = r(3);
   glyph = 1+r(glyphs.length-1);
 }
 newMap(0,0);
 msg += "Welcome, Wanderer. "+welcome.sampleRec()+"<br />Press '?' for help. ";
 displayMap();
}

initialise();

</script>
</body>
</html>
